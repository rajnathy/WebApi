(function(k){function c(e){this._element=k(e);this._target=this._element.data("target")||{};this._attachmentSettings=this._element.data("attachmentsettings");this._serviceUrlGet=this._element.attr("data-url-get");this._serviceUrlAdd=this._element.attr("data-url-add");this._serviceUrlEdit=this._element.attr("data-url-edit");this._serviceUrlDelete=this._element.attr("data-url-delete");this._serviceUrlGetAttachments=this._element.attr("data-url-get-attachments");this._serviceUrlGetAttachmentsCount=this._element.attr("data-url-get-attachments-count");this._hideFieldLabel=this._element.attr("data-hide-field-label");this._attachmentAcceptTypes=this._element.attr("data-add-accept-types");this._addEnabled=this._element.data("add-enabled");this._editEnabled=this._element.data("edit-enabled");this._deleteEnabled=this._element.data("delete-enabled");this._pageSize=this._element.attr("data-pagesize");this._orders=this._element.data("orders");this._addSuccess=false;this._editSuccess=false;this._deleteSuccess=false;this._useScrollingPagination=this._element.attr("data-use-scrolling-pagination");this._$editModal=this._element.children(".modal-editnote").appendTo("body");this._$deleteModal=this._element.children(".modal-deletenote").appendTo("body");var a=this;this._pageNumber=1;k(e).on("refresh",function(e,t){if(a._useScrollingPagination=="True"){t=-1}a.load(t)})}k(document).ready(function(){var e=k(".entity-notes");if(e.length==0){e=k(".entity-timeline")}e.each(function(){Handlebars.registerHelper("if_eq",function(e,t,a){if(e==t)return a.fn(this);else return a.inverse(this)});Handlebars.registerHelper("if_not_eq",function(e,t,a){if(e!=t)return a.fn(this);else return a.inverse(this)});Handlebars.registerHelper("commaSeparatedList",function(e,t){var a="";for(var n=0;n<e.length;n++){if(e[n].Name){a+=e[n].Name+(n!==e.length-1?", ":"")}}return a});Handlebars.registerHelper("dateTimeFormatter",function(e){var t=window.moment;if(t){var a=dateFormatConverter.convert(k(".entity-timeline").closest("[data-dateformat]").data("dateformat")||"M/d/yyyy",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var n=dateFormatConverter.convert(k(".entity-timeline").closest("[data-timeformat]").data("timeformat")||"h:mm tt",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var i=dateFormatConverter.convert(k(".entity-timeline").closest("[data-datetimeformat]").data("datetimeformat")||a+" "+n,dateFormatConverter.dotNet,dateFormatConverter.momentJs);return t(e).format(i)}});new c(k(this)).render()})});c.prototype.render=function(){var e=this;var t=e._element;var a=e._hideFieldLabel==="True"?t.children(".timelineheader").find("a.addnote"):t.children(".note-actions").find("a.addnote");var n=t.children(".modal-addnote").appendTo("body");var i=n.find(".modal-footer .btn-primary");var r=t.children(".note-actions").find(".loadmore");n.find("input[type='file']").val("");if(this._hideFieldLabel==="False"){k(".notes-cell .info").show()}e.load();if(e._addEnabled=="True"){a.show();a.on("click",function(){n.modal("show");n.attr("aria-hidden","false")});i.on("click",function(){e.addNote(n)});n.on("hidden.bs.modal",function(){n.find("textarea").val("");n.find("input[type='file']").val("");n.find(".alert-danger.error").remove();n.attr("aria-hidden","true")})}if(this._useScrollingPagination=="True"){r.on("click",function(){e._pageNumber+=1;r.hide();e.load(e._pageNumber)})}};c.prototype.load=function(i){var o=this;var r=o._element;var l=r.children(".notes");var n=r.children(".notes-error");var d=r.children(".notes-empty");var s=r.children(".notes-access-denied");var e=r.children(".notes-loading");var t=r.children(".notes-loading-more");var a=r.find(".notes-pagination");var c=r.children(".note-actions").find(".loadmore");var f=o._serviceUrlGet;var u=o._serviceUrlGetAttachments;var p=o._serviceUrlGetAttachmentsCount;var v=o._target;var m=o._orders;var h=o._pageSize;var g=o._useScrollingPagination;n.hide();d.hide();s.hide();if(g=="True"){t.show()}else{l.hide().empty();e.show()}var y=a.data("current-page");if(y==null||y==""){y=1}i=i||y;var b=a.data("pagesize");if(b==null||b==""){b=h}var C=false;if(g=="True"&&i==-1){C=true}o.getData(f,v,m,C?1:i,C?1:b,function(e){if(typeof e===typeof undefined||e===false||e==null){d.fadeIn();return}if(typeof e.Records!==typeof undefined&&e.Records!==false&&(e.Records==null||e.Records.length==0&&i==1)){d.fadeIn();return}if(typeof e.AccessDenied!==typeof undefined&&e.AccessDenied!==false&&e.AccessDenied){s.fadeIn();return}var t=false;if(g=="True"){if(C){if(o._pageNumber*b<e.ItemCount){c.show();t=true}}else if(e.PageCount>o._pageNumber){c.show()}}var a=k("#notes-template").html();Handlebars.registerHelper("AttachmentUrlWithTimeStamp",function(){return this.AttachmentUrl+"?t="+(new Date).getTime()});Handlebars.registerHelper("attachments",function(e,t){var a=(new Date).getTime();var n=k("#notes-attachment-template").html();var r=Handlebars.compile(n);regardingActivity={Id:e,LogicalName:t};o.getAttachments(u,regardingActivity,1,a,p,function(e){var t=k(".attachmentasync-"+a);if(Array.isArray(e)&&e.length>0){if(!t.prev().hasClass("attachment-separator")){t.before("<div class='attachment-separator'></div>")}}else{t.parent().removeClass()}t.append(r(e))});k(document).on("click",".load-more-attachment-btn",function(e){e.stopImmediatePropagation();e.preventDefault();var a=parseInt(k(this).attr("data-page-id"));var t=k(this).attr("data-attachment-id");var n=parseInt(k(this).attr("data-total-records"));regardingActivity={Id:k(this).attr("data-activity-id"),LogicalName:k(this).attr("data-logical-name")};if(isNaN(a)||isNaN(n)||t==null||typeof regardingActivity.Id=="undefined"||typeof regardingActivity.LogicalName=="undefined")return;var i=k(".attachmentasync-"+t);o.getAttachments(u,regardingActivity,a,t,p,function(e){if(Array.isArray(e)&&e.length>0){i.append(r(e));var t=i.next();if(a*10<n){t.find(".load-more-attachment-btn").attr("data-page-id",a+1)}else t.hide()}})});return k("<div>").html(k("<div>").attr("class","attachmentasync-"+a+" attachment-loadmore-section")).html()});var n=Handlebars.compile(a);if(g=="True"){if(C){l.prepend(n(e));if(t){l.children(".note").last().remove()}}else{l.append(n(e))}}else{l.html(n(e))}l.find(".timeago").each(function(){var e=k(this).attr("title");var t=window.moment;if(t){var a=dateFormatConverter.convert(r.closest("[data-dateformat]").data("dateformat")||"M/d/yyyy",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var n=dateFormatConverter.convert(r.closest("[data-timeformat]").data("timeformat")||"h:mm tt",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var i=a+" "+n;k(this).text(t(e).format(i))}});l.find(".timeago").timeago();l.fadeIn();if(g=="False"){o.initializePagination(e)}if(o._editEnabled&&o._editEnabled!="False"){o.addEditClickEventHandlers()}if(o._deleteEnabled&&o._deleteEnabled!="False"){o.addDeleteClickEventHandlers()}},function(e,t,a){n.find(".details").append(a);n.show()},function(){e.hide();t.hide()})};c.prototype.getData=function(e,t,a,n,i,r,o,l){r=k.isFunction(r)?r:function(){};o=k.isFunction(o)?o:function(){};l=k.isFunction(l)?l:function(){};if(!e||e==""){l.call(this);o.call(this,null,"error",window.ResourceManager["Service_URL_Not_Provided"]);return}if(!t){l.call(this);o.call(this,null,"error",window.ResourceManager["Required_Regarding_EntityReference_Parameter_Was_Not_Provided"]);return}i=i||-1;var d={};d.regarding=t;d.orders=a;d.page=n;d.pageSize=i;var s=JSON.stringify(d);shell.ajaxSafePost({type:"POST",dataType:"json",contentType:"application/json",url:e,data:s,global:false}).done(r).fail(o).always(l)};c.prototype.getAttachments=function(e,i,r,o,t,a,n,l){a=k.isFunction(a)?a:function(){};n=k.isFunction(n)?n:function(){};l=k.isFunction(l)?l:function(){};if(!e||e==""){l.call(this);n.call(this,null,"error",window.ResourceManager["Service_URL_Not_Provided"]);return}if(!i){l.call(this);n.call(this,null,"error",window.ResourceManager["Required_Regarding_EntityReference_Parameter_Was_Not_Provided"]);return}var d={};d.regarding=i;d.page=r;var s=JSON.stringify(d);shell.ajaxSafePost({type:"POST",dataType:"json",contentType:"application/json",url:e,data:s,success:a,error:n,global:false}).then(function(e){var a=10;if(Array.isArray(e)&&(e.length>=a&&r==1)){var n=k(".attachmentasync-"+o).next();n.show();c.prototype.getTotalRecords(t,i,function(e){if(e>a){var t=n.find(".load-more-attachment-btn");if(typeof t=="undefined"||t==null)return;t.attr("data-total-records",e);t.attr("data-page-id",r+1);t.attr("data-attachment-id",o);t.attr("data-activity-id",i.Id);t.attr("data-logical-name",i.LogicalName)}})}})};c.prototype.getTotalRecords=function(e,t,a,n,i){a=k.isFunction(a)?a:function(){};n=k.isFunction(n)?n:function(){};i=k.isFunction(i)?i:function(){};if(!e||e==""){i.call(this);n.call(this,null,"error",window.ResourceManager["Service_URL_Not_Provided"]);return}if(!t){i.call(this);n.call(this,null,"error",window.ResourceManager["Required_Regarding_EntityReference_Parameter_Was_Not_Provided"]);return}var r={};r.entityReference=t;var o=JSON.stringify(r);shell.ajaxSafePost({type:"POST",dataType:"json",contentType:"application/json",url:e,data:o,success:a,error:n,global:false})};c.prototype.addEditClickEventHandlers=function(){var t=this;var e=t._element;var y=t._$editModal;if(!y||y.length==0){return}var b=y.find("input[type='file']");var a=y.find("button.primary");if(b.length>0){b.on("change",function(){y.find(".attachment").remove()})}a.unbind("click");a.on("click",function(e){e.preventDefault();t.updateNote(y)});y.on("hidden.bs.modal",function(){y.find(".alert-danger.error").remove();y.find("textarea").val("");y.find("input[type='file']").val("");y.find(".alert-danger.error").remove();y.data("id","");y.find(".attachment").empty()});e.find(".edit-link").on("click",function(e){e.preventDefault();var t=k(this).closest(".note");var a=t.data("id");var n=t.data("unformattedtext")||"";var i=t.data("subject")||"";var r=t.data("isprivate");var o=t.data("hasattachment");var l=t.data("attachmentfilename");var d=t.data("attachmentfilesize");var s=t.data("attachmenturl");var c=t.data("attachmentisimage");if(!a||a==""){if(typeof console!="undefined"&&console){console.log("Failed to launch edit note dialog. Data parameter 'id' is null.")}return}y.data("id",a);y.data("subject",i);y.find("textarea").val(n);if(r){y.find("input[type='checkbox']").prop("checked",true)}var f=b.parent();if(o){s+="?t="+(new Date).getTime();var u=y.find(".attachment");if(u.length==0){u=k("<div class='attachment clearfix'></div>")}var p=k("<div class='link'></div>");var v=k("<a target='_blank'></a>").attr("href",s).html("<span class='fa fa-file' aria-hidden='true'></span> "+l+" ("+d+")");p.html(v);if(c){var m=k("<a target='_blank' class='thumbnail'></a>").attr("href",s);var h=k("<img />").attr("src",s);var g=k("<div class='img col-md-4'></div>");g.append(m.html(h));u.html(g).append(p);f.prepend(u)}else{u.html(p);f.prepend(u)}}y.modal()})};c.prototype.addDeleteClickEventHandlers=function(){var i=this;var r=i._element;var o=i._serviceUrlDelete;var l=i._$deleteModal;if(!l||l.length==0){return}l.on("hidden.bs.modal",function(){l.find(".alert-danger.error").remove()});r.find(".delete-link").on("click",function(e){e.preventDefault();var t=k(this).closest(".note");var a=t.data("id");if(!a||a==""){console.log("Failed to launch delete note dialog. Data parameter 'id' is null.");return}var n=l.find(".modal-footer button.primary");n.unbind("click");n.on("click",function(){k(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var e={};e.id=a;var t=JSON.stringify(e);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:t}).done(function(){i._deleteSuccess=true;r.trigger("refresh");l.modal("hide")}).fail(function(e){g(d(e),l)}).always(function(){n.removeAttr("disabled","disabled").find(".fa-spin").remove()})});l.modal()})};c.prototype.addNote=function(t){var e=this;var a=e._element;var n=e._target;var i=e._serviceUrlAdd;var r=this._attachmentAcceptTypes;var o=t.find(".modal-footer button.primary");var l=t.find("textarea").val();var d=false;if(i==null||i==""){var s={Message:"System Error",InnerError:{Message:window.ResourceManager["URL_Service_For_Add_Note_Request_Could_Not_Determined"]}};g(s,t);return}if(l==null||!/\S+/gm.test(l)){var c=t.find("#note_label");if(c){var f={Message:window.ResourceManager["Required_Field_Error"].replace("{0}",c.text())};g(f,t)}return}var u=a.attr("disable-validation");if(u=="true"){l=k("<div/>").text(l).html()}var p=t.find("input[type='checkbox']");if(p.length>0){d=p.prop("checked")}var v=t.find("input[type='file']");o.attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var m=k("<form>").attr("id","add-note-"+(new Date).getTime()).attr("method","POST").attr("action",i).hide().appendTo(k("body"));k("<input>").attr("name","regardingEntityLogicalName").attr("type","hidden").appendTo(m).val(n.LogicalName);k("<input>").attr("name","regardingEntityId").attr("type","hidden").appendTo(m).val(n.Id);k("<input>").attr("name","text").attr("type","hidden").appendTo(m).val(l);k("<input>").attr("name","isPrivate").attr("type","hidden").appendTo(m).val(d);k("<input>").attr("name","attachmentSettings").attr("type","hidden").appendTo(m).val(e._attachmentSettings);var h=k("<input>").attr("type","file").attr("name","file").attr("accept",r).insertAfter(v);v.appendTo(m);m.submit(function(){shell.ajaxSafePost({success:function(){e._addSuccess=true;a.trigger("refresh");t.modal("hide");m.remove();o.removeAttr("disabled","disabled").find(".fa-spin").remove()},error:function(e){g({Message:e.statusText},t);v.insertAfter(h);h.remove();m.remove();o.removeAttr("disabled","disabled").find(".fa-spin").remove()}},k(this));return false});m.submit()};c.prototype.updateNote=function(t){var e=this;var a=e._element;var n=e._serviceUrlEdit;var i=t.find(".modal-footer button.primary");var r=t.find("textarea").val();var o=t.data("subject")||"";var l=false;if(n==null||n==""){var d={Message:"System Error",InnerError:{Message:window.ResourceManager["URL_Service_For_Update_Note_Request_Could_Not_Determined"]}};g(d,t);return}var s=t.data("id");if(!s||s==""){var c={Message:"System Error",InnerError:{Message:window.ResourceManager["Failed_Determine_RecordID"]}};g(c,t);return}if(r==null||!/\S+/gm.test(r)){var f=t.find("#note_label");if(f){var u={Message:window.ResourceManager["Required_Field_Error"].replace("{0}",f.text())};g(u,t)}return}var p=t.find("input[type='checkbox']");if(p.length>0){l=p.prop("checked")}var v=t.find("input[type='file']");i.attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var m=k("<form>").attr("id","update-note-"+(new Date).getTime()).attr("method","POST").attr("action",n).hide().appendTo(k("body"));k("<input>").attr("name","id").attr("type","hidden").appendTo(m).val(s);k("<input>").attr("name","subject").attr("type","hidden").appendTo(m).val(o);k("<input>").attr("name","text").attr("type","hidden").appendTo(m).val(r);k("<input>").attr("name","isPrivate").attr("type","hidden").appendTo(m).val(l);k("<input>").attr("name","attachmentSettings").attr("type","hidden").appendTo(m).val(e._attachmentSettings);var h=k("<input>").attr("type","file").attr("name","file").insertAfter(v);v.appendTo(m);m.submit(function(){shell.ajaxSafePost({success:function(){e._editSuccess=true;a.trigger("refresh");t.modal("hide");m.remove();i.removeAttr("disabled","disabled").find(".fa-spin").remove()},error:function(e){g({Message:e.statusText},t);v.insertAfter(h);h.remove();m.remove();i.removeAttr("disabled","disabled").find(".fa-spin").remove()}},k(this));return false});m.submit()};c.prototype.initializePagination=function(e){if(typeof e===typeof undefined||e===false||e==null){return}if(typeof e.PageSize===typeof undefined||e.PageSize===false||e.PageSize==null||(typeof e.PageCount===typeof undefined||e.PageCount===false||e.PageCount==null)||(typeof e.PageNumber===typeof undefined||e.PageNumber===false||e.PageNumber==null)||(typeof e.ItemCount===typeof undefined||e.ItemCount===false||e.ItemCount==null)){return}var n=this;var t=n._element;var a=t.find(".notes-pagination");if(e.PageCount<=1){a.hide();return}a.data("pagesize",e.PageSize).data("pages",e.PageCount).data("current-page",e.PageNumber).data("count",e.ItemCount).unbind("click").pagination({total_pages:a.data("pages"),current_page:a.data("current-page"),callback:function(e,t){e.preventDefault();var a=k(e.target).closest("li");if(a.not(".disabled").length>0&&a.not(".active").length>0){n.load(t)}}}).show()};function g(e,t){if(typeof e!==typeof undefined&&e!==false&&e!=null){if(typeof console!="undefined"&&console){console.log(e)}var a=t.find(".modal-body");var n=t.find(".alert-danger.error");if(n.length==0){n=k("<div></div>").addClass("alert alert-block alert-danger error clearfix")}else{n.empty()}var i=k("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span></p>");if(typeof e.InnerError!==typeof undefined&&typeof e.InnerError.Message!==typeof undefined&&e.InnerError.Message!==false&&e.InnerError.Message!=null){n.append(i).text(e.InnerError.Message+(typeof e.InnerError.Message==="number"?" Error":""))}else if(typeof e.Message!==typeof undefined&&e.Message!==false&&e.Message!=null){n.append(i).text(e.Message+(typeof e.Message==="number"?" Error":""))}a.prepend(n)}}function d(e){var t={Message:window.ResourceManager["UnKnown_Error_Occurred"]};if(e==null)return t;try{var a=e.getResponseHeader("content-type");if(a!=null){t=a.indexOf("json")>-1?k.parseJSON(e.responseText):{Message:e.status,InnerError:{Message:e.statusText}}}else{t={Message:e.statusText}}}catch(e){t={Message:e.message}}return t}})(jQuery);(function(g){var e=null;function a(e){this._element=g(e);this._layout=null;var t=this._element;var a=t.closest(".entity-form");if(a.length<1){var n=t.closest(".crmEntityFormView");a=n.find(".entity-form")}if(a.length==0)return;var i=a.find("[id$='_EntityLayoutConfig']");if(i.length==0)return;this._layout=i.data("form-layout")}var r=null;var o=null;g(document).ready(function(){g(".form-custom-actions").each(function(){var e=g(this).find(".submit-btn");if(e.length>0){r=e[0].value;postBackOnSubmit=WebForm_DoPostBackWithOptions;o=g(this)}new a(g(this)).render()});g("div.actions").each(function(){var e=g(this).find(".submit-btn");if(e.length>0){r=g(this).find(".submit-btn")[0].value;postBackOnSubmit=WebForm_DoPostBackWithOptions;o=g(this)}});g(".form-custom-actions .dropdown-toggle").each(function(){var e=g(this).parent().find(".dropdown-menu");var t=e.find("a:not(.hidden)").length;if(t<1){g(this).parent().hide()}});g(".crmEntityFormView").attr("role","main");var e=g(".page-header h1").text();var t=window.ResourceManager["Entity_Form_Label"];g(".crmEntityFormView").attr("aria-label",e||t)});function i(){var e=[];var t=this._layout;if(t&&t.TopFormActionLinks&&t.TopFormActionLinks.length&&(t.BottomFormActionLinks&&t.BottomFormActionLinks.length)){e=_.union(t.TopFormActionLinks,t.BottomFormActionLinks)}else if(t&&t.TopFormActionLinks&&t.TopFormActionLinks.length){e=t.TopFormActionLinks}else if(t){e=t.BottomFormActionLinks}return e}function t(e,t){t=URI(t);var a=e.data("ref-entity");var n=e.data("ref-id");var i=e.data("ref-rel");var r=e.data("ref-rel-role");if(a&&n&&i){t.addSearch("refentity",a);t.addSearch("refid",n);t.addSearch("refrel",i);if(r){t.addSearch("refrelrole",r)}}return t.toString()}function v(e,t,a,n){e=URI(e);if(t&&a&&n){e.addSearch("refentity",t);e.addSearch("refid",a);e.addSearch("refrel",n)}return e.toString()}a.prototype.render=function(){var e=this;var t=e._element;var a=e._layout;if(typeof a===typeof undefined||a==null||a==""){t.hide()}var n=e.addDeleteActionLinkClickEventHandlers();var i=e.addWorkflowActionLinkClickEventHandlers();var r=e.addQualifyLeadActionLinkClickEventHandlers();var o=e.addCloseCaseActionLinkClickEventHandlers();var l=e.addResolveCaseActionLinkClickEventHandlers();var d=e.addReopenCaseActionLinkClickEventHandlers();var s=e.addCancelCaseActionLinkClickEventHandlers();var c=e.addConvertQuoteActionLinkClickEventHandlers();var f=e.addConvertOrderActionLinkClickEventHandlers();var u=e.addCalculateOpportunityActionLinkClickEventHandlers();var p=e.addActivateActionLinkClickEventHandlers();var v=e.addDeactivateActionLinkClickEventHandlers();var m=e.addActivateQuoteActionLinkClickEventHandlers();var h=e.addSetOpportunityOnHoldActionLinkClickEventHandlers();var g=e.addReopenOpportunityActionLinkClickEventHandlers();var y=e.addWinOpportunityActionLinkClickEventHandlers();var b=e.addLoseOpportunityActionLinkClickEventHandlers();var C=e.addGenerateQuoteFromOpportunityActionLinkClickEventHandlers();var k=e.addUpdatePipelinePhaseActionLinkClickEventHandlers();var _=e.addSubmitActionLinkClickEventHandlers();var w=e.addNextActionLinkClickEventHandlers();var L=e.addPreviousActionLinkClickEventHandlers();var S=e.addCreateRelatedRecordClickEventHandlers();if((n||i||r||o||l||d||s||c||f||u||p||v||m||h||y||b||C||k||g||_||w||L)&&a!=null&&(a.EnableActions||_||w||L||S)){t.show()}else{t.hide()}};a.prototype.addDeleteActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var n=e._layout;if(n==null||n==""||n.DeleteActionLink==null||!n.DeleteActionLink.Enabled||!n.DeleteActionLink.URL){var a=t.find(".delete-link");a.hide();a.addClass("hidden");return false}var i=n.DeleteActionLink.URL.PathWithQueryString;var r=t.children(".modal-delete");var o=t.closest(".entity-form");if(o.length<1){var l=t.closest(".crmEntityFormView");o=l.find(".entity-form")}var d=o.find("[id$='_EntityID']").val();var s=r.find("button.primary");s.off("click");s.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");o.find(".navbar-collapse").find(".action-status").html("<span class='fa fa-spinner fa-spin fa-fw' aria-hidden='true'></span>");var t={};t.LogicalName=n.EntityName;t.Id=d;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:i,data:a}).done(function(){r.modal("hide");y(n.DeleteActionLink.SuccessMessage);C(n.DeleteActionLink,true)}).fail(function(e){r.modal("hide");b(k(e),o)}).always(function(){s.removeAttr("disabled","disabled").find(".fa-spin").remove()})});t.find(".delete-link").on("click",function(e){e.preventDefault();r.modal()});return true};postBackOnSubmit=null;SubmitModal=function(){return n()};function n(){if(typeof Page_ClientValidate=="undefined"||typeof Page_ClientValidate=="function"&&typeof Page_IsValid!="undefined"&&Page_IsValid){var t=o;var a=t.children(".modal-submit");var e=a.find("button.primary");var n=a.find("button.cancel");var i=a.find("button.form-close");e.off("click").on("click",function(){a.modal("hide");var e=t.find(".submit-btn").attr("name");postBackOnSubmit(new WebForm_PostBackOptions(e,"",true,"","",false,true))});n.off("click").on("click",function(){t.find(".submit-btn").removeAttr("disabled");t.find(".submit-btn")[0].value=r});i.off("click").on("click",function(){t.find(".submit-btn").removeAttr("disabled");t.find(".submit-btn")[0].value=r});a.modal("show")}return false}a.prototype.addSubmitActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var a=e._layout;if(a==null||a==""||a.SubmitActionLink==null||!a.SubmitActionLink.Enabled){var n=t.find(".submit-btn");n.addClass("hidden");n.hide();return false}return true};a.prototype.addNextActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var a=e._layout;if(a==null||a==""||a.NextActionLink==null||!a.NextActionLink.Enabled){var n=t.find(".next-btn");n.addClass("hidden");n.hide();return false}return true};a.prototype.addPreviousActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var a=e._layout;if(a==null||a==""||a.PreviousActionLink==null||!a.PreviousActionLink.Enabled){var n=t.find(".previous-btn");n.addClass("hidden");n.hide();return false}return true};a.prototype.addWorkflowActionLinkClickEventHandlers=function(){var e=this;var n=e._element;var v=e._layout;var m=n.closest(".entity-form");if(m.length<1){var t=n.closest(".crmEntityFormView");m=t.find(".entity-form")}if(!v){return false}var h=i.call(e);if(h&&h.length){g.each(h,function(e,t){if(t.Type==7){if(t.Enabled){var a=n.find(".workflow-link[data-filtercriteriaid = '"+t.FilterCriteriaId+"']");if(t.ShowModal===1){var p=n.children(".modal-run-workflow");a.on("click",function(e){e.preventDefault();p.attr("aria-hidden","false");var d=m.find("[id$='_EntityID']").val();var s=p.find("button.primary");var t=p.find("button.cancel");var a=p.find("button.close");var n=g(this);var c=g(this).data("url");var f=g(this).data("workflowid");var u=g(this).data("filtercriteriaid");if(!f||!c){return}var i=g(this).data("modal-title");if(i){p.find(".modal-title").html(i).attr("title",i)}p.parent().find("section").attr("aria-label",i);var r=g(this).data("modal-confirmation");if(r){p.find(".modal-body").html(r)}var o=g(this).data("modal-primary-action");if(o){s.html(o);s.attr("title",o);s.attr("aria-label",o)}var l=g(this).data("modal-cancel-action");if(l){p.find(".cancel").html(l)}s.off("click");s.on("click",function(e){e.preventDefault();p.attr("aria-hidden","true");g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t=null;for(var a=0;a<h.length;a++){var n=h[a];if(n!=null&&typeof n.Type!==typeof undefined&&n.Type==7&&typeof n.Workflow!==typeof undefined&&n.Workflow!=null&&n.Workflow.Id==f&&typeof n.FilterCriteriaId!=typeof undefined&&n.FilterCriteriaId==u){t=n;break}}var i={};var r={};r.LogicalName="workflow";r.Id=f;i.workflow=r;var o={};o.LogicalName=v.EntityName;o.Id=d;i.entity=o;var l=JSON.stringify(i);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:c,data:l}).done(function(){p.modal("hide");y(t!=null?t.SuccessMessage:null);C(t)}).fail(function(e){p.modal("hide");b(k(e),m)}).always(function(){s.removeAttr("disabled","disabled").find(".fa-spin").remove()})});t.on("click",function(e){p.attr("aria-hidden","true")});a.on("click",function(e){p.attr("aria-hidden","true")});p.modal();p.on("shown.bs.modal",function(){p.find("button.primary").focus()});p.on("hidden.bs.modal",function(){if(n.is(":visible")){n.trigger("focus")}})})}else{a.on("click",function(e){e.preventDefault();var t=m.find("[id$='_EntityID']").val();var a=g(this).data("workflowid");var n=g(this).data("filtercriteriaid");var i=g(this).data("url");if(!a||!i){return}var r=null;for(var o=0;o<h.length;o++){var l=h[o];if(l!=null&&typeof l.Type!==typeof undefined&&l.Type==7&&typeof l.Workflow!==typeof undefined&&l.Workflow!=null&&l.Workflow.Id==a&&typeof l.FilterCriteriaId!=typeof undefined&&l.FilterCriteriaId==n){r=l;break}}var d={};var s={};s.LogicalName="workflow";s.Id=a;d.workflow=s;var c={};c.LogicalName=v.EntityName;c.Id=t;d.entity=c;var f=JSON.stringify(d);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:i,data:f}).done(function(){y(r!=null?r.SuccessMessage:null);C(r,true)}).fail(function(e){b(k(e),m)})})}}else{n.find(".workflow-link[data-filtercriteriaid = '"+t.FilterCriteriaId+"']").hide();n.find(".workflow-link[data-filtercriteriaid = '"+t.FilterCriteriaId+"']").addClass("hidden")}}})}else{n.find(".workflow-link").hide();return false}return true};a.prototype.addQualifyLeadActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.QualifyLeadActionLink==null||!l.QualifyLeadActionLink.Enabled||!l.QualifyLeadActionLink.URL||n!="0"){var i=t.find(".qualify-lead-link");i.addClass("hidden");i.hide();return false}if(l.QualifyLeadActionLink.ShowModal==1){var s=t.children(".modal-qualify");t.find(".qualify-lead-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.createAccount=true;t.createContact=true;t.createOpportunity=true;var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.QualifyLeadActionLink.SuccessMessage);C(l.QualifyLeadActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});s.modal()})}else{t.find(".qualify-lead-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};n.createAccount=true;n.createContact=true;n.createOpportunity=true;var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.QualifyLeadActionLink.SuccessMessage);C(l.QualifyLeadActionLink)}).fail(function(e){b(k(e),d)})})}return true};a.prototype.addCloseCaseActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var s=e._layout;var c=t.closest(".entity-form");if(c.length<1){var a=t.closest(".crmEntityFormView");c=a.find(".entity-form")}var n=c.find("[id$='_EntityState']").val();if(s==null||s==""||s.CloseIncidentActionLink==null||!s.CloseIncidentActionLink.Enabled||!s.CloseIncidentActionLink.URL||n!="0"){var i=t.find(".close-case-link");i.addClass("hidden");i.hide();return false}if(s.CloseIncidentActionLink.ShowModal==1){var f=t.children(".modal-closecase");t.find(".close-case-link").on("click",function(e){e.preventDefault();var o=c.find("[id$='_EntityID']").val();var l=f.find("button.primary");var d=g(this).data("url");l.off("click");l.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=s.EntityName;a.Id=o;t.entityReference=a;var n=s.CloseIncidentActionLink.DefaultResolution;var i=s.CloseIncidentActionLink.DefaultResolutionDescription;t.resolutionSubject=n;t.resolutionDescription=i;var r=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:r}).done(function(){f.modal("hide");y(s.CloseIncidentActionLink.SuccessMessage);C(s.CloseIncidentActionLink)}).fail(function(e){f.modal("hide");b(k(e),c)}).always(function(){l.removeAttr("disabled","disabled").find(".fa-spin").remove()})});f.modal()});f.on("show.bs.modal",function(){f.attr("aria-hidden","false")});f.on("hidden.bs.modal",function(){f.attr("aria-hidden","true")})}else{t.find(".close-case-link").on("click",function(e){e.preventDefault();var t=c.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=s.EntityName;i.Id=t;n.entityReference=i;var r=s.CloseIncidentActionLink.DefaultResolution;var o=s.CloseIncidentActionLink.DefaultResolutionDescription;n.resolutionSubject=r;n.resolutionDescription=o;var l=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:l}).done(function(){y(s.CloseIncidentActionLink.SuccessMessage);C(s.CloseIncidentActionLink)}).fail(function(e){b(k(e),c)})})}return true};a.prototype.addConvertQuoteActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.ConvertQuoteToOrderActionLink==null||!l.ConvertQuoteToOrderActionLink.Enabled||!l.ConvertQuoteToOrderActionLink.URL||n!="1"){var i=t.find(".convert-quote-link");i.addClass("hidden");i.hide();return false}if(l.ConvertQuoteToOrderActionLink.ShowModal==1){var s=t.children(".modal-convert-quote");t.find(".convert-quote-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.ConvertQuoteToOrderActionLink.SuccessMessage);C(l.ConvertQuoteToOrderActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});s.modal()})}else{t.find(".convert-quote-link").on("click",function(e){e.preventDefault();var t=g(this);t.attr("disabled","disabled");t.closest("li.action").children(".dropdown-toggle").css("cursor","not-allowed").dropdown("toggle").removeAttr("data-toggle").off("click");t.closest(".navbar-collapse").find(".action-status").html("<span class='fa fa-spinner fa-spin fa-fw' aria-hidden='true'></span>");var a=d.find("[id$='_EntityID']").val();var n=g(this).data("url");var i={};var r={};r.LogicalName=l.EntityName;r.Id=a;i.entityReference=r;var o=JSON.stringify(i);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:n,data:o}).done(function(){y(l.ConvertQuoteToOrderActionLink.SuccessMessage);C(l.ConvertQuoteToOrderActionLink)}).fail(function(e){b(k(e),d)}).always(function(){t.removeAttr("disabled");t.closest("li.action").children(".dropdown-toggle").css("cursor","").attr("data-toggle","dropdown").data("toggle","dropdown").on("click",function(){g(this).dropdown()})})})}return true};a.prototype.addConvertOrderActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.ConvertOrderToInvoiceActionLink==null||!l.ConvertOrderToInvoiceActionLink.Enabled||!l.ConvertOrderToInvoiceActionLink.URL||n=="2"){var i=t.find(".convert-order-link");i.addClass("hidden");i.hide();return false}if(l.ConvertOrderToInvoiceActionLink.ShowModal==1){var s=t.children(".modal-convert-order");t.find(".convert-order-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.ConvertOrderToInvoiceActionLink.SuccessMessage);C(l.ConvertOrderToInvoiceActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});s.modal()})}else{t.find(".convert-order-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.ConvertOrderToInvoiceActionLink.SuccessMessage);C(l.ConvertOrderToInvoiceActionLink)}).fail(function(e){b(k(e),d)})})}return true};a.prototype.addCalculateOpportunityActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;if(l==null||l==""||l.CalculateOpportunityActionLink==null||!l.CalculateOpportunityActionLink.Enabled||!l.CalculateOpportunityActionLink.URL){var a=t.find(".calculate-opportunity-link");a.addClass("hidden");a.hide();return false}var d=t.closest(".entity-form");if(d.length<2){var n=t.closest(".crmEntityFormView");d=n.find(".entity-form")}if(l.CalculateOpportunityActionLink.ShowModal==1){var s=t.children(".modal-calculate");t.find(".calculate-opportunity-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.CalculateOpportunityActionLink.SuccessMessage);C(l.CalculateOpportunityActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});s.modal()})}else{t.find(".calculate-opportunity-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.CalculateOpportunityActionLink.SuccessMessage);C(l.CalculateOpportunityActionLink)}).fail(function(e){b(k(e),d)})})}return true};a.prototype.addResolveCaseActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var s=e._layout;var a=t.closest(".entity-form");if(a.length<1){var n=t.closest(".crmEntityFormView");a=n.find(".entity-form")}var i=a.find("[id$='_EntityState']").val();if(s==null||s==""||s.ResolveCaseActionLink==null||!s.ResolveCaseActionLink.Enabled||!s.ResolveCaseActionLink.URL||i!="0"){var r=t.find(".resolve-case-link");r.addClass("hidden");r.hide();return false}var c=t.children(".modal-resolvecase");c.on("hidden.bs.modal.entityform",function(){c.find(".resolution-input").val("");c.find(".resolution-description-input").val("");c.find(".alert-danger.error").remove()});t.find(".resolve-case-link").on("click",function(e){e.preventDefault();var o=a.find("[id$='_EntityID']").val();var l=c.find("button.primary");var d=g(this).data("url");l.off("click");l.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=s.EntityName;a.Id=o;t.entityReference=a;var n=c.find(".resolution-input");t.resolutionSubject=n.val();var i=c.find(".resolution-description-input");t.resolutionDescription=i.val();var r=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:r}).done(function(){c.modal("hide");y(s.ResolveCaseActionLink.SuccessMessage);C(s.ResolveCaseActionLink)}).fail(function(e){c.modal("show");f({Message:e.statusText},c)}).always(function(){l.removeAttr("disabled","disabled").find(".fa-spin").remove()})});c.modal()});return true};function f(e,t){if(typeof e!==typeof undefined&&e!==false&&e!=null){if(typeof console!="undefined"&&console){console.log(e)}var a=t.find(".modal-body");var n=t.find(".alert-danger.error");if(n.length==0){n=g("<div></div>").addClass("alert alert-block alert-danger error clearfix")}else{n.empty()}if(typeof e.InnerError!==typeof undefined&&typeof e.InnerError.Message!==typeof undefined&&e.InnerError.Message!==false&&e.InnerError.Message!=null){if(typeof e.InnerError.Message==="number"){n.append("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+e.InnerError.Message+" Error</p>")}else{n.append("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+e.InnerError.Message+"</p>")}}else if(typeof e.Message!==typeof undefined&&e.Message!==false&&e.Message!=null){if(typeof e.Message==="number"){n.append("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+e.Message+" Error</p>")}else{n.append("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+e.Message+"</p>")}}a.prepend(n)}}a.prototype.addReopenCaseActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.ReopenCaseActionLink==null||!l.ReopenCaseActionLink.Enabled||!l.ReopenCaseActionLink.URL||n=="0"){var i=t.find(".reopen-case-link");i.addClass("hidden");i.hide();return false}if(l.ReopenCaseActionLink.ShowModal==1){var s=t.children(".modal-reopencase");t.find(".reopen-case-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.ReopenCaseActionLink.SuccessMessage);C(l.ReopenCaseActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});s.modal()})}else{t.find(".reopen-case-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.ReopenCaseActionLink.SuccessMessage);C(l.ReopenCaseActionLink)}).fail(function(e){b(k(e),d)})})}return true};a.prototype.addCancelCaseActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.CancelCaseActionLink==null||!l.CancelCaseActionLink.Enabled||!l.CancelCaseActionLink.URL||n!="0"){var i=t.find(".cancel-case-link");i.addClass("hidden");i.hide();return false}if(l.CancelCaseActionLink.ShowModal==1){var s=t.children(".modal-cancelcase");t.find(".cancel-case-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.CancelCaseActionLink.SuccessMessage);C(l.CancelCaseActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});s.modal()});s.on("show.bs.modal",function(){s.attr("aria-hidden","false")});s.on("hidden.bs.modal",function(){s.attr("aria-hidden","true")})}else{t.find(".cancel-case-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.CancelCaseActionLink.SuccessMessage);C(l.CancelCaseActionLink)}).fail(function(e){b(k(e),d)})})}return true};a.prototype.addActivateActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.ActivateActionLink==null||!l.ActivateActionLink.Enabled||!l.ActivateActionLink.URL||n=="0"){var i=t.find(".activate-link");i.addClass("hidden");i.hide();return false}if(l.ActivateActionLink.ShowModal==1){var s=t.children(".modal-activate");t.find(".activate-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.ActivateActionLink.SuccessMessage);C(l.ActivateActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});s.modal()})}else{t.find(".activate-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.ActivateActionLink.SuccessMessage);C(l.ActivateActionLink)}).fail(function(e){b(k(e),d)})})}return true};a.prototype.addDeactivateActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.DeactivateActionLink==null||!l.DeactivateActionLink.Enabled||!l.DeactivateActionLink.URL||n=="1"){var i=t.find(".deactivate-link");i.addClass("hidden");i.hide();return false}if(l.DeactivateActionLink.ShowModal==1){var s=t.children(".modal-deactivate");t.find(".deactivate-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.DeactivateActionLink.SuccessMessage);C(l.DeactivateActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});s.modal()})}else{t.find(".deactivate-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.DeactivateActionLink.SuccessMessage);C(l.DeactivateActionLink)}).fail(function(e){b(k(e),d)})})}return true};a.prototype.addActivateQuoteActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.ActivateQuoteActionLink==null||!l.ActivateQuoteActionLink.Enabled||!l.ActivateQuoteActionLink.URL||n!="0"){var i=t.find(".activate-quote-link");i.addClass("hidden");i.hide();return false}if(l.ActivateQuoteActionLink.ShowModal==1){var s=t.children(".modal-activate-quote");t.find(".activate-quote-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.ActivateQuoteActionLink.SuccessMessage);C(l.ActivateQuoteActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});s.modal()})}else{t.find(".activate-quote-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.ActivateQuoteActionLink.SuccessMessage);C(l.ActivateQuoteActionLink)}).fail(function(e){b(k(e),d)})})}return true};a.prototype.addSetOpportunityOnHoldActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();var i=d.find("[id$='_EntityStatus']").val();if(l==null||l==""||l.SetOpportunityOnHoldActionLink==null||!l.SetOpportunityOnHoldActionLink.Enabled||!l.SetOpportunityOnHoldActionLink.URL||n!="0"||i=="2"){var r=t.find(".set-opportunity-on-hold-link");r.addClass("hidden");r.hide();return false}if(l.SetOpportunityOnHoldActionLink.ShowModal==1){var s=t.children(".modal-set-opportunity-on-hold");t.find(".set-opportunity-on-hold-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.SetOpportunityOnHoldActionLink.SuccessMessage);C(l.SetOpportunityOnHoldActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});s.modal()})}else{t.find(".set-opportunity-on-hold-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.SetOpportunityOnHoldActionLink.SuccessMessage);C(l.SetOpportunityOnHoldActionLink)}).fail(function(e){b(k(e),d)}).always(function(){})})}return true};a.prototype.addReopenOpportunityActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();var i=d.find("[id$='_EntityStatus']").val();if(l==null||l==""||l.ReopenOpportunityActionLink==null||!l.ReopenOpportunityActionLink.Enabled||!l.ReopenOpportunityActionLink.URL||n=="0"){var r=t.find(".reopen-opportunity-link");r.addClass("hidden");r.hide();return false}if(l.ReopenOpportunityActionLink.ShowModal==1){var s=t.children(".modal-reopen-opportunity");t.find(".reopen-opportunity-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.ReopenOpportunityActionLink.SuccessMessage);C(l.ReopenOpportunityActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});s.modal()})}else{t.find(".reopen-opportunity-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.ReopenOpportunityActionLink.SuccessMessage);C(l.ReopenOpportunityActionLink)}).fail(function(e){b(k(e),d)}).always(function(){})})}return true};a.prototype.addWinOpportunityActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.WinOpportunityActionLink==null||!l.WinOpportunityActionLink.Enabled||!l.WinOpportunityActionLink.URL||n!="0"){var i=t.find(".win-opportunity-link");i.addClass("hidden");i.hide();return false}if(l.WinOpportunityActionLink.ShowModal==1){var s=t.children(".modal-win-opportunity");t.find(".win-opportunity-link").on("click",function(e){e.preventDefault();s.attr("aria-hidden","false");var t=s.attr("aria-label");if(t){s.attr("aria-label",m(t))}var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();s.attr("aria-hidden","true");g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.WinOpportunityActionLink.SuccessMessage);C(l.WinOpportunityActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});s.on("hide.bs.modal",function(e){g(this).attr("aria-hidden","true")});s.modal()})}else{t.find(".win-opportunity-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.WinOpportunityActionLink.SuccessMessage);C(l.WinOpportunityActionLink)}).fail(function(e){b(k(e),d)}).always(function(){})})}return true};a.prototype.addLoseOpportunityActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.LoseOpportunityActionLink==null||!l.LoseOpportunityActionLink.Enabled||!l.LoseOpportunityActionLink.URL||n!="0"){var i=t.find(".lose-opportunity-link");i.addClass("hidden");i.hide();return false}if(l.LoseOpportunityActionLink.ShowModal==1){var s=t.children(".modal-lose-opportunity");t.find(".lose-opportunity-link").on("click",function(e){e.preventDefault();s.attr("aria-hidden","false");var t=s.attr("aria-label");if(t){s.attr("aria-label",m(t))}var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();s.attr("aria-hidden","true");g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.LoseOpportunityActionLink.SuccessMessage);C(l.LoseOpportunityActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});s.on("hide.bs.modal",function(e){g(this).attr("aria-hidden","true")});s.modal()})}else{t.find(".lose-opportunity-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.LoseOpportunityActionLink.SuccessMessage);C(l.LoseOpportunityActionLink)}).fail(function(e){b(k(e),d)}).always(function(){})})}return true};a.prototype.addGenerateQuoteFromOpportunityActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.GenerateQuoteFromOpportunityActionLink==null||!l.GenerateQuoteFromOpportunityActionLink.Enabled||!l.GenerateQuoteFromOpportunityActionLink.URL||n!="0"){var i=t.find(".generate-quote-from-opportunity-link");i.addClass("hidden");i.hide();return false}if(l.GenerateQuoteFromOpportunityActionLink.ShowModal==1){var s=t.children(".modal-generate-quote-from-opportunity");t.find(".generate-quote-from-opportunity-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.GenerateQuoteFromOpportunityActionLink.SuccessMessage);C(l.GenerateQuoteFromOpportunityActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});s.modal()})}else{t.find(".generate-quote-from-opportunity-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.GenerateQuoteFromOpportunityActionLink.SuccessMessage);C(l.GenerateQuoteFromOpportunityActionLink)}).fail(function(e){b(k(e),d)})})}return true};a.prototype.addUpdatePipelinePhaseActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var c=e._layout;var f=t.closest(".entity-form");if(f.length<1){var a=t.closest(".crmEntityFormView");f=a.find(".entity-form")}var n=f.find("[id$='_EntityState']").val();if(c==null||c==""||c.UpdatePipelinePhaseActionLink==null||!c.UpdatePipelinePhaseActionLink.Enabled||!c.UpdatePipelinePhaseActionLink.URL||n!="0"){var i=t.find(".update-pipeline-phase-link");i.addClass("hidden");i.hide();return false}var u=t.children(".modal-updatepipelinephase");t.find(".update-pipeline-phase-link").on("click",function(e){e.preventDefault();var l=f.find("[id$='_EntityID']").val();var d=u.find("button.primary");var s=g(this).data("url");d.off("click");d.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=c.EntityName;a.Id=l;t.entityReference=a;var n=u.find(".pipelinephase-input");t.salesStage=n.val();var i=n.find("option:selected");t.stepName=i.text();var r=u.find(".resolution-description-input");t.description=r.val();var o=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:s,data:o}).done(function(){u.modal("hide");y(c.UpdatePipelinePhaseActionLink.SuccessMessage);C(c.UpdatePipelinePhaseActionLink)}).fail(function(e){u.modal("hide");b(k(e),f)}).always(function(){d.removeAttr("disabled","disabled").find(".fa-spin").remove()})});u.modal()});return true};a.prototype.addCreateRelatedRecordClickEventHandlers=function(){var e=this;var f=e._element;var u=e._layout;var p=f.closest(".entity-form");if(p.length<1){var t=f.closest(".crmEntityFormView");p=t.find(".entity-form")}if(!u||!u.CreateRelatedRecordActionLink){return false}window.addEventListener("message",function(e){if(e.data=="Success"){f.children(".modal-form").modal("hide")}});var a=i.call(e);if(a&&a.length){g.each(a,function(e,c){if(c.Type===29){if(c.Enabled){if(u.CreateRelatedRecordActionLink.ShowModal===1){var t=f.find(".create-related-record-link[data-filtercriteriaid = '"+c.FilterCriteriaId+"']");t.on("click",function(e){e.preventDefault();var t=f.children(".modal-form-createrecord[data-filtercriteriaid = '"+c.FilterCriteriaId+"']");t.attr("aria-hidden","false");var a=t.attr("aria-label");if(a){t.attr("aria-label",m(a))}var n=p.find("[id$='_EntityID']").val();var i=t.find("iframe");var r=i.data("page");var o=c.Relationship;var l=c.EntityForm.Id;var d=r+"?id="+n+"&entityformid="+l+"&languagecode="+u.LanguageCode;var s=v(d,u.EntityName,n,o);i.attr("src",s);i.on("load",function(){t.find(".form-loading").hide();t.find("iframe").contents().find("#EntityFormControl").show()});t.find(".form-loading").show();t.find("iframe").contents().find("#EntityFormControl").hide();t.on("hide.bs.modal",function(e){g(this).attr("aria-hidden","true")});t.modal()})}else{f.find(".create-related-record-link[data-filtercriteriaid = '"+c.FilterCriteriaId+"']").on("click",function(e){e.preventDefault();var t=p.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=u.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(u.CreateRelatedRecordActionLink.SuccessMessage);C(u.CreateRelatedRecordActionLink)}).fail(function(e){b(k(e),p)}).always(function(){})})}}else{var a=f.find(".create-related-record-link[data-filtercriteriaid = '"+c.FilterCriteriaId+"']");a.addClass("hidden");a.hide()}}})}else{return false}return true};function y(e){g.cookie("adx-notification",e,{expires:1,path:"/"})}function b(e,t){if(typeof e!==typeof undefined&&e!==false&&e!=null){console.log(e);var a;if(typeof e.InnerError!==typeof undefined&&e.InnerError!==false&&e.InnerError!=null){a=e.InnerError.Message}else{a=e.Message}var n=g(".notifications");if(n.length==0){var i=g(".page-heading");if(i.length==0){n=g("<div class='notifications'></div>").prependTo(g("#content-container"))}else{n=g("<div class='notifications'></div>").appendTo(i)}}n.find(".notification").slideUp().remove();var r=t.find(".navbar-collapse").find(".action-status");if(r.length==0)r=t.parent().find(".navbar-collapse").find(".action-status");r.html("<span class='fa fa-fw fa-exclamation-circle text-danger' aria-hidden='true'></span>");var o=g("<div class='notification alert alert-danger error alert-dismissible' role='alert'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+a+"</div>").on("closed.bs.alert",function(){r.html("<span class='fa fa-fw' aria-hidden='true'></span>");if(n.find(".notification").length==0)n.hide()}).prependTo(n);n.show();g("html, body").animate({scrollTop:o.length?o.offset().top-20:0},200)}}function l(e,t,a){var n=g(".notifications");if(n.length==0){var i=g(".page-heading");if(i.length==0){n=g("<div class='notifications'></div>").prependTo(g("#content-container"))}else{n=g("<div class='notifications'></div>").appendTo(i)}}n.find(".notification").slideUp().remove();if(typeof e!==typeof undefined&&e!==false&&e!=null&&e!=""){var r=t.find(".navbar-collapse").find(".action-status");if(r.length==0)r=t.parent().find(".navbar-collapse").find(".action-status");r.html("<span class='fa fa-fw fa-check-circle text-success' aria-hidden='true'></span>");var o=g("<div class='notification alert alert-success success alert-dismissible' role='alert'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button>"+e+"</div>").on("closed.bs.alert",function(){r.html("<span class='fa fa-fw' aria-hidden='true'></span>");if(n.find(".notification").length==0)n.hide()}).prependTo(n);n.show();g("html, body").animate({scrollTop:o.length?o.offset().top-20:0},200);if(a){setTimeout(function(){o.slideUp(100).remove();if(n.find(".notification").length==0)n.hide()},5e3)}}}function C(e,t){if(typeof e==typeof undefined||e==null){s(t);return}var a=0;var n=1;var i=2;var r=typeof e.OnComplete!=typeof undefined&&e.OnComplete!=null&&e.OnComplete!=a;if(r){var o=c(e);if(o!=null&&o!=""){g.cookie("adx-notification",null);d(o)}else{s(t)}}else{s(t)}}function d(e){if(typeof e=="undefined"||e==null||e=="")return;g.blockUI({css:{border:"none",backgroundColor:"transparent",opacity:.5,color:"#fff"},message:"<span class='fa fa-2x fa-spinner fa-pulse' aria-hidden='true'></span>"});if(parent){parent.location.replace(e)}else{window.location.replace(e)}}function s(e){g.blockUI({css:{border:"none",backgroundColor:"transparent",opacity:.5,color:"#fff"},message:"<span class='fa fa-2x fa-spinner fa-pulse' aria-hidden='true'></span>"});if(e&&parent){if(parent.location.href.indexOf("#")!=-1){parent.location.reload(true)}else{parent.location=parent.location.href}}else{if(location.href.indexOf("#")!=-1){window.location.reload(true)}else{window.location=window.location.href}}}function c(e){if(!e||!e.RedirectUrl)return null;if(e.RedirectUrl.Host==window.location.hostname){return URI(e.RedirectUrl.PathWithQueryString)}else{return URI(e.RedirectUrl.Uri)}}function k(e){var t={Message:window.ResourceManager["UnKnown_Error_Occurred"]};if(e==null)return t;try{var a=e.getResponseHeader("content-type");if(a!=null){t=a.indexOf("json")>-1?g.parseJSON(e.responseText):{Message:e.status,InnerError:{Message:e.statusText}}}else{t={Message:e.statusText}}}catch(e){t={Message:e.message}}return t}function m(e){return e.replace(/<(?:.|\n)*?>/gm,"")}})(jQuery);(function(ee){var e=0;var te=0;var ae=1;var ne=2;var w=false;var t=ee.cookie("adx-notification");if(typeof t!==typeof undefined&&t!=null){g(t,null,true);ee.cookie("adx-notification",null,{path:"/"})}function a(e){this._element=ee(e);this._layouts=this._element.data("view-layouts");this._gridClass=this._element.data("grid-class");this._serviceUrlForGet=this._element.data("get-url");this._deferLoading=this._element.data("defer-loading");this._enableActions=this._element.data("enable-actions");this._selectMode=this._element.data("select-mode");this._columnWidthStyle=this._element.data("column-width-style");this._applyRelatedRecordFilter=this._element.data("apply-related-record-filter");this._filterRelationshipName=this._element.data("filter-relationship-name");this._filterEntityName=this._element.data("filter-entity-name");this._filterAttributeName=this._element.data("filter-attribute-name");this._allowFilterOff=this._element.data("allow-filter-off");this._toggleFilterText=this._element.data("toggle-filter-text");this._userIsAuthenticated=this._element.data("user-isauthenticated");this._userParentAccountName=this._element.data("user-parent-account-name");this._toggleFilterDisplayName=this._element.data("toggle-filter-display-name");this._metaFilter=null;this._compact=this._element.closest("[data-entitygrid-layout]").data("entitygrid-layout")==="compact";this._messageEventHandler=this.createWindowMessageEventHandler();if(this._compact){this._element.addClass("entity-grid-compact")}var a=this;ee(e).on("refresh",function(){a.load()});ee(e).on("metafilter",function(e,t){a._metaFilter=t;a.resetPagination();a.load()})}ee(document).ready(function(){var e=ee(".entity-grid");e.each(function(){new a(ee(this)).render()});if(e.length===0){le(ee(".table-fluid"))}ee(".entitylist").on("click.entitylist",".entitylist-filter-option-breaker a",function(e){e.preventDefault();e.stopPropagation();var t=ee(this).data("collapsed");var a=ee(this).closest("ul");var n=a.data("pagesize");a.children("li.entitylist-filter-option").each(function(e){if(e>=n){if(t){ee(this).attr("aria-hidden","false")}else{ee(this).attr("aria-hidden","true")}}});ee(this).find(".fa").toggleClass("fa-caret-down",t).toggleClass("fa-caret-up",!t);ee(this).find(".expand-label").text(t?"Less":"More");ee(this).data("collapsed",!t)})});function ie(e,t){t=URI(t);var a=e.data("ref-entity");var n=e.data("ref-id");var i=e.data("ref-rel");var r=e.data("ref-rel-role");if(a&&n&&i){t.addSearch("refentity",a);t.addSearch("refid",n);t.addSearch("refrel",i);if(r){t.addSearch("refrelrole",r)}}return t.toString()}function re(e,t,a,n){e=URI(e);if(t&&a&&n){e.addSearch("refentity",t);e.addSearch("refid",a);e.addSearch("refrel",n)}return e.toString()}function oe(e){if(!e||!e.URL)return null;return i(e.URL)}function X(e,t){if(typeof e!==typeof undefined&&e!==false&&e!=null){console.log(e);var a;if(typeof e.InnerError!==typeof undefined&&e.InnerError!==false&&e.InnerError!=null){a=e.InnerError.Message}else{a=e.Message}var n=r(t);var i=ee("<div class='notification alert alert-danger error alert-dismissible' role='alert'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+a+"</div>").on("closed.bs.alert",function(){if(n.find(".notification").length==0)n.hide()}).prependTo(n);n.show();ee("html, body").animate({scrollTop:i.length?i.offset().top-20:0},200)}}a.prototype.render=function(e){var m=this;var h=m._element;var t=m._layouts;var a=m._gridClass;var n=h.data("selected-view");var i=m._deferLoading;var r=m._enableActions;var o=m._allowFilterOff;var l=m._toggleFilterText;var d=m._selectMode;var s=m._columnWidthStyle;var c=m._userIsAuthenticated;var f=m._userParentAccountName;var u=m._toggleFilterDisplayName;var p=0;if(typeof n!==typeof undefined&&n!==false&&n!=null&&n!=""){p=de(t,"Id",n);if(p==-1){p=0}}this._activeLayoutIndex=p;var g=t[p];var v=URI(window.location).search(true);var y=fe();m._metaFilter=v[g.Configuration.FilterSettings.FilterQueryStringParameterName||"mf"]||null;var b=c&&f&&f!=""&&(g.Configuration.FilterPortalUserAttributeName!=null&&g.Configuration.FilterPortalUserAttributeName!=""&&(g.Configuration.FilterAccountAttributeName!=null&&g.Configuration.FilterAccountAttributeName!=""));var C=h.children(".view-grid");C.empty();h.children(".view-toolbar").remove();var k=ee("<div></div>").addClass("view-toolbar").addClass("grid-actions").addClass("clearfix");var _=ee("<div></div>").addClass("pull-right").addClass("toolbar-actions");var w=false;if(o){var L=ee("<a></a>").attr("href","#").addClass("toggle-related-filter").data("placement","bottom").data("toggle","tooltip").addClass("btn btn-default").addClass("active").append(ee("<span></span>").addClass("fa").addClass("fa-filter").attr("aria-hidden","true")).append(ee("<span></span>").addClass("title").text(u)).on("click",function(e){e.preventDefault();ee(this).toggleClass("active");m.load(0,h.children(".view-toolbar").find(".view-filter-select").data("filter"),!ee(this).hasClass("active"))});if(l&&l!=""){L.attr("title",l).tooltip()}if(this._compact){L.addClass("btn-xs")}L.prependTo(k);w=true}var S=g.Configuration.Search;var A,E,T,N;if(S.Enabled){A=ee("<div></div>").addClass("input-group").addClass("pull-left").addClass("view-search").addClass("entitylist-search");E=ee("<button></button>").attr("type","button").attr("aria-label",window.ResourceManager["Search_Results"]).attr("title",window.ResourceManager["Search_Results"]).addClass("btn").addClass("btn-default").append(ee("<span></span>").addClass("sr-only").html("Search Results")).append(ee("<span></span>").addClass("fa").addClass("fa-search")).on("click",function(e){e.preventDefault();m.load(1)});T=ee("<div></div>").addClass("input-group-btn").attr("role","presentation").append(E);N=ee("<input/>").attr("placeholder",S.PlaceholderText).data("toggle","tooltip").attr("title",S.TooltipText).attr("aria-label",S.TooltipText).tooltip().addClass("query").addClass("form-control").val("").on("keypress",function(e){var t=e.keyCode?e.keyCode:e.which;if(t=="13"){e.preventDefault();E.trigger("click");ee(this).trigger("focus")}})}if(r){window.removeEventListener("message",m._messageEventHandler);window.addEventListener("message",m._messageEventHandler)}h.children(".modal-form-details").on("hidden.bs.modal.entitygrid",function(){var e=ee(this).find("iframe");e.attr("src","")});h.children(".modal-form-edit").on("hidden.bs.modal.entitygrid",function(){var e=ee(this).find("iframe");e.attr("src","")});h.children(".modal-form-createrecord").on("hidden.bs.modal.entitygrid",function(){var e=ee(this).find("iframe");e.attr("src","")});var O=h.closest(".entity-form").find("[id$='_EntityState']").val();var I=typeof O!=typeof undefined&&O!=null&&O!==""&&O!=="0";if(r&&g.Configuration.InsertActionLink.Enabled&&g.Configuration.InsertActionLink.URL&&!I){var x=ee("<a></a>").attr("href",oe(g.Configuration.InsertActionLink)).addClass("btn").addClass("insert-Action-link").addClass("btn-primary").addClass("pull-right").addClass("action").html(g.Configuration.InsertActionLink.Label).attr("title",g.Configuration.InsertActionLink.Tooltip);if(y)x.attr("target","_top");x.prependTo(k);w=true}var D=null;if(r){ee.each(g.Configuration.ViewActionLinks,function(e,o){if(!o.Enabled)return;switch(o.Type){case 3:if(I){return}var t="#";var a=h.data("ref-entity");var n=h.data("ref-id");var i=h.data("ref-rel");var r=h.data("ref-rel-role");var l="";if(a&&n&&i){l+="refentity="+a+"&refid="+n+"&refrel="+i;if(r){l+="&refrelrole="+r}}if((o.Target==ae||o.Target==ne)&&o.URL!=null){t=ie(h,URI(oe(o)).toString())}D=ee("<div></div>").addClass("input-group").addClass("pull-left");var d=ee("<a></a>").attr("href",t).addClass("btn").addClass("btn-primary").addClass("pull-right").addClass("action create-action").html(o.Label).attr("title",o.Tooltip);if(t!="#"&&y)d.attr("target","_top");if(o.Target==te&&o.EntityForm){var s=h.children(".modal-form-insert");s.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){s.attr("aria-hidden","true");var e=ee(this).find("iframe");e.attr("src","");d.trigger("focus")});d.on("click",function(e){e.preventDefault();var t=s.find("iframe");var a=t.data("page");var n=o.EntityForm.Id.toString();var i=ie(h,a+"?entityformid="+n+"&languagecode="+g.Configuration.LanguageCode);t.attr("src",i);t.on("load",function(){s.find(".form-loading").hide();s.find("iframe").contents().find("#EntityFormControl").show()});$liveNotificationDiv=ee("<div></div>").attr("aria-relevant","all").attr("aria-live","assertive").attr("id","notificationDiv").attr("class","loading-text");if(ee("#notificationDiv").length==0){D.append($liveNotificationDiv)}s.find(".form-loading").show();s.find("iframe").contents().find("#EntityFormControl").hide();s.modal();if(ee("#notificationDiv").length>0){ee("#notificationDiv").html("");ee("#notificationDiv").html(window.ResourceManager["Loading_Message"])}});s.on("show.bs.modal",function(){s.attr("aria-hidden","false")});s.on("hidden.bs.modal",function(){if(ee("#notificationDiv").length>0){ee("#notificationDiv").remove()}})}if(m._compact){d.addClass("btn-xs")}D.append(d).appendTo(_);w=true;break;case 5:if(I){return}var c=ee("<div></div>").addClass("input-group").addClass("pull-left");var f=ee("<a></a>").attr("href","#").addClass("btn").addClass("btn-info").addClass("pull-right").addClass("action").html(o.Label).attr("title",o.Tooltip);var u=h.find(".associate-lookup .modal-associate");u.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){f.trigger("focus")});f.on("click",function(e){e.preventDefault();u.modal()});if(m._compact){f.addClass("btn-xs")}c.append(f).appendTo(_);w=true;break;case 8:var p=ee("<div></div>").addClass("input-group").addClass("pull-left");var v=ee("<a></a>").attr("href","#").addClass("entitylist-download").addClass("btn").addClass("btn-info").addClass("pull-right").addClass("action").attr("title",o.Tooltip).html(o.Label);if(m._compact){v.addClass("btn-xs")}v.on("click",function(e){e.preventDefault();v.attr("disabled","disabled");var t=new Date;var a,n=false;var i={};i.viewName=g.ViewName;i.columns=g.Columns;i.base64SecureConfiguration=g.Base64SecureConfiguration;i.sortExpression=h.find(".view-grid > table").data("sort-expression")||g.SortExpression;i.search=N?N.val():null;i.filter=m.getCurrentFilter();i.metaFilter=m._metaFilter;i.page=h.children(".view-pagination").data("current-page");i.pageSize=h.children(".view-pagination").data("pagesize");i.timezoneOffset=t.getTimezoneOffset();if((new Date).hasDaylightSavingTime()){a=true}i.isDSTSupport=a;i.isDSTObserved=moment().isDST();var r=JSON.stringify(i);shell.ajaxSafePost({type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:o.URL.Path,data:r,global:false,success:function(e){if(e.success){window.location=o.URL.Path+"?key="+e.sessionKey}}}).fail(function(e){var t=e.getResponseHeader("content-type");var a=t.indexOf("json")>-1?ee.parseJSON(e.responseText):{Message:e.status,InnerError:{Message:e.statusText}};X(a,h)}).always(function(){v.removeAttr("disabled","disabled")})});p.append(v).appendTo(_);w=true;break}})}if(b){var R=ee("<ul></ul>").addClass("view-filter-select").addClass("nav").addClass("nav-pills").addClass("pull-left").data("filter","user");var P=ee("<li></li>").addClass("dropdown");var M=ee("<a></a>").addClass("dropdown-toggle").attr("data-toggle","dropdown").attr("href","#").append(ee("<span></span>").addClass("fa").addClass("fa-filter").attr("aria-hidden","true")).append(ee("<span></span>").addClass("title").html(" "+g.Configuration.FilterByUserOptionLabel)).append(ee("<span></span>").addClass("caret").attr("aria-hidden","true")).dropdown();P.append(M);var F=ee("<ul></ul>").addClass("dropdown-menu");var j=ee("<li></li>");j.addClass("active");var $=ee("<a></a>").attr("href","#").addClass("filter-user").html(g.Configuration.FilterByUserOptionLabel).on("click",function(e){e.preventDefault();R.find("li").removeClass("active");ee(this).closest("li").toggleClass("active");R.data("filter","user");m.changeFilter()});j.append($).appendTo(F);var H=ee("<li></li>");var U=ee("<a></a>").attr("href","#").addClass("filter-account").html(f).on("click",function(e){e.preventDefault();R.find("li").removeClass("active");ee(this).closest("li").toggleClass("active");R.data("filter","account");m.changeFilter()});H.append(U).appendTo(F);P.append(F).appendTo(R);R.prependTo(k);w=true}if(S.Enabled&&A&&!m._compact){A.append(N).append(T).prependTo(_);w=true}if(t.length>1){var J=g.Configuration.ViewDisplayName;if(J==null||J==""){J=g.ViewName}var Q=ee("<ul></ul>").addClass("view-select").addClass("nav").addClass("nav-pills").addClass("pull-left");var V=ee("<li></li>").addClass("dropdown").attr("id","filterDropdownId");var W=ee("<a></a>").addClass("selected-view").addClass("dropdown-toggle").attr("data-toggle","dropdown").attr("href","#").attr("role","button").attr("title",J).append(ee("<span></span>").addClass("fa").addClass("fa-list").attr("aria-hidden","true")).append(ee("<span></span>").addClass("title").html(" "+J)).append(ee("<span></span>").addClass("caret").attr("aria-hidden","true")).dropdown();V.append(W);var q=ee("<ul></ul>").addClass("dropdown-menu").attr("role","menu");ee.each(t,function(e,t){var a=ee("<li></li>");if(e==p){a.addClass("active")}var n=t.Configuration.ViewDisplayName;if(n==null||n==""){n=t.ViewName}var i=ee("<a></a>").attr("href","#").attr("role","menuitem").data("id",t.Id).html(n).on("click",function(e){ee("#filterDropdownId").focus();e.preventDefault();var t=ee(this).data("id");m.changeView(t)});a.append(i).appendTo(q)});V.append(q).appendTo(Q);Q.prependTo(k);w=true}else if(m._compact){ee("<ul>").addClass("view-select").addClass("nav").addClass("nav-pills").addClass("pull-left").append(ee("<li>").append(ee("<div>").addClass("selected-view").append(ee("<span>").addClass("title").html(g.Configuration.ViewDisplayName||g.ViewName||"")))).prependTo(k);w=true}if(S.Enabled&&A&&m._compact){A.removeClass("pull-left").addClass("input-group-sm").append(N).append(T).prependTo(h)}if(w){_.appendTo(k);h.prepend(k)}if(g.Columns.length==0){return}var z=ee("<table></table>").attr("aria-live","polite").attr("aria-relevant","additions").attr("role","grid");z.attr("tabindex","0");z.addClass("table");z.addClass(a);z.addClass("table-fluid");if(navigator.userAgent.match(/iPad/i)&&y){z.addClass("table-ipad")}if(d=="Single"||d=="Multiple"){z.addClass("table-hover")}if(s=="Pixels"){z.attr("style","width:"+g.ColumnsTotalWidth+"px !important; max-width:"+g.ColumnsTotalWidth+"px !important;")}z.data("sort-expression",g.SortExpression);var B=ee("<thead></thead>");var K=ee("<tbody></tbody>");var G=ee("<tr></tr>");var Y=Z(g.SortExpression);ee.each(g.Columns,function(e,t){var a=ee("<th></th>").data("field",t.LogicalName);if(t.LogicalName!=="col-action"){a.data("columnname",t.Name)}if(s=="Pixels"){a.attr("style","width:"+t.Width+"px;")}else{a.attr("style","width:"+t.WidthAsPercent+"%;")}if(!t.SortDisabled){a.addClass("sort-enabled").data("sort-name",t.LogicalName);var n=ee("<a></a>").attr("href","#").attr("role","button").attr("aria-label",t.Name);var i=de(Y,"name",t.LogicalName);if(i!=-1){var r=Y[i];if(r.direction.toLowerCase().indexOf("asc")!=-1){n.append(t.Name+" ").append(ee("<span></span>").addClass("fa").addClass("fa-arrow-up").attr("aria-hidden","true")).append("<span class='sr-only sort-hint'>. "+window.ResourceManager["Sort_Ascending_Order"]+"</span>");a.attr("aria-sort","ascending");a.data("sort-dir","ASC").addClass("sort").addClass("sort-asc")}else{n.append(t.Name+" ").append(ee("<span></span>").addClass("fa").addClass("fa-arrow-down").attr("aria-hidden","true")).append("<span class='sr-only sort-hint'>. "+window.ResourceManager["Sort_Descending_Order"]+"</span>");a.attr("aria-sort","descending");a.data("sort-dir","DESC").addClass("sort").addClass("sort-desc")}}else{n.html(t.Name).append("<span class='sr-only sort-hint'>. "+window.ResourceManager["Sort_Descending_Order"]+"</span>")}n.appendTo(a)}else{a.html(t.Name);var o=t.Name.replace(/<(?:.|\n)*?>/gm,"").trim();a.addClass("sort-disabled").attr("tabindex",0).attr("aria-label",o);a.attr("aria-hidden","true")}a.appendTo(G)});G.appendTo(B);B.appendTo(z);K.appendTo(z);z.appendTo(C);m.addSortEventHandlers();if(!i){m.load()}else if(e){m.load()}};a.prototype.changeView=function(e){var t=this;var a=t._element;a.data("selected-view",e);t.resetPagination();t.render(true)};a.prototype.changeFilter=function(){var e=this;var t=e._element;var a=e._layouts;var n=t.data("selected-view");var i=t.children(".view-toolbar").find(".view-filter-select");var r=0;if(typeof n!==typeof undefined&&n!==false&&n!=null&&n!=""){r=de(a,"Id",n);if(r==-1){r=0}}this._activeLayoutIndex=r;var o=a[r];var l=e._userIsAuthenticated;var d=e._userParentAccountName;var s=l&&d&&d!=""&&(o.Configuration.FilterPortalUserAttributeName!=null&&o.Configuration.FilterPortalUserAttributeName!=""||o.Configuration.FilterAccountAttributeName!=null&&o.Configuration.FilterAccountAttributeName!="");if(!s){return}var c=e.getCurrentFilter();var f;if(c=="user"){f=o.Configuration.FilterByUserOptionLabel}else{f=d}i.find("li.dropdown").find("span.title").html(" "+f);e.load(0,c)};a.prototype.getCurrentFilter=function(){var e=this;var t=e._element;var a=e._layouts;var n=t.data("selected-view");var i=t.children(".view-toolbar").find(".view-filter-select");var r=0;if(typeof n!==typeof undefined&&n!==false&&n!=null&&n!=""){r=de(a,"Id",n);if(r==-1){r=0}}this._activeLayoutIndex=r;var o=a[r];var l=e._userIsAuthenticated;var d=e._userParentAccountName;var s="user";if(!l){return null}if(o.Configuration.FilterPortalUserAttributeName==null||o.Configuration.FilterPortalUserAttributeName==""){if(!d||d==""||o.Configuration.FilterAccountAttributeName==null||o.Configuration.FilterAccountAttributeName==""){return null}else{return"account"}}if(!d||d==""||o.Configuration.FilterAccountAttributeName==null||o.Configuration.FilterAccountAttributeName==""){return s}var c=i.data("filter")||s;if(c=="user"||c=="account"){return c}return s};a.prototype.isRelatedRecordFilterEnabled=function(){var e=this;var t=e._element;var a;if(t.children(".view-toolbar").find(".toggle-related-filter").length==0){a=e._applyRelatedRecordFilter||false}else{a=t.children(".view-toolbar").find(".toggle-related-filter").hasClass("active")}return a};a.prototype.load=function(e,t,a,Q){var V=this;var W=V._element;var q=W.children(".view-grid").find("table");var z=ee("<tbody></tbody>");var n=W.children(".view-error");var B=W.children(".view-empty");var K=W.children(".view-access-denied");var i=W.children(".view-loading");var r=W.children(".view-pagination");var o=W.children(".view-toolbar").find(".entitylist-search input.query");var l=q.data("sort-expression");var d=V._serviceUrlForGet;var s=V._layouts;var G=s[V._activeLayoutIndex];var Y=G.Configuration;var X=V._selectMode;var Z=V._enableActions;var c;var f=V._filterRelationshipName;var u=V._filterEntityName;var p=V._filterAttributeName;var v=null;var m=W.closest(".entity-form").children("input[type='hidden'][id$='EntityName']").val();var h=W.closest(".entity-form").children("input[type='hidden'][id$='EntityID']").val();var g=V._metaFilter;W.children(".view-grid").find("tbody").remove();n.hide().prop("aria-hidden",true);B.hide().prop("aria-hidden",true);K.hide().prop("aria-hidden",true);i.show().prop("aria-hidden",false);r.data("pagesize",Y.PageSize);var y=r.data("current-page");if(y==null||y==""){y=1}t=t||V.getCurrentFilter();e=e||y;var b=r.data("pagesize");if(b==null||b==""){b=10}var C=o.val();if(typeof C===typeof undefined||C===false){C=null}if(typeof a===typeof undefined){c=V.isRelatedRecordFilterEnabled()}else{c=!a}if(c){if(u&&m&&m!=""&&u==m&&h&&h!=""){v=h}else if(p&&p!=""){var k=ee("#"+p);if(k.length>0){var _=k.val();if(_&&_!=""){v=_}}}}V.hidePagination();V.getData(d,Y,G.Base64SecureConfiguration,l,t,g,C,e,b,c,f,u,p,v,function(t){z.empty();if(typeof t===typeof undefined||t===false||t==null){B.fadeIn().prop("aria-hidden",false);W.trigger("loaded");return}if(t.ViewConfiguration!=null&&t.PageNumber<=t.PageCount){G.Base64SecureConfiguration=t.ViewConfiguration}if(t.CreateActionMetadata&&t.CreateActionMetadata.Disabled){var e=W.find(".grid-actions .create-action").off("click");if(t.CreateActionMetadata.DisabledMessage){e.attr("title",t.CreateActionMetadata.DisabledMessage)}e.click(function(e){e.preventDefault();if(t.CreateActionMetadata.DisabledMessage){window.alert(t.CreateActionMetadata.DisabledMessage)}})}if(typeof t.Records!==typeof undefined&&t.Records!==false&&(t.Records==null||t.Records.length==0)){B.fadeIn().prop("aria-hidden",false);W.trigger("loaded");return}if(typeof t.AccessDenied!==typeof undefined&&t.AccessDenied!==false&&t.AccessDenied){K.fadeIn().prop("aria-hidden",false);W.trigger("loaded");return}var a=ee.map(q.find("th"),function(e){return ee(e).data("field")});var n=a.length==0?"":a[0]=="col-select"?a[1]:a[0];W.data("total-record-count",t.ItemCount);for(var i=0;i<t.Records.length;i++){var r=t.Records[i];var o=se(r);if(!o){var l=de(r.Attributes,"Name",n);if(l!=-1){o=r.Attributes[l].DisplayValue}}var d=ee("<tr></tr>").attr("data-id",r.Id).attr("data-entity",Y.EntityName).attr("data-name",o||"").on("focus",function(){ee(this).addClass("active")}).on("blur",function(){ee(this).removeClass("active")});var s=ee.noop;if(X=="Multiple"){s=function(){var e=ee(this).hasClass("selected")===true;ee(this).find("td:first-child").attr("aria-checked",!e);ee(this).children("td:first").find(".fa-fw").toggleClass("fa-check",!e);ee(this).toggleClass("selected").toggleClass("info")};d.on("click",s).on("keypress",function(e){var t=e.keyCode?e.keyCode:e.which;if(t=="13"||t=="32"){e.preventDefault();s.apply(this,arguments)}}).children("td:first").attr("aria-checked","false")}else if(X=="Single"){s=function(){var e=ee(this).hasClass("selected")===true;var t=q.find("tr.selected");t.each(function(){ee(this).children("td:first").find(".fa-fw").removeClass("fa-check");ee(this).removeClass("selected").removeClass("info")});if(!e){ee(this).children("td:first").find(".fa-fw").addClass("fa-check");ee(this).addClass("selected").addClass("info")}};d.on("click",s).on("keypress",function(e){var t=e.keyCode?e.keyCode:e.which;if(t=="13"||t=="32"){e.preventDefault();s.apply(this,arguments)}})}for(var c=0;c<a.length;c++){var f=false;for(var u=0;u<r.Attributes.length;u++){var p=r.Attributes[u];if(p.Name==a[c]){var v=ee("<td></td>").attr("data-type",p.Type).attr("data-attribute",p.Name).attr("data-value",typeof p.Value==="object"?JSON.stringify(p.Value):p.Value).attr("tabindex",0);var m=V.formatAttributeValue(p,p.AttributeMetadata,c,r,t);if(m.isHtml){v.html(m.value)}else{v.text(p.DisplayValue)}if(p.AttributeMetadata){v.data("attribute-metadata",p.AttributeMetadata)}d.append(v);f=true;break}}if(!f){if(a[c]=="col-action"){var h=ee("<td></td>");var g=ee("<div class='dropdown action'></div>");ee("<button class='btn btn-default btn-xs'><span class='fa fa-chevron-circle-down' aria-hidden='true'></span></button>").attr("data-toggle","dropdown").attr("aria-label",window.ResourceManager["ActionLink_Aria_Label"]).appendTo(g);var y=ee("<ul class='dropdown-menu'></ul>");y.css("position","fixed").appendTo(g);g.on("show.bs.dropdown",function(){var e=ee(this).get(0).getBoundingClientRect();var t=ee(this).find(".dropdown-menu:first");var a=ee(window).width();var n=e.left+t.outerWidth()<=a;if(n){t.css("left",e.left).css("top",e.top+ee(this).outerHeight())}else{t.css("left",e.left+e.width-t.outerWidth()).css("top",e.top+ee(this).outerHeight())}});ee(window).scroll(function(){if(/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)){var e=W.children(".view-grid");if(e.hasClass("has-pagination")){var t=ee(document).height();var a=W.children(".view-pagination").offset().top;var n=W.children(".view-pagination").height();var i=e.find("ul.dropdown-menu").height();if(t-a<i+n){var r=e.find("table").height();e.css("height",r+i)}}}var o=W.find(".dropdown.action.open");if(o.length==0){return}o.removeClass("open")});var b=fe();if(!G.Configuration.ItemActionLinks){G.Configuration.ItemActionLinks=G.Configuration.CreateRelatedRecordActionLinks}if(Z){if(G.Configuration.CreateRelatedRecordActionLinks&&G.Configuration.CreateRelatedRecordActionLinks.length>0){for(var C=0;C<G.Configuration.CreateRelatedRecordActionLinks.length;C++){if(ee.inArray(G.Configuration.CreateRelatedRecordActionLinks[C],G.Configuration.ItemActionLinks)<0){G.Configuration.ItemActionLinks.push(G.Configuration.CreateRelatedRecordActionLinks[C])}}}var k=G.Configuration.ItemActionLinks;for(var _=0;_<k.length;_++){var w=k[_];if(t.DisabledItemActionLinks){var L=t.DisabledItemActionLinks.filter(function(e){return e.EntityId==r.Id&&e.LinkUniqueId==w.FilterCriteriaId});if(L&&L.length){continue}}switch(w.Type){case 1:if(w.Enabled){var S="#";if((w.Target==ae||w.Target==ne)&&w.URL!=null){S=ie(W,URI(oe(w)).addSearch(w.QueryStringIdParameterName,r.Id.toString()))}var A=ee("<li></li>");var E=ee("<a class='details-link' role='menuitem' tabindex='-1'></a>").attr("href",S).attr("title",w.Tooltip).html(w.Label);if(S!="#"&&b)E.attr("target","_top");if(w.Target==te&&w.EntityForm){E.addClass("launch-modal").attr("data-entityformid",w.EntityForm.Id)}A.append(E).appendTo(y)}break;case 2:if(w.Enabled&&r.CanWrite){var T="#";if((w.Target==ae||w.Target==ne)&&w.URL!=null){T=ie(W,URI(oe(w)).addSearch(w.QueryStringIdParameterName,r.Id.toString()).toString())}var N=ee("<li></li>");var O=ee("<a class='edit-link' role='menuitem' tabindex='-1'></a>").attr("href",T).attr("title",w.Tooltip).html(w.Label);if(T!="#"&&b)O.attr("target","_top");if(w.Target==te&&w.EntityForm){O.addClass("launch-modal").attr("data-entityformid",w.EntityForm.Id)}N.append(O).appendTo(y)}break;case 4:if(w.Enabled&&r.CanDelete){ee("<li></li>").append(ee("<a class='delete-link' role='menuitem' tabindex='-1' href='#'></a>").attr("title",w.Tooltip).html(w.Label)).appendTo(y)}break;case 6:if(w.Enabled&&r.CanAppend){ee("<li></li>").append(ee("<a class='disassociate-link' role='menuitem' tabindex='-1' href='#'></a>").attr("title",w.Tooltip).html(w.Label)).appendTo(y)}break;case 7:if(w.URL){var I=ee("<a class='workflow-link' role='menuitem' tabindex='-1' href='#'></a>").attr("title",w.Tooltip).attr("data-workflowid",w.Workflow.Id).attr("data-url",oe(w)).html(w.Label);if(w.CustomizeModal===true){I.attr("data-modal-title",w.Modal.Title);I.attr("data-modal-confirmation",w.Confirmation);I.attr("data-modal-primary-action",w.Modal.PrimaryButtonText);I.attr("data-modal-cancel-action",w.Modal.CloseButtonText)}ee("<li></li>").append(I).appendTo(y)}break;case 9:if(w.Enabled&&r.CanWrite&&r.StateCode=="0"){ee("<li></li>").append(ee("<a class='close-case-link' role='menuitem' tabindex='-1' href='#'></a>").attr("data-url",oe(w)).attr("data-redirecturl",ce(w)).attr("data-resolution",w.DefaultResolution).attr("data-description",w.DefaultResolutionDescription).attr("title",w.Tooltip).html(w.Label)).appendTo(y)}break;case 10:if(w.Enabled&&r.CanWrite&&r.StateCode=="0"){ee("<li></li>").append(ee("<a class='qualify-lead-link' role='menuitem' tabindex='-1' href='#'></a>").attr("data-url",oe(w)).attr("data-redirecturl",ce(w)).attr("title",w.Tooltip).html(w.Label)).appendTo(y)}break;case 11:if(w.Enabled&&r.CanWrite&&r.StateCode=="1"){ee("<li></li>").append(ee("<a class='convert-quote-link' role='menuitem' tabindex='-1' href='#'></a>").attr("data-url",oe(w)).attr("data-redirecturl",ce(w)).attr("title",w.Tooltip).html(w.Label)).appendTo(y)}break;case 12:if(w.Enabled&&r.CanWrite&&r.StateCode!="2"){ee("<li></li>").append(ee("<a class='convert-order-link' role='menuitem' tabindex='-1' href='#'></a>").attr("data-url",oe(w)).attr("data-redirecturl",ce(w)).attr("title",w.Tooltip).html(w.Label)).appendTo(y)}break;case 13:if(w.Enabled&&r.CanWrite){ee("<li></li>").append(ee("<a class='calculate-opportunity-link' role='menuitem' tabindex='-1' href='#'></a>").attr("data-url",oe(w)).attr("data-redirecturl",ce(w)).attr("title",w.Tooltip).html(w.Label)).appendTo(y)}break;case 14:if(w.Enabled&&r.CanWrite&&r.StateCode=="0"){ee("<li></li>").append(ee("<a class='resolve-case-link' role='menuitem' tabindex='-1' href='#'></a>").attr("data-url",oe(w)).attr("data-redirecturl",ce(w)).attr("title",w.Tooltip).html(w.Label)).appendTo(y)}break;case 15:if(w.Enabled&&r.CanWrite&&r.StateCode!="0"){ee("<li></li>").append(ee("<a class='reopen-case-link' role='menuitem' tabindex='-1' href='#'></a>").attr("title",w.Tooltip).html(w.Label)).appendTo(y)}break;case 16:if(w.Enabled&&r.CanWrite&&r.StateCode=="0"){ee("<li></li>").append(ee("<a class='cancel-case-link' role='menuitem' tabindex='-1' href='#'></a>").attr("data-url",oe(w)).attr("data-redirecturl",ce(w)).attr("title",w.Tooltip).html(w.Label)).appendTo(y)}break;case 17:if(w.Enabled&&r.CanWrite&&r.StateCode!="1"){ee("<li></li>").append(ee("<a class='deactivate-link' role='menuitem' tabindex='-1' href='#'></a>").attr("title",w.Tooltip).html(w.Label)).appendTo(y)}break;case 18:if(w.Enabled&&r.CanWrite&&r.StateCode!="0"){ee("<li></li>").append(ee("<a class='activate-link' role='menuitem' tabindex='-1' href='#'></a>").attr("title",w.Tooltip).html(w.Label)).appendTo(y)}break;case 19:if(w.Enabled&&r.CanWrite&&r.StateCode=="0"){ee("<li></li>").append(ee("<a class='activate-quote-link' role='menuitem' tabindex='-1' href='#'></a>").attr("title",w.Tooltip).html(w.Label)).appendTo(y)}break;case 20:if(w.Enabled&&r.CanWrite&&r.StateCode=="0"&&r.StatusCode!="2"){ee("<li></li>").append(ee("<a class='set-opportunity-on-hold-link' role='menuitem' tabindex='-1' href='#'></a>").attr("title",w.Tooltip).html(w.Label)).appendTo(y)}break;case 21:if(w.Enabled&&r.CanWrite&&r.StateCode=="0"){ee("<li></li>").append(ee("<a class='win-opportunity-link' role='menuitem' tabindex='-1' href='#'></a>").attr("data-url",oe(w)).attr("data-redirecturl",ce(w)).attr("title",w.Tooltip).html(w.Label)).appendTo(y)}break;case 22:if(w.Enabled&&r.CanWrite&&r.StateCode=="0"){ee("<li></li>").append(ee("<a class='lose-opportunity-link' role='menuitem' tabindex='-1' href='#'></a>").attr("data-url",oe(w)).attr("data-redirecturl",ce(w)).attr("title",w.Tooltip).html(w.Label)).appendTo(y)}break;case 23:if(w.Enabled&&r.CanWrite&&r.StateCode=="0"){ee("<li></li>").append(ee("<a class='generate-quote-from-opportunity-link' role='menuitem' tabindex='-1' href='#'></a>").attr("data-url",oe(w)).attr("data-redirecturl",ce(w)).attr("title",w.Tooltip).html(w.Label)).appendTo(y)}break;case 25:if(w.Enabled&&r.CanWrite&&r.StateCode!="0"){ee("<li></li>").append(ee("<a class='reopen-opportunity-link' role='menuitem' tabindex='-1' href='#'></a>").attr("title",w.Tooltip).html(w.Label)).appendTo(y)}break;case 29:var x=W.closest(".entity-form").find("[id$='_EntityState']").val();var D=typeof x!=typeof undefined&&x!=null&&x!==""&&x!=="0";if(w.Enabled&&r.CanWrite&&!D){var R="#";var P=this;if((w.Target===ae||w.Target===ne)&&w.URL!==null){R=ie(W,URI(oe(w)).addSearch(r.Id.toString()).toString())}var M=ee("<li></li>");var F=ee("<a class='create-related-record-link' role='menuitem' tabindex='-1'></a>").attr("href",R).attr("title",w.Tooltip).html(w.Label);if(R!=="#"&&b)F.attr("target","_top");if(w.Target===te&&w.EntityForm){F.addClass("launch-modal").attr("data-entityformid",w.EntityForm.Id).attr("data-relationship",w.Relationship).attr("data-filtercriteriaid",w.FilterCriteriaId);var j=W.children(".modal-form-createrecord");if(j.length){for(var $=0,H=j.length;$<H;$++){var U=ee(j[$]);U.attr("data-filtercriteriaid",w.FilterCriteriaId);U.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){var e=ee(this).find("iframe");e.attr("src","");P.createModal.trigger("focus")});U.on("click",function(e){e.preventDefault();var t=P.createModal.find("iframe");var a=t.data("page");var n=P.record.Id.toString();var i=w.Relationship;var r=P.record.EntityName;var o=a+"?id="+n+"&languagecode="+G.Configuration.LanguageCode+"&relationship="+"&entityformid="+G.Configuration.CreateRelatedRecordActionLink.EntityForm.Id;var l=re(o,r,n,i);t.attr("src",l);t.on("load",function(){P.createModal.find(".form-loading").hide();P.createModal.find("iframe").contents().find("#EntityFormControl").show()});P.createModal.find(".form-loading").show();P.createModal.find("iframe").contents().find("#EntityFormControl").hide();P.createModal.modal()})}M.append(F).appendTo(y)}}}break}}}if(y.children("li").length>0){g.find(".fa").addClass("fa-fw");h.append(g)}var J=g.find("li a").length;g.find("li a").each(function(e,t){ee(t).attr("aria-setsize",J).attr("aria-posinset",e+1)});h.appendTo(d)}else{d.append("<td></td>")}}}if(X=="Multiple"||X=="Single"){d.children("td:first").append("<span class='fa fa-fw'></span>")}if(X=="Single"){if(!W.data("selected")&&i==0){d.children("td:first").find(".fa-fw").addClass("fa-check");d.addClass("selected").addClass("info")}else if(W.data("selected")===d.attr("data-id")){d.children("td:first").find(".fa-fw").addClass("fa-check");d.addClass("selected").addClass("info")}}z.append(d)}if(X==="Single"){z.attr("role","radiogroup")}W.children(".view-grid").find("tbody").remove();q.append(z.hide());z.fadeIn();V.initializePagination(t,Q);V.addDetailsActionLinkClickEventHandlers();V.addEditActionLinkClickEventHandlers();V.addDeleteActionLinkClickEventHandlers();V.addQualifyLeadActionLinkClickEventHandlers();V.addCloseCaseActionLinkClickEventHandlers();V.addResolveCaseActionLinkClickEventHandlers();V.addReopenCaseActionLinkClickEventHandlers();V.addCancelCaseActionLinkClickEventHandlers();V.addConvertQuoteActionLinkClickEventHandlers();V.addConvertOrderActionLinkClickEventHandlers();V.addCalculateOpportunityActionLinkClickEventHandlers();V.addActivateActionLinkClickEventHandlers();V.addDeactivateActionLinkClickEventHandlers();V.addActivateQuoteActionLinkClickEventHandlers();V.addSetOpportunityOnHoldActionLinkClickEventHandlers();V.addReopenOpportunityActionLinkClickEventHandlers();V.addWinOpportunityActionLinkClickEventHandlers();V.addLoseOpportunityActionLinkClickEventHandlers();V.addGenerateQuoteFromOpportunityActionLinkClickEventHandlers();V.addDisassociateActionLinkClickEventHandlers();V.addWorkflowActionLinkClickEventHandlers();V.addCreateRelatedRecordLinkEventHandler();le(q);W.trigger("loaded")},function(e,t,a){n.html(ee("<div class='alert alert-block alert-danger'></div>").html(a));n.show().prop("aria-hidden",false)},function(){i.hide().prop("aria-hidden",true);if(w){q.find("th.sort-enabled a").removeAttr("disabled").css({"pointer-events":"",cursor:""});w=false}},m,h)};a.prototype.getData=function(e,t,a,n,i,r,o,l,d,s,c,f,u,p,v,m,h,g,y){v=ee.isFunction(v)?v:function(){};m=ee.isFunction(m)?m:function(){};h=ee.isFunction(h)?h:function(){};if(!e||e==""){h.call(this);m.call(this,null,"error",window.ResourceManager["EntityGrid_Url_NotFound"]);return}if(!a){h.call(this);m.call(this,null,"error",window.ResourceManager["Required_Secure_ViewConfiguration_Not_Provided"]);return}d=d||-1;var b={};b.base64SecureConfiguration=a;b.sortExpression=n;b.search=o;b.page=l;b.pageSize=d;b.filter=i;b.metaFilter=r;b.timezoneOffset=(new Date).getTimezoneOffset();if(s){b.applyRelatedRecordFilter=s;b.filterRelationshipName=c;b.filterEntityName=f;b.filterAttributeName=u;if(p){b.filterValue=p}}b.customParameters=k(t);b.entityName=g;b.entityId=y;var C=JSON.stringify(b);shell.ajaxSafePost({type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:e,data:C,global:false}).done(v).fail(m).always(h)};a.prototype.formatAttributeValue=function(e,t,a,n,i){if(!e){return null}var r=this;var o=r._element;var l=r._layouts;var d=l[r._activeLayoutIndex];var s=r._enableActions;var c=fe();var f={};var u=a==0&&s&&d.Configuration.DetailsActionLink.Enabled;switch(e.Type){case"System.DateTime":var p=window.moment;if(p){var v=dateFormatConverter.convert(o.closest("[data-dateformat]").data("dateformat")||"M/d/yyyy",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var m=dateFormatConverter.convert(o.closest("[data-timeformat]").data("timeformat")||"h:mm tt",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var h=dateFormatConverter.convert(o.closest("[data-datetimeformat]").data("datetimeformat")||v+" "+m,dateFormatConverter.dotNet,dateFormatConverter.momentJs);var g=e.DateTimeBehavior.Value;var y=e.DateTimeFormat;var b="YYYY-MM-DD";var C="YYYY-MM-DDTHH:mm:ssZ";var k="YYYY-MM-DDTHH:mm:ss";var _;var w;if(y=="DateOnly"){w=b;_=v}else if(g=="TimeZoneIndependent"){w=k;_=h}else{w=C;_=h}var L=g=="TimeZoneIndependent"||g=="DateOnly"?p.utc(e.Value):p(e.Value);f.value=ee("<time></time>").attr("datetime",L.format(w)).text(L.format(_))}else{f.value=ee("<time></time>").attr("datetime",e.DisplayValue).text(e.DisplayValue)}f.isHtml=true;break;case"System.String":if(!u&&typeof t!==typeof undefined&&t!=null&&typeof t.Format!==typeof undefined){if(t.Format==0){var S=e.DisplayValue;if(S&&S!=""){if(!S.toLowerCase().startsWith("mailto")){S="mailto:"+S}}f.value=ee("<a></a>").attr("href",S).text(e.DisplayValue);f.isHtml=true}else if(t.Format==3){var A=e.DisplayValue;if(A&&A!=""){if(!A.toLowerCase().startsWith("http")){A="http://"+A}}var E=ee("<a></a>");E.attr("href",A).text(e.DisplayValue);if(c)E.attr("target","_top");f.value=E;f.isHtml=true}else if(t.Format==4){var T=e.DisplayValue;if(T&&T!=""){var N="http://go.microsoft.com/fwlink?linkid=8506&Symbol="+encodeURIComponent(T.toUpperCase());var O=ee("<a></a>");O.attr("href",N).text(e.DisplayValue);if(c)O.attr("target","_top");f.value=O;f.isHtml=true}}}else{f.value=e.DisplayValue;f.isHtml=false}break;default:f.value=e.DisplayValue;f.isHtml=false;break}if(u){var I="#";var x;if(!d.Configuration.DetailsActionLink.EntityForm&&d.Configuration.DetailsActionLink.URL!=null){for(var D=0;D<d.Configuration.ItemActionLinks.length;D++){var R=d.Configuration.ItemActionLinks[D];if(i.DisabledItemActionLinks){var P=i.DisabledItemActionLinks.filter(function(e){return e.EntityId==n.Id&&e.LinkUniqueId==R.FilterCriteriaId});if(P&&P.length){continue}else if(R.Type===2){var M=oe(R);if(M!=null){I=URI(M).addSearch(R.QueryStringIdParameterName,n.Id.toString())}else{x=R}break}}}if(I==="#"){I=URI(oe(d.Configuration.DetailsActionLink)).addSearch(d.Configuration.DetailsActionLink.QueryStringIdParameterName,n.Id.toString())}}var F=ee("<a></a>").attr("href",I).addClass("details-link").addClass("has-tooltip").attr("data-toggle","tooltip").attr("title",d.Configuration.DetailsActionLink.Tooltip).html(f.value);if(I!="#"&&c)F.attr("target","_top");if(x&&x.EntityForm!=null){F.addClass("launch-modal").attr("data-entityformid",x.EntityForm.Id)}else if(d.Configuration.DetailsActionLink.EntityForm){F.addClass("launch-modal").attr("data-entityformid",d.Configuration.DetailsActionLink.EntityForm.Id)}f.value=F;f.isHtml=true}return f};a.prototype.addSortEventHandlers=function(){var r=this;var e=r._element;var o=e.children(".view-grid").find("table");o.find("th.sort-enabled a").on("click",function(e){e.preventDefault();if(!w){o.find("th.sort-enabled a").attr("disabled","disabled").css({"pointer-events":"none",cursor:"default"});w=true}var t=ee(this).closest("th");ee(this).find(".fa-arrow-down").remove();ee(this).find(".fa-arrow-up").remove();ee(this).find(".sort-hint").remove();var a=t.data("sort-name");var n=t.data("sort-dir");if(typeof a===typeof undefined||a===false||a===null||a===""){return}if(typeof n===typeof undefined||n===false){n=""}var i;if(n=="ASC"){i=a+" DESC";t.data("sort-dir","DESC").removeClass("sort-asc").addClass("sort-desc");ee(this).parent().attr("aria-sort","descending");ee(this).append(" ").append(ee("<span></span>").addClass("fa").addClass("fa-arrow-down")).append("<span class='sr-only sort-hint'>. "+window.ResourceManager["Sort_Ascending_Order"]+"</span>")}else{i=a+" ASC";t.data("sort-dir","ASC").removeClass("sort-desc").addClass("sort-asc");ee(this).parent().attr("aria-sort","ascending");ee(this).append(" ").append(ee("<span></span>").addClass("fa").addClass("fa-arrow-up")).append("<span class='sr-only sort-hint'>. "+window.ResourceManager["Sort_Descending_Order"]+"</span>")}t.addClass("sort");o.data("sort-expression",i);o.find("th.sort a").each(function(){var e=ee(this).closest("th");var t=e.data("sort-name");if(typeof t===typeof undefined||t===false||t===null||t===""){return}if(t!=a){ee(this).find(".fa-arrow-down").remove();ee(this).find(".fa-arrow-up").remove();e.removeClass("sort-asc").removeClass("sort-desc").removeClass("sort").data("sort-dir","");ee(this).parent().removeAttr("aria-sort")}});r.load(1)})};function g(e,t,a){if(typeof e!==typeof undefined&&e!==false&&e!=null&&e!=""){var n=r(t);var i=ee("<div class='notification alert alert-success success alert-dismissible' role='alert'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button>"+e+"</div>").on("closed.bs.alert",function(){if(n.find(".notification").length==0)n.hide()}).prependTo(n);n.show();ee("html, body").animate({scrollTop:i.length?i.offset().top-20:0},200);if(a){setTimeout(function(){i.slideUp(100).remove();if(n.find(".notification").length==0)n.hide()},5e3)}}}function r(e){var t=ee(".notifications");if(t.length==0){var a=ee(".page-heading");if(a.length==0){var n=ee("#content-container");if(n.length==0){var i=false;if(e){var r=e.parentsUntil("form");if(r.length>0){var o=ee(r[r.length-1]).find("div:visible:first");if(o.length>0){t=ee("<div class='notifications'></div>").appendTo(o);i=true}}if(!i){var t=e.find(".subgrid-notifications");if(t.length==0){t=ee("<div class='subgrid-notifications'></div>").prependTo(e)}}}}else{t=ee("<div class='notifications'></div>").prependTo(n)}}else{t=ee("<div class='notifications'></div>").appendTo(a)}}t.find(".notification").slideUp().remove();return t}function y(e,t){if(typeof t==typeof undefined||t==null){e.trigger("refresh");return}var a=0;var n=1;var i=2;var r=typeof t.OnComplete!=typeof undefined&&t.OnComplete!=null&&t.OnComplete!=a;if(r){var o=d(t);if(o!=null&&o!=""){l(o)}else{e.trigger("refresh")}}else{e.trigger("refresh")}}function b(e){var t={Message:window.ResourceManager["UnKnown_Error_Occurred"]};if(e==null)return t;try{var a=e.getResponseHeader("content-type");if(a!=null){t=a.indexOf("json")>-1?ee.parseJSON(e.responseText):{Message:e.status,InnerError:{Message:e.statusText}}}else{t={Message:e.statusText}}}catch(e){t={Message:e.message}}return t}a.prototype.addCreateRelatedRecordLinkEventHandler=function(){var e=this;var u=e._element;var t=e._layouts;var p=t[e._activeLayoutIndex];var a=e._enableActions;var n=u.children(".view-grid").find("table");if(!a){return}n.find(".create-related-record-link.launch-modal").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var n=a.data("id");var i=t.data("relationship");var r=a.data("entity");var o=ee(this).data("entityformid");var l=u.children(".modal-form-createrecord").first();var d=l.find("iframe");var s=d.data("page");if(!o){return}var c=s+"?id="+n+"&entityformid="+o+"&languagecode="+p.Configuration.LanguageCode;var f=re(c,r,n,i);d.attr("src",f);d.on("load",function(){l.find(".form-loading").hide();l.find("iframe").contents().find("#EntityFormControl").show()});l.find(".form-loading").show();l.find("iframe").contents().find("#EntityFormControl").hide();l.on("show.bs.modal",function(){l.attr("aria-hidden","false")});l.modal();l.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){l.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})};a.prototype.addDetailsActionLinkClickEventHandlers=function(){var e=this;var s=e._element;var t=e._layouts;var c=t[e._activeLayoutIndex];var a=e._enableActions;var n=s.children(".view-grid").find("table");if(!a){return}n.find(".details-link.launch-modal").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var n=a.data("id");var i=s.children(".modal-form-details");var r=i.find("iframe");var o=r.data("page");var l=ee(this).data("entityformid");if(!l)return;var d=ie(s,o+"?id="+n+"&entityformid="+l+"&languagecode="+c.Configuration.LanguageCode);r.attr("src",d);r.on("load",function(){i.find(".form-loading").hide();i.find("iframe").contents().find("#EntityFormControl").show()});i.find(".form-loading").show();i.find("iframe").contents().find("#EntityFormControl").hide();i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})};a.prototype.addEditActionLinkClickEventHandlers=function(){var e=this;var s=e._element;var t=e._layouts;var c=t[e._activeLayoutIndex];var a=e._enableActions;var n=s.children(".view-grid").find("table");if(!a){return}n.find(".edit-link.launch-modal").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var n=a.data("id");var i=s.children(".modal-form-edit");var r=i.find("iframe");var o=r.data("page");var l=ee(this).data("entityformid");if(!l)return;var d=ie(s,o+"?id="+n+"&entityformid="+l+"&languagecode="+c.Configuration.LanguageCode);r.attr("src",d);r.on("load",function(){i.find(".form-loading").hide();i.find("iframe").contents().find("#EntityFormControl").show()});i.find(".form-loading").show();i.find("iframe").contents().find("#EntityFormControl").hide();i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})};a.prototype.addDeleteActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.DeleteActionLink.Enabled&&!l.Configuration.DeleteActionLink.URL){return}var d=oe(l.Configuration.DeleteActionLink);n.find(".delete-link").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var n=a.data("id");var i=o.children(".modal-delete");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();ee(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){var e=o.children(".view-grid").find("tbody tr").length;if(e==1){var t=o.children(".view-pagination");var a=t.data("current-page");if(a>1){a--;t.data("current-page",a)}}i.modal("hide");g(l.Configuration.DeleteActionLink.SuccessMessage,o,true);y(o,l.Configuration.DeleteActionLink)}).fail(function(e){i.modal("hide");X(b(e),o)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})};a.prototype.addQualifyLeadActionLinkClickEventHandlers=function(){var e=this;var l=e._element;var t=e._layouts;var d=t[e._activeLayoutIndex];var a=e._enableActions;var n=l.children(".view-grid").find("table");if(!a||!d.Configuration.QualifyLeadActionLink.Enabled&&!d.Configuration.QualifyLeadActionLink.URL){return}var s=oe(d.Configuration.QualifyLeadActionLink);if(d.Configuration.QualifyLeadActionLink.ShowModal==1){n.find(".qualify-lead-link").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var i=a.data("id");var r=l.children(".modal-qualify");var o=r.find("button.primary");o.off("click");o.on("click",function(e){e.preventDefault();ee(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.createAccount=true;t.createContact=true;t.createOpportunity=true;var a={};a.LogicalName=d.Configuration.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:s,data:n}).done(function(){r.modal("hide");g(d.Configuration.QualifyLeadActionLink.SuccessMessage,l,true);y(l,d.Configuration.QualifyLeadActionLink)}).fail(function(e){r.modal("hide");X(b(e),l)}).always(function(){o.removeAttr("disabled","disabled").find(".fa-spin").remove()})});r.on("show.bs.modal",function(){r.attr("aria-hidden","false")});r.modal();r.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){r.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})}else{n.find(".qualify-lead-link").on("click",function(e){e.preventDefault();var t=ee(this).closest("tr");var a=t.data("id");var n={};n.createAccount=true;n.createContact=true;n.createOpportunity=true;var i={};i.LogicalName=d.Configuration.EntityName;i.Id=a;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:s,data:r}).done(function(){g(d.Configuration.QualifyLeadActionLink.SuccessMessage,l,true);y(l,d.Configuration.QualifyLeadActionLink)}).fail(function(e){X(b(e),l)}).always(function(){})})}};a.prototype.addCloseCaseActionLinkClickEventHandlers=function(){var e=this;var s=e._element;var t=e._layouts;var c=t[e._activeLayoutIndex];var a=e._enableActions;var n=s.children(".view-grid").find("table");if(!a||!c.Configuration.CloseIncidentActionLink.Enabled&&!c.Configuration.CloseIncidentActionLink.URL){return}var f=oe(c.Configuration.CloseIncidentActionLink);if(c.Configuration.CloseIncidentActionLink.ShowModal==1){n.find(".close-case-link").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var o=a.data("id");var l=s.children(".modal-closecase");var d=l.find("button.primary");d.off("click");d.on("click",function(e){e.preventDefault();ee(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=c.Configuration.EntityName;a.Id=o;t.entityReference=a;var n=c.Configuration.CloseIncidentActionLink.DefaultResolution;var i=c.Configuration.CloseIncidentActionLink.DefaultResolutionDescription;t.resolutionSubject=n;t.resolutionDescription=i;var r=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:f,data:r}).done(function(){l.modal("hide");g(c.Configuration.CloseIncidentActionLink.SuccessMessage,s,true);y(s,c.Configuration.CloseIncidentActionLink)}).fail(function(e){l.modal("hide");X(b(e),s)}).always(function(){d.removeAttr("disabled","disabled").find(".fa-spin").remove()})});l.on("show.bs.modal",function(){l.attr("aria-hidden","false")});l.modal();l.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){l.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})}else{n.find(".close-case-link").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var n=a.data("id");var i={};var r={};r.LogicalName=c.Configuration.EntityName;r.Id=n;i.entityReference=r;var o=c.Configuration.CloseIncidentActionLink.DefaultResolution;var l=c.Configuration.CloseIncidentActionLink.DefaultResolutionDescription;i.resolutionSubject=o;i.resolutionDescription=l;var d=JSON.stringify(i);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:f,data:d}).done(function(){g(c.Configuration.CloseIncidentActionLink.SuccessMessage,s,true);y(s,c.Configuration.CloseIncidentActionLink)}).fail(function(e){X(b(e),s)}).always(function(){})})}};a.prototype.addConvertQuoteActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.ConvertQuoteToOrderActionLink.Enabled&&!l.Configuration.ConvertQuoteToOrderActionLink.URL){return}var d=oe(l.Configuration.ConvertQuoteToOrderActionLink);if(l.Configuration.ConvertQuoteToOrderActionLink.ShowModal==1){n.find(".convert-quote-link").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var n=a.data("id");var i=o.children(".modal-convert-quote");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();ee(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");g(l.Configuration.ConvertQuoteToOrderActionLink.SuccessMessage,o,true);y(o,l.Configuration.ConvertQuoteToOrderActionLink)}).fail(function(e){i.modal("hide");X(b(e),o)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})}else{n.find(".convert-quote-link").on("click",function(e){e.preventDefault();var t=ee(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){g(l.Configuration.ConvertQuoteToOrderActionLink.SuccessMessage,o,true);y(o,l.Configuration.ConvertQuoteToOrderActionLink)}).fail(function(e){X(b(e),o)}).always(function(){})})}};a.prototype.addConvertOrderActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.ConvertOrderToInvoiceActionLink.Enabled&&!l.Configuration.ConvertOrderToInvoiceActionLink.URL){return}var d=oe(l.Configuration.ConvertOrderToInvoiceActionLink);if(l.Configuration.ConvertOrderToInvoiceActionLink.ShowModal==1){n.find(".convert-order-link").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var n=a.data("id");var i=o.children(".modal-convert-order");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();ee(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");g(l.Configuration.ConvertOrderToInvoiceActionLink.SuccessMessage,o,true);y(o,l.Configuration.ConvertOrderToInvoiceActionLink)}).fail(function(e){i.modal("hide");X(b(e),o)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})}else{n.find(".convert-order-link").on("click",function(e){e.preventDefault();var t=ee(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){g(l.Configuration.ConvertOrderToInvoiceActionLink.SuccessMessage,o,true);y(o,l.Configuration.ConvertOrderToInvoiceActionLink)}).fail(function(e){X(b(e),o)}).always(function(){})})}};a.prototype.addCalculateOpportunityActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.CalculateOpportunityActionLink.Enabled&&!l.Configuration.CalculateOpportunityActionLink.URL){return}var d=oe(l.Configuration.CalculateOpportunityActionLink);if(l.Configuration.CalculateOpportunityActionLink.ShowModal==1){n.find(".calculate-opportunity-link").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var n=a.data("id");var i=o.children(".modal-calculate");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();ee(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");g(l.Configuration.CalculateOpportunityActionLink.SuccessMessage,o,true);y(o,l.Configuration.CalculateOpportunityActionLink)}).fail(function(e){i.modal("hide");X(b(e),o)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})}else{n.find(".calculate-opportunity-link").on("click",function(e){e.preventDefault();var t=ee(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){g(l.Configuration.CalculateOpportunityActionLink.SuccessMessage,o,true);y(o,l.Configuration.CalculateOpportunityActionLink)}).fail(function(e){X(b(e),o)}).always(function(){})})}};a.prototype.addResolveCaseActionLinkClickEventHandlers=function(){var e=this;var d=e._element;var t=e._layouts;var s=t[e._activeLayoutIndex];var a=e._enableActions;var n=d.children(".view-grid").find("table");if(!a||!s.Configuration.ResolveCaseActionLink.Enabled&&!s.Configuration.ResolveCaseActionLink.URL){return}var c=oe(s.Configuration.ResolveCaseActionLink);var f=d.children(".modal-resolvecase");n.find(".resolve-case-link").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var o=a.data("id");var l=f.find("button.primary");l.off("click");l.on("click",function(e){e.preventDefault();ee(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=s.Configuration.EntityName;a.Id=o;t.entityReference=a;var n=f.find(".resolution-input");t.resolutionSubject=n.val();var i=f.find(".resolution-description-input");t.resolutionDescription=i.val();var r=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:c,data:r}).done(function(){f.modal("hide");g(s.Configuration.ResolveCaseActionLink.SuccessMessage,d,true);y(d,s.Configuration.ResolveCaseActionLink)}).fail(function(e){f.modal("hide");X(b(e),d)}).always(function(){l.removeAttr("disabled","disabled").find(".fa-spin").remove()})});f.on("show.bs.modal",function(){f.attr("aria-hidden","false")});f.modal();f.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){f.attr("aria-hidden","true");f.find(".resolution-input").val("");f.find(".resolution-description-input").val("");t.closest(".action").children("a").trigger("focus")})})};a.prototype.addReopenCaseActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.ReopenCaseActionLink.Enabled&&!l.Configuration.ReopenCaseActionLink.URL){return}var d=oe(l.Configuration.ReopenCaseActionLink);if(l.Configuration.ReopenCaseActionLink.ShowModal==1){n.find(".reopen-case-link").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var n=a.data("id");var i=o.children(".modal-reopencase");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();ee(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");g(l.Configuration.ReopenCaseActionLink.SuccessMessage,o,true);y(o,l.Configuration.ReopenCaseActionLink)}).fail(function(e){i.modal("hide");X(b(e),o)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})}else{n.find(".reopen-case-link").on("click",function(e){e.preventDefault();var t=ee(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){g(l.Configuration.ReopenCaseActionLink.SuccessMessage,o,true);y(o,l.Configuration.ReopenCaseActionLink)}).fail(function(e){X(b(e),o)}).always(function(){})})}};a.prototype.addCancelCaseActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.CancelCaseActionLink.Enabled&&!l.Configuration.CancelCaseActionLink.URL){return}var d=oe(l.Configuration.CancelCaseActionLink);if(l.Configuration.CancelCaseActionLink.ShowModal==1){n.find(".cancel-case-link").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var n=a.data("id");var i=o.children(".modal-cancelcase");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();ee(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");g(l.Configuration.CancelCaseActionLink.SuccessMessage,o,true);y(o,l.Configuration.CancelCaseActionLink)}).fail(function(e){i.modal("hide");X(b(e),o)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})}else{n.find(".cancel-case-link").on("click",function(e){e.preventDefault();var t=ee(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){g(l.Configuration.CancelCaseActionLink.SuccessMessage,o,true);y(o,l.Configuration.CancelCaseActionLink)}).fail(function(e){X(b(e),o)}).always(function(){})})}};a.prototype.addActivateActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.ActivateActionLink.Enabled&&!l.Configuration.ActivateActionLink.URL){return}var d=oe(l.Configuration.ActivateActionLink);if(l.Configuration.ActivateActionLink.ShowModal==1){n.find(".activate-link").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var n=a.data("id");var i=o.children(".modal-activate");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();ee(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");g(l.Configuration.ActivateActionLink.SuccessMessage,o,true);y(o,l.Configuration.ActivateActionLink)}).fail(function(e){i.modal("hide");X(b(e),o)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})}else{n.find(".activate-link").on("click",function(e){e.preventDefault();var t=ee(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){g(l.Configuration.ActivateActionLink.SuccessMessage,o,true);y(o,l.Configuration.ActivateActionLink)}).fail(function(e){X(b(e),o)})})}};a.prototype.addDeactivateActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.DeactivateActionLink.Enabled&&!l.Configuration.DeactivateActionLink.URL){return}var d=oe(l.Configuration.DeactivateActionLink);if(l.Configuration.DeactivateActionLink.ShowModal==1){n.find(".deactivate-link").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var n=a.data("id");var i=o.children(".modal-deactivate");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();ee(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");g(l.Configuration.DeactivateActionLink.SuccessMessage,o,true);y(o,l.Configuration.DeactivateActionLink)}).fail(function(e){i.modal("hide");X(b(e),o)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})}else{n.find(".deactivate-link").on("click",function(e){e.preventDefault();var t=ee(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){g(l.Configuration.DeactivateActionLink.SuccessMessage,o,true);y(o,l.Configuration.DeactivateActionLink)}).fail(function(e){X(b(e),o)})})}};a.prototype.addActivateQuoteActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.ActivateQuoteActionLink.Enabled&&!l.Configuration.ActivateQuoteActionLink.URL){return}var d=oe(l.Configuration.ActivateQuoteActionLink);if(l.Configuration.ActivateQuoteActionLink.ShowModal==1){n.find(".activate-quote-link").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var n=a.data("id");var i=o.children(".modal-activate-quote");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();ee(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");g(l.Configuration.ActivateQuoteActionLink.SuccessMessage,o,true);y(o,l.Configuration.ActivateQuoteActionLin)}).fail(function(e){i.modal("hide");X(b(e),o)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})}else{n.find(".activate-quote-link").on("click",function(e){e.preventDefault();var t=ee(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){g(l.Configuration.ActivateQuoteActionLink.SuccessMessage,o,true);y(o,l.Configuration.ActivateQuoteActionLin)}).fail(function(e){X(b(e),o)})})}};a.prototype.addSetOpportunityOnHoldActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.SetOpportunityOnHoldActionLink.Enabled&&!l.Configuration.SetOpportunityOnHoldActionLink.URL){return}var d=oe(l.Configuration.SetOpportunityOnHoldActionLink);if(l.Configuration.SetOpportunityOnHoldActionLink.ShowModal==1){n.find(".set-opportunity-on-hold-link").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var n=a.data("id");var i=o.children(".modal-set-opportunity-on-hold");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();ee(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");g(l.Configuration.SetOpportunityOnHoldActionLink.SuccessMessage,o,true);y(o,l.Configuration.SetOpportunityOnHoldActionLink)}).fail(function(e){i.modal("hide");X(b(e),o)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})}else{n.find(".set-opportunity-on-hold-link").on("click",function(e){e.preventDefault();var t=ee(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){g(l.Configuration.SetOpportunityOnHoldActionLink.SuccessMessage,o,true);y(o,l.Configuration.SetOpportunityOnHoldActionLink)}).fail(function(e){X(b(e),o)})})}};a.prototype.addReopenOpportunityActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.ReopenOpportunityActionLink.Enabled&&!l.Configuration.ReopenOpportunityActionLink.URL){return}var d=oe(l.Configuration.ReopenOpportunityActionLink);if(l.Configuration.ReopenOpportunityActionLink.ShowModal==1){n.find(".reopen-opportunity-link").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var n=a.data("id");var i=o.children(".modal-reopen-opportunity");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();ee(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");g(l.Configuration.ReopenOpportunityActionLink.SuccessMessage,o,true);y(o,l.Configuration.ReopenOpportunityActionLink)}).fail(function(e){i.modal("hide");X(b(e),o)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})}else{n.find(".reopen-opportunity-link").on("click",function(e){e.preventDefault();var t=ee(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){g(l.Configuration.ReopenOpportunityActionLink.SuccessMessage,o,true);y(o,l.Configuration.ReopenOpportunityActionLink)}).fail(function(e){X(b(e),o)})})}};a.prototype.addWinOpportunityActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.WinOpportunityActionLink.Enabled&&!l.Configuration.WinOpportunityActionLink.URL){return}var d=oe(l.Configuration.WinOpportunityActionLink);if(l.Configuration.WinOpportunityActionLink.ShowModal==1){n.find(".win-opportunity-link").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var n=a.data("id");var i=o.children(".modal-win-opportunity");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();ee(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");g(l.Configuration.WinOpportunityActionLink.SuccessMessage,o,true);y(o,l.Configuration.WinOpportunityActionLink)}).fail(function(e){i.modal("hide");X(b(e),o)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})}else{n.find(".win-opportunity-link").on("click",function(e){e.preventDefault();var t=ee(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){g(l.Configuration.WinOpportunityActionLink.SuccessMessage,o,true);y(o,l.Configuration.WinOpportunityActionLink)}).fail(function(e){X(b(e),o)})})}};a.prototype.addLoseOpportunityActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.LoseOpportunityActionLink.Enabled&&!l.Configuration.LoseOpportunityActionLink.URL){return}var d=oe(l.Configuration.LoseOpportunityActionLink);if(l.Configuration.LoseOpportunityActionLink.ShowModal==1){n.find(".lose-opportunity-link").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var n=a.data("id");var i=o.children(".modal-lose-opportunity");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();ee(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");g(l.Configuration.LoseOpportunityActionLink.SuccessMessage,o,true);y(o,l.Configuration.LoseOpportunityActionLink)}).fail(function(e){i.modal("hide");X(b(e),o)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})}else{n.find(".lose-opportunity-link").on("click",function(e){e.preventDefault();var t=ee(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){g(l.Configuration.LoseOpportunityActionLink.SuccessMessage,o,true);y(o,l.Configuration.LoseOpportunityActionLink)}).fail(function(e){X(b(e),o)})})}};a.prototype.addGenerateQuoteFromOpportunityActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.GenerateQuoteFromOpportunityActionLink.Enabled&&!l.Configuration.GenerateQuoteFromOpportunityActionLink.URL){return}var d=oe(l.Configuration.GenerateQuoteFromOpportunityActionLink);if(l.Configuration.GenerateQuoteFromOpportunityActionLink.ShowModal==1){n.find(".generate-quote-from-opportunity-link").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var n=a.data("id");var i=o.children(".modal-generate-quote-from-opportunity");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();ee(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");g(l.Configuration.GenerateQuoteFromOpportunityActionLink.SuccessMessage,o,true);y(o,l.Configuration.GenerateQuoteFromOpportunityActionLink)}).fail(function(e){i.modal("hide");X(b(e),o)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})}else{n.find(".generate-quote-from-opportunity-link").on("click",function(e){e.preventDefault();var t=ee(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){g(l.Configuration.GenerateQuoteFromOpportunityActionLink.SuccessMessage,o,true);y(o,l.Configuration.GenerateQuoteFromOpportunityActionLink)}).fail(function(e){X(b(e),o)})})}};a.prototype.addDisassociateActionLinkClickEventHandlers=function(){var e=this;var v=e._element;var t=e._layouts;var m=t[e._activeLayoutIndex];var a=e._enableActions;var n=v.children(".view-grid").find("table");if(!a||!m.Configuration.DisassociateActionLink.Enabled||!m.Configuration.DisassociateActionLink.URL){return}var h=oe(m.Configuration.DisassociateActionLink);if(m.Configuration.DisassociateActionLink.ShowModal==1){n.find(".disassociate-link").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var f=a.data("id");var u=v.children(".modal-disassociate");var p=u.find("button.primary");p.off("click");p.on("click",function(e){e.preventDefault();ee(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t=v.data("ref-entity");var a=v.data("ref-id");var n=v.data("ref-rel");var i=v.data("ref-rel-role");if(!t||!a||!n){return}var r={LogicalName:t,Id:a};var o={SchemaName:n};if(i){o.PrimaryEntityRole=i}var l={};l.LogicalName=m.Configuration.EntityName;l.Id=f;var d=[];d[0]=l;var s={};s.target=r;s.RelatedEntities=d;s.Relationship=o;var c=JSON.stringify(s);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:h,data:c}).done(function(){u.modal("hide");g(m.Configuration.DisassociateActionLink.SuccessMessage,v,true);y(v,m.Configuration.DisassociateActionLink)}).fail(function(e){u.modal("hide");X(b(e),v)}).always(function(){p.removeAttr("disabled","disabled").find(".fa-spin").remove()})});u.on("show.bs.modal",function(){u.attr("aria-hidden","false")});u.modal();u.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){u.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})}else{n.find(".disassociate-link").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var n=a.data("id");var i=v.data("ref-entity");var r=v.data("ref-id");var o=v.data("ref-rel");var l=v.data("ref-rel-role");if(!i||!r||!o){return}var d={LogicalName:i,Id:r};var s={SchemaName:o};if(l){s.PrimaryEntityRole=l}var c={};c.LogicalName=m.Configuration.EntityName;c.Id=n;var f=[];f[0]=c;var u={};u.target=d;u.RelatedEntities=f;u.Relationship=s;var p=JSON.stringify(u);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:h,data:p}).done(function(){g(m.Configuration.DisassociateActionLink.SuccessMessage,v,true);y(v,m.Configuration.DisassociateActionLink)}).fail(function(e){X(b(e),v)})})}};a.prototype.addWorkflowActionLinkClickEventHandlers=function(){var e=this;var p=e._element;var t=e._layouts;var v=t[e._activeLayoutIndex];var a=e._enableActions;var n=p.children(".view-grid").find("table");if(!a||!v.Configuration.ItemActionLinks||v.Configuration.ItemActionLinks.length==0){return}var i=null;for(var r=0;r<v.Configuration.ItemActionLinks.length;r++){var o=v.Configuration.ItemActionLinks[r];if(o!=null&&typeof o.Type!==typeof undefined&&o.Type==7&&typeof o.Workflow!==typeof undefined&&o.Workflow!=null){i=o;break}}if(i==null)return;if(i.ShowModal==1){n.find(".workflow-link").on("click",function(e){e.preventDefault();var t=ee(this);var a=ee(this).closest("tr");var d=a.data("id");var s=ee(this).data("workflowid");var c=p.children(".modal-run-workflow");var f=c.find("button.primary");var u=ee(this).data("url");if(!s||!u){return}var n=ee(this).data("modal-title");if(n){c.find(".modal-title").html(n)}var i=ee(this).data("modal-confirmation");if(i){c.find(".modal-body").html(i)}var r=ee(this).data("modal-primary-action");if(r){f.html(r);f.attr("title",r);f.attr("aria-label",r)}var o=ee(this).data("modal-cancel-action");if(o){c.find(".cancel").html(o)}f.off("click");f.on("click",function(e){e.preventDefault();ee(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t=null;for(var a=0;a<v.Configuration.ItemActionLinks.length;a++){var n=v.Configuration.ItemActionLinks[a];if(n!=null&&typeof n.Type!==typeof undefined&&n.Type==7&&typeof n.Workflow!==typeof undefined&&n.Workflow!=null&&n.Workflow.Id==s){t=n;break}}var i={};var r={};r.LogicalName="workflow";r.Id=s;i.workflow=r;var o={};o.LogicalName=v.Configuration.EntityName;o.Id=d;i.entity=o;var l=JSON.stringify(i);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:u,data:l}).done(function(){c.modal("hide");g(t!=null?t.SuccessMessage:null,p,true);y(p,t)}).fail(function(e){c.modal("hide");X(b(e),p)}).always(function(){f.removeAttr("disabled","disabled").find(".fa-spin").remove()})});c.on("show.bs.modal",function(){c.attr("aria-hidden","false")});c.modal();c.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){c.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})}else{n.find(".workflow-link").on("click",function(e){e.preventDefault();var t=ee(this).closest("tr");var a=t.data("id");var n=ee(this).data("workflowid");var i=ee(this).data("url");if(!n||!i){return}var r=null;for(var o=0;o<v.Configuration.ItemActionLinks.length;o++){var l=v.Configuration.ItemActionLinks[o];if(l!=null&&typeof l.Type!==typeof undefined&&l.Type==7&&typeof l.Workflow!==typeof undefined&&l.Workflow!=null&&l.Workflow.Id==n){r=l;break}}var d={};var s={};s.LogicalName="workflow";s.Id=n;d.workflow=s;var c={};c.LogicalName=v.Configuration.EntityName;c.Id=a;d.entity=c;var f=JSON.stringify(d);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:i,data:f}).done(function(){g(r!=null?r.SuccessMessage:null,p,true);y(p,r)}).fail(function(e){X(b(e),p)})})}};a.prototype.initializePagination=function(e,t){var i=this;var a=i._element;var n=a.children(".view-pagination");if(typeof e===typeof undefined||e===false||e==null){n.hide();return}if(typeof e.PageSize===typeof undefined||e.PageSize===false||e.PageSize==null||(typeof e.PageCount===typeof undefined||e.PageCount===false||e.PageCount==null)||(typeof e.PageNumber===typeof undefined||e.PageNumber===false||e.PageNumber==null)||(typeof e.ItemCount===typeof undefined||e.ItemCount===false||e.ItemCount==null)){n.hide();return}if(e.ItemCount===-1){i.initializePager(n,e,t);return}if(e.PageCount<=1){n.hide();return}if(e.PageNumber>e.PageCount){e.PageCount=e.PageNumber}if(e.PageNumber===e.PageCount&&e.MoreRecords){e.PageCount++}n.data("pagesize",e.PageSize).data("pages",e.PageCount).data("current-page",e.PageNumber).data("count",e.ItemCount).off("click").pagination({total_pages:n.data("pages"),current_page:n.data("current-page"),callback:function(e,t){e.preventDefault();var a=ee(e.target).closest("li");if(a.not(".disabled").length>0&&a.not(".active").length>0){var n=i.getCurrentFilter();i.load(t,n,!i.isRelatedRecordFilterEnabled(),e.currentTarget)}}}).show();n.find("li").first().find("a").attr("aria-label",window.ResourceManager["Pagination_Previous_Page"]);n.find("li").last().find("a").attr("aria-label",window.ResourceManager["Pagination_Next_Page"]);n.find("li.active").find("a").removeAttr("aria-label");n.find("li.active").find("a").attr("aria-current",window.ResourceManager["Pagination_Shortname"]);a.children(".view-grid").addClass("has-pagination");a.children(".view-grid").css("height","");ee("ul>li>a[data-page='..']",n).attr("aria-label",window.ResourceManager["Load_More_Pages"]);if(t){n.find("a").filter(function(){return ee(this).text()==ee(t).text()}).trigger("focus")}};a.prototype.hidePagination=function(){this._element.children(".view-pagination").hide();this._element.children(".view-grid").removeClass("has-pagination")};a.prototype.initializePager=function(e,t,a){var r=this;var n=r._element;var i=window.ResourceManager["Pagination_First_Page"];var o=ee("<a>").attr("href","#").data("page",1).attr("aria-label",i).attr("title",i).text("|<");var l=ee("<li>").append(o);var d=window.ResourceManager["Pagination_Previous_Page"];var s=ee("<a>").attr("href","#").attr("aria-label",d).attr("title",d).text("<");var c=ee("<li>").append(s);var f=ee("<li>").addClass("active").append(ee("<span>").text(t.PageNumber));var u=window.ResourceManager["Pagination_Next_Page"];var p=ee("<a>").attr("href","#").attr("aria-label",u).attr("title",u).text(">");var v=ee("<li>").append(p);var m=ee("<ul>").addClass("pagination").append(l).append(c).append(f).append(v);e.empty();if(t.PageNumber===1&&!t.MoreRecords){e.hide();return}if(t.PageNumber>1){s.data("page",t.PageNumber-1)}else{l.addClass("disabled");o.attr("aria-disabled",true);c.addClass("disabled");s.attr("aria-disabled",true)}if(t.MoreRecords){p.data("page",t.PageNumber+1)}else{v.addClass("disabled");p.attr("aria-disabled",true)}e.data("pagesize",t.PageSize).data("current-page",t.PageNumber).data("more-records",t.MoreRecords).off("click").append(m).on("click","a",function(e){e.preventDefault();var t=ee(e.target);var a=t.data("page");var n=t.closest("li");if(n.not(".disabled").length>0&&n.not(".active").length>0){var i=r.getCurrentFilter();r.load(a,i,!r.isRelatedRecordFilterEnabled(),e.currentTarget)}}).show();n.children(".view-grid").addClass("has-pagination");if(a){e.find("a").filter(function(){return ee(this).text()==ee(a).text()}).trigger("focus")}};a.prototype.createWindowMessageEventHandler=function(){return function(e){var t=null;if(!window.location.origin){t=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}else{t=window.location.origin}if(e.origin!=t){return}if(e.data=="Success"){this._element.children(".modal-form").modal("hide");this._element.trigger("refresh")}}.bind(this)};a.prototype.resetPagination=function(){var e=this;var t=e._element;var a=t.children(".view-pagination");a.data("pages",1).data("current-page",1)};function le(e){var a=[];var t=function(e){var t=e.data("columnname");if(t){t=t.replace(/<(?:.|\n)*?>/gm,"").trim();return t}var a=e.children("a");var n=a.length>0?a.first():e;var i=n.contents().get(0);return i?i.nodeValue:""};e.find("thead th").each(function(){var e=ee(this);a.push(t(e))});e.find("tbody tr").each(function(){ee(this).find("td").each(function(e){var t=ee(this)[0].innerText;ee(this).attr("data-th",a[e]).attr("aria-label",a[e]+" "+t)});if(a[0]=="Select"){ee(this).find("td:first-child").attr("tabindex",0).attr("role","checkbox")}})}function n(e,t){t.prop("aria-hidden",false);if(typeof e!==typeof undefined&&e!==false&&e!=null){console.log(e);var a="Error";var n=t.find(".modal-title");var i=t.find(".modal-body");n.data("title",n.html());if(typeof e.Message!==typeof undefined&&e.Message!==false&&e.Message!=null){if(typeof e.Message==="number"){a=e.Message+" Error"}else{a=e.Message}}n.addClass("text-danger").html("<span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+a);if(typeof e.InnerError!==typeof undefined&&e.InnerError!==false&&e.InnerError!=null){i.html("<p>"+e.InnerError.Message+"</p>")}}t.modal()}function Z(e){var t=[];if(e==null){return t}var a=/(\w+)\s*(asc|ascending|desc|descending)?\s*(,)?/gi;var n=e.match(a);if(n==null){return t}for(var i=0;i<n.length;i++){var r=n[i];if(r!=null&&r!=""){var o;var l="ASC";var d=r.indexOf(" ");if(d!=-1){o=r.substr(0,d);l=r.substr(d+1,r.length-d)}else{o=r}if(o!=null){o=o.replace(/,\s*$/,"")}if(l!=null){l=l.replace(/,\s*$/,"")}var s={name:o,direction:l};t.push(s)}}return t}function de(e,a,n){var i=-1;ee.each(e,function(e,t){if(t[a].toString().toLowerCase().indexOf(n.toString().toLowerCase())!=-1){i=e;return false}});return i}if(!String.prototype.startsWith){String.prototype.startsWith=function(e,t){t=t||0;return this.lastIndexOf(e,t)===t}}function se(e){var t,a,n;if(!e){return null}t=e.Attributes||[];for(a=0;a<t.length;a++){n=t[a];if(n&&n.AttributeMetadata&&n.AttributeMetadata.EntityLogicalName===e.EntityName&&n.AttributeMetadata.IsPrimaryName){return n.DisplayValue}}}function ce(e){if(!e||!e.RedirectUrl)return null;return i(e.RedirectUrl)}function i(e){if(!e)return null;return URI(e.PathWithQueryString)}function k(e){var t=[];if(!e)return t;if(e.EntityName==="entitlement"){var a=ee("#customerid").val();var n=ee("#customerid_entityname").val();var i=ee("#primarycontactid").val();var r=ee("#productid").val();if(a){t=[{Key:"customerid",Value:a},{Key:"customertype",Value:n},{Key:"primarycontactid",Value:i},{Key:"productid",Value:r}]}return t}else if(e.ModalLookupEntityLogicalName==="opportunityproduct"){t=[{Key:"productid",Value:ee("#productid").val()},{Key:"uomid",Value:ee("#uomid").val()}];return t}else{return t}}function l(e){if(typeof e=="undefined"||e==null||e=="")return;ee.blockUI({css:{border:"none",backgroundColor:"transparent",opacity:.5,color:"#fff"},message:"<span class='fa fa-2x fa-spinner fa-pulse' aria-hidden='true'></span>"});if(parent){parent.location.replace(e)}else{window.location.replace(e)}}function d(e){if(!e||!e.RedirectUrl)return null;return URI(e.RedirectUrl.PathWithQueryString)}function fe(){try{return window.self!==window.top}catch(e){return true}}var o=!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/);if(o){ee("html, body").css("overflow-x","hidden")}})(jQuery);(function(f){function e(e){this._element=f(e);this._associate=this._element.data("associate")||{};this._url=this._element.attr("data-url");this._parent=this._element.parent(".entity-grid");this._success=false}f(document).ready(function(){f(".entity-associate").each(function(){new e(f(this)).render()})});e.prototype.render=function(){var e=this;var t=e._element;var l=t.find(".panel-body.selected-records");var a=t.find(".entity-grid");var n=t.find(".modal-footer .btn-primary");var d=t.find(".modal-associate");var i=e._parent;n.on("click",function(){d.find(".alert-danger.error").remove();e.associate()});var r=function(){var a=f(this);var e=a.attr("data-entity");var t=a.attr("data-id");var n=a.attr("data-name");var i=l.find("div[data-entity='"+e+"'][data-id='"+t+"']");if(!a.hasClass("selected")){i.remove();if(l.children(".item").length>=1){return}d.find(".modal-content .modal-footer .primary.btn.btn-primary").attr("disabled","disabled");return}else{d.find(".modal-content .modal-footer .primary.btn.btn-primary").removeAttr("disabled")}if(i.length>0){d.find(".modal-content .modal-footer .primary.btn.btn-primary").removeAttr("disabled");return}var r=f("<div class='item pull-left btn btn-default'></div>").attr("data-entity",e).attr("data-id",t).attr("data-name",n).append(f("<span class='name'></span>").html(n));var o=f("<span class='remove' aria-label='"+window.ResourceManager["Remove_DefaultText"]+"' tabindex=0><span class='fa fa-times'></span></span>").on("click keydown",function(e){var t=e.keyCode?e.keyCode:e.which;if(e.type=="click"||t=="13"||t=="32"){r.remove();a.find("td:first").empty();a.removeClass("selected").removeClass("info");if(l.children(".item").length>=1){d.find(".modal-content .modal-footer .primary.btn.btn-primary").removeAttr("disabled")}else{d.find(".modal-content .modal-footer .primary.btn.btn-primary").attr("disabled","disabled")}}});r.append(o);l.append(r)};a.children(".view-grid").on({click:r,keypress:function(e){var t=e.keyCode?e.keyCode:e.which;if(t=="13"||t=="32"){e.preventDefault();r.apply(this,arguments)}}},"tr");d.on("show.bs.modal",function(){d.attr("aria-hidden","false");if(l.children(".item").length==0){d.find(".modal-content .modal-footer .primary.btn.btn-primary").attr("disabled","disabled")}a.trigger("refresh")});d.on("hidden.bs.modal",function(){d.attr("aria-hidden","true");d.find(".alert-danger.error").remove();l.empty();d.find(".modal-content .modal-footer .primary.btn.btn-primary").removeAttr("disabled");a.children(".view-toolbar").find(".view-search input.query").val("");a.children(".view-grid").find("tbody tr.selected").each(function(){f(this).find("td:first").empty();f(this).removeClass("selected").removeClass("info")});if(e._success){i.trigger("refresh")}})};e.prototype.associate=function(){var e=this;var t=e._element;var a=e._associate;var n=e._url;var i=t.find(".panel-body.selected-records");var r=t.find(".modal-footer button.primary");var o=t.find(".modal-associate");if(n==null||n==""){var l={Message:"System Error",InnerError:{Message:window.ResourceManager["Service_URL_To_Associate_Request_Could_Determined"]}};u(l,o);return}var d=f.map(i.find("div.item"),function(e){return{LogicalName:f(e).attr("data-entity"),Id:f(e).attr("data-id"),Name:f(e).attr("data-name")}});if(d.length<=0){return}r.attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var s=a;s.RelatedEntities=d;console.log(s);var c=JSON.stringify(s);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:n,data:c}).done(function(){e._success=true;o.modal("hide")}).fail(function(e){u(p(e),o)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-spin").remove()})};function u(e,t){if(typeof e!==typeof undefined&&e!==false&&e!=null){console.log(e);var a=t.find(".modal-body");var n=t.find(".alert-danger.error");if(n.length==0){n=f("<div></div>").addClass("alert alert-block alert-danger error clearfix")}else{n.empty()}if(typeof e.Message!==typeof undefined&&e.Message!==false&&e.Message!=null){if(typeof e.Message==="number"){n.append("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+e.Message+" Error</p>")}else{n.append("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+e.Message+"</p>")}}if(typeof e.InnerError!==typeof undefined&&e.InnerError!==false&&e.InnerError!=null){n.append("<p>"+e.InnerError.Message+"</p>")}a.prepend(n)}}function p(e){var t={Message:window.ResourceManager["UnKnown_Error_Occurred"]};if(e==null)return t;try{var a=e.getResponseHeader("content-type");if(a!=null){t=a.indexOf("json")>-1?f.parseJSON(e.responseText):{Message:e.status,InnerError:{Message:e.statusText}}}else{t={Message:e.statusText}}}catch(e){t={Message:e.message}}return t}})(jQuery);(function(c){function e(e){this._element=c(e);this._target=this._element.data("target")||{};this._url=this._element.attr("data-url");this._lookupDataFieldName=this._element.attr("data-lookup-datafieldname");this._lookupReferenceEntityFormId=this._element.attr("data-lookup-reference_entityformid");this._languageCode=this._element.attr("data-languageCode")}c(document).ready(function(){c(".entity-lookup").each(function(){new e(c(this)).render()})});e.prototype.render=function(){var t=this;var i=t._element;var r=i.find(".entity-grid");var e=i.find(".modal-footer button.primary");var a=i.find(".modal-lookup");var o=i.find(".modal-lookup-create-form");var l=this._lookupReferenceEntityFormId;var d=this._languageCode;i.find(".modal-footer .remove-value").on("click",function(e){e.preventDefault();t.clearFieldValue()});i.find(".modal-footer .cancel").on("click",function(e){t.setFocusOnCancel()});i.find(".modal-header .form-close").on("click",function(e){t.setFocusOnCancel()});e.on("click",function(){a.find(".alert-danger.error").remove();t.setFieldValue()});c("#"+t._lookupDataFieldName+"_name").on("keydown",function(e){if(e.keyCode===8||e.keyCode===46){t.clearFieldValue();e.stopPropagation();e.preventDefault()}});i.closest("td.lookup.form-control-cell").find(".clearlookupfield").on("click",function(e){e.preventDefault();t.clearFieldValue()}).toggle(!!c("#"+t._lookupDataFieldName).val());i.closest("td.lookup.form-control-cell").find(".launchentitylookup").on("click",function(e){e.preventDefault();i.find(".view-pagination").data("pages",1).data("current-page",1);a.modal()});i.closest("td.lookup.form-control-cell").find(".new-value").on("click",function(e){e.preventDefault();var t=o.find("iframe");var a=t.data("page");if(!l){return}var n=a+"?lookup=true&entityformid="+l+"&languagecode="+d;t.attr("src",n);t.on("load",function(){o.find(".form-loading").hide();o.find("iframe").contents().find("#EntityFormControl").show()});o.find(".form-loading").show();o.find("iframe").contents().find("#EntityFormControl").hide();o.modal();window.addEventListener("message",function(e){var t,a;if(!window.location.origin){t=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}else{t=window.location.origin}if(e.origin!=t){return}try{a=c.parseJSON(e.data)}catch(e){return}if(a.type==="Success"){e.preventDefault();i.children(".modal-form").modal("hide");r.data("selected",a.id);r.trigger("refresh")}e.target.removeEventListener(e.type,arguments.callee)})});o.on("show.bs.modal",function(){o.attr("aria-hidden","false")});o.on("hidden.bs.modal",function(){o.attr("aria-hidden","true");i.closest("td.lookup.form-control-cell").find(".new-value").trigger("focus")});a.on("show.bs.modal",function(){a.attr("aria-hidden","false");r.data("selected",c("#"+t._lookupDataFieldName).val());r.trigger("refresh")});a.on("hidden.bs.modal",function(e){a.attr("aria-hidden","true");a.find(".alert-danger.error").remove();r.children(".view-toolbar").find(".view-search input.query").val("");r.children(".view-grid").find("tr.selected").each(function(){c(this).find("td:first").empty();c(this).removeClass("selected").removeClass("info")});r.children(".view-toolbar").find(".toggle-related-filter").addClass("active");e.stopImmediatePropagation()})};e.prototype.setFieldValue=function(){var e=this;var t=e._element;var a=t.find(".modal-footer button.primary");var n=t.find(".modal-lookup");var i=t.find(".entity-grid");var r=e._lookupDataFieldName;var o=c("#"+r);if(o.length==0){return}var l=c("#"+r+"_name");if(l.length==0){return}var d=c("#"+r+"_entityname");if(d.length==0){return}var s=c.map(i.children(".view-grid").find("tr.selected"),function(e){return{LogicalName:c(e).attr("data-entity"),Id:c(e).attr("data-id"),Name:c(e).attr("data-name")}});if(s.length<=0){return}a.attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");l.val(s[0].Name);d.val(s[0].LogicalName);o.val(s[0].Id).trigger("change");n.modal("hide");t.closest("td.lookup.form-control-cell").find(".clearlookupfield").show();a.removeAttr("disabled","disabled").find(".fa-spin").remove();if(setIsDirty&&c.isFunction(setIsDirty)){setIsDirty(o.attr("id"))}l.trigger("focus")};e.prototype.clearFieldValue=function(){var e=this;var t=e._element;var a=t.find(".modal-footer button.primary");var n=t.find(".modal-lookup");var i=e._lookupDataFieldName;var r=c("#"+i);if(r.length==0){return}var o=c("#"+i+"_name");if(o.length==0){return}var l=c("#"+i+"_entityname");if(l.length==0){return}a.attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");o.val("");l.val("");r.val("").trigger("change");n.modal("hide");a.removeAttr("disabled","disabled").find(".fa-spin").remove();t.closest("td.lookup.form-control-cell").find(".clearlookupfield").hide();if(setIsDirty&&c.isFunction(setIsDirty)){setIsDirty(r.attr("id"))}o.trigger("focus")};e.prototype.setFocusOnCancel=function(){var e=this;var t=e._element;var a=t.find(".modal-lookup");var n=e._lookupDataFieldName;var i=c("#"+n);if(i.length==0){return}var r=c("#"+n+"_name");if(r.length==0){return}a.modal("hide");r.trigger("focus")}})(jQuery);(function(i){function e(e){this._element=i(e);this._lookupElement=i("#"+this._element.data("lookup-element"));this._lookupEntityNameElement=i("#"+this._element.data("lookup-element")+"_entityname");this._path=this._element.data("path");this._controlId=this._element.data("controlid");this._formName=this._element.data("formname")}i(document).ready(function(){i("iframe.quickform").each(function(){new e(i(this)).bindEvents()})});e.prototype.bindEvents=function(){var a=this;var e=a._element;var t=a._lookupElement;var n=a._lookupEntityNameElement;e.on("load.quickform",function(){a.resize()});t.on("change.quickform",function(){var e=i(this).val();if(e==null||e==""){a.clear()}else{var t=n.val();a.reload(e,t)}})};e.prototype.reload=function(e,t,a){var n=this;var i=n._element;var r=n._formName;var o=n._controlId;var l=n._path;if(typeof a=="undefined")a="";var d=l+"?entityid="+e+"&entityname="+t+"&entityprimarykeyname="+a+"&formname="+r+"&controlid="+o;i.attr("src",d)};e.prototype.clear=function(){var e=this;var t=e._element;t.attr("src","about:blank");t.css("height",0)};e.prototype.resize=function(){var e=this;var t=e._element;t.css("height",0);t.css("height",t.contents().outerHeight()+4+"px")}})(jQuery);+function(s,c){"use strict";s(document).on("click.adx.serialized-query.data-api","[data-serialized-query]",e);s(document).ready(function(){s("[data-serialized-query]").each(t)});function e(e){var t=s(this),a=t.data("serialized-query"),n=t.data("target"),i=t.closest(".entitylist"),r=i.find(".entity-grid").filter(":first"),o,l;if(r.length==1&&n){e.preventDefault();var d=s(n).find("input,select").serialize();r.trigger("metafilter",d)}else if(n&&a){o=s(n).find("input,select").serialize();l=new c;l.setSearch(a,o);window.location.href=l.toString()}}function t(){var t=s(this).data("target");if(t){s(t).find("input:radio").click(function(){var e=s(this);if(e.data("checked")){e.data("checked",null);e.prop("checked",false)}else{s(t).find("input:radio[name="+e.prop("name")+"]").data("checked",null);e.data("checked",true)}})}}}(jQuery,URI);(function(t,r){"use strict";t.Ad=function(){var e=function(e){this._element=r(e);this.url=this._element.data("url");this._element.data("ad",this)};e.prototype.init=function(){var t=this;this._element.hide();n.call(this).then(function(){i.call(t);t._element.trigger({type:"adplacement_ready",adplacement:t})},function(e){a.call(t,e)})};var a=function(e){if(console&&console.error){console.error({error:e,ad:this})}};var n=function(){var t=this;var a=r.Deferred();if(this.url){r.ajax({url:this.url,type:"GET"}).then(function(e){t.html=r(e.trim());a.resolve()},a.fail)}else{this.html=r(this._element.html().trim());a.resolve()}return a.promise()};var i=function(){this._element.html(this.html).show();this._element.trigger({type:"ad_ready",ad:this})};return e}();t.AdPlacement=function(){var e=function(e){this._element=r(e);this.url=this._element.data("url");this._element.data("adplacement",this)};e.prototype.init=function(){var t=this;t._element.hide();n.call(this).then(function(){i.call(t)},function(e){a.call(t,e)})};var a=function(e){if(console&&console.error){console.error({error:e,ad:this})}};var n=function(){var t=this;var a=r.Deferred();if(this.url){r.ajax({url:this.url,type:"GET",async:true}).then(function(e){t.html=e;a.resolve()},a.fail)}else{this.html=r(this._element.html().trim());a.resolve()}return a.promise()};var i=function(){this._element.html(this.html).show()};return e}();r(document).ready(function(){r(".ad").each(function(){var e=new t.Ad(this);e.init()});r(".adplacement").each(function(){r(this).on("adplacement_ready",function(e,t){console.log(e);console.log(t)});var e=new t.AdPlacement(this);e.init()})})})(window.adx||(window.adx={}),window.jQuery);(function(t,s){"use strict";t.Poll=function(){var e=function(e){this._element=s(e);this._content=this._element.find(".poll-content").length?this._element.find(".poll-content"):this._element;this._url=this._element.data("url");this._submitUrl=this._element.data("submit-url")};e.prototype.init=function(){var t=this;n.call(this).then(function(){i.call(t);d.call(t);t._element.trigger({type:"poll_ready",ad:t})},function(e){a.call(t,e)})};e.prototype.viewPoll=function(){o.call(this,true)};e.prototype.viewResults=function(){o.call(this,false);if(this._submitted){this._element.find(".poll-return").remove()}};var a=function(e){if(console&&console.error){console.error({error:e,poll:this})}};var n=function(){var t=this;var a=s.Deferred();if(this._url){s.ajax({url:this._url,type:"GET"}).then(function(e){t.html=s(e.trim());a.resolve()},a.fail)}else{this.html=s(this._content.html().trim());a.resolve()}return a.promise()};var i=function(){t.call(this);this._id=this._element.find(".poll-questionpanel").data("id");this._name=this._element.find(".poll-questionpanel").data("name");this._submitted=!this._element.find(".poll-questionpanel").length;r.call(this)};var t=function(){this._content.html(this.html).show()};var r=function(){if(this._submitted){this.viewResults()}else{this.viewPoll()}};var o=function(e){this._element.find(".poll-questionpanel").toggle(e);this._element.find(".poll-resultspanel").toggle(!e)};var l=function(){var t=this;var e=this._element.find("input[id^='poll_option_']:checked").val();if(e&&this._submitUrl){var a=shell.ajaxSafePost({url:this._submitUrl,async:false,type:"POST",data:JSON.stringify({pollId:this._id,optionId:e}),contentType:"application/json; charset=utf-8"});a.then(function(e){t.html=s(e.trim());i.call(t)});a.fail(function(){console.log({m:"Post Failed",d:arguments})})}};var d=function(){var e=this;this._element.on("click.poll",".poll-submit",function(){console.log("submit");l.call(e)});this._element.on("click.poll",".poll-viewresults",function(){console.log("view results");e.viewResults()});this._element.on("click.poll",".poll-return",function(){console.log("return to poll");e.viewPoll()})};return e}();t.PollPlacement=function(){var e=function(e){this._element=s(e).hide();this._url=this._element.data("url");this._element.data("pollplacement",this)};e.prototype.init=function(){var t=this;n.call(this).then(function(){i.call(t);r.call(t);t._element.trigger({type:"pollplacement_ready",pollplacement:t})},function(e){a.call(t,e)})};var a=function(e){if(console&&console.error){console.error({error:e,ad:this})}};var n=function(){var t=this;var a=s.Deferred();if(this._url){s.ajax({url:this._url}).then(function(e){t.html=s(e.trim());a.resolve()},a.fail)}else{this.html=s(this._element.html().trim());a.resolve()}return a.promise()};var i=function(){this._element.html(this.html).show()};var r=function(){o(this._element.find(".poll"))};return e}();function o(e){e.each(function(){var e=new t.Poll(this);e.init()})}function e(e){e.each(function(){var e=new t.PollPlacement(this);e.init()})}s(document).ready(function(){o(s(".poll"));e(s(".pollplacement"))})})(window.adx||(window.adx={}),window.jQuery);(function(e,r){"use strict";var o=null;e.getAuthenticationToken=function(e){o=e;r.ajax({type:"GET",url:"/_services/auth/token",cache:false,success:t,error:function(){o(null)}})};function t(e,t,a){var n=JSON.parse(a.getResponseHeader("X-Responded-JSON"));if(n&&n.status===401){var i=Number(r.cookie("chatForcedLogin"))===1;if(!i){r.cookie("chatForcedLogin",1);l()}else{r.cookie("chatForcedLogin",0);o("","Login Required")}}else{o(e)}}function l(){var e=window.location;var t=window.location.origin+"/SignIn?returnUrl="+encodeURIComponent(e);window.location=t}})(window.auth||(window.auth={}),window.jQuery);(function(v,r){"use strict";r.registerHelper("urlquerystringcheck",function(e,t){var a=(e||"").split("?");if(a.length<=1){return t.fn(this)}else{return t.inverse(this)}});var m=4;var o=27;r.registerHelper("label",function(e,t,a){if(e===t)return a.fn(this);else return a.inverse(this)});function e(e){this._element=v(e);this._url=this._element.data("url")||v("body").data("case-deflection-url");this._container=this._element.data("container");this._target=this._element.data("target");this._itemTarget=this._element.data("itemtarget");this._template=this._element.data("template");this._itemTemplate=this._element.data("itemtemplate");this._logicalNames=this._element.closest("[data-case-deflection-logicalnames]").length>0?this._element.closest("[data-case-deflection-logicalnames]").data("case-deflection-logicalnames"):this._element.closest("[data-auto-complete-logicalnames]").data("auto-complete-logicalnames");this._sortingOption=this._element.closest("[data-case-deflection-sorting-option]").length>0?this._element.closest("[data-case-deflection-sorting-option]").data("case-deflection-sorting-option"):this._element.closest("[data-auto-complete-sorting-option]").data("auto-complete-sorting-option");this._query=this._element.closest("[data-case-deflection-query]").length?this._element.closest("[data-case-deflection-query]").data("case-deflection-query"):this._element.closest("[data-auto-complete-query]").data("auto-complete-query");this._noResultsText=this._element.data("noresultstext");this._$container=null;this._compiledTemplate=null;this._compiledItemTemplate=null;if(typeof this._query===typeof undefined||this._query==null||this._query===""){this._query="(+(@subject))"}}v(document).ready(function(){v("input.case-deflection").each(function(){new e(v(this)).init()})});e.prototype.init=function(){var t=this,e=t._element,a;if(t._element.length===0){return}if(!t._url){return}if(!t._container){a=e.parent()}else{a=e.parents(t._container)}t._$container=a;if(!t._template){if(v("#case-deflection-container").length===0){return}t._compiledTemplate=r.compile(v("#case-deflection-container").html())}else{if(v(t._template).length===0){return}t._compiledTemplate=r.compile(v(t._template).html())}if(!t._itemTemplate){if(v("#case-deflection-results").length===0){return}t._compiledItemTemplate=r.compile(v("#case-deflection-results").html())}else{if(v(t._itemTemplate).length===0){return}t._compiledItemTemplate=r.compile(v(t._itemTemplate).html())}e.off("keyup.adx.case-deflection").on("keyup.adx.case-deflection",_.debounce(function(e){e.stopPropagation();t.clearResults();if(e.keyCode!=o){t.getResults()}},800));var n=a.find(".search-clear"),i=a.find(".search-apply");n.attr("aria-label",window.ResourceManager["CustomerService_Support_ClearButton"]);n.off("click.adx.case-deflection").on("click.adx.case-deflection",function(e){e.preventDefault();t.clearSearch();t.clearResults()});i.off("click.adx.case-deflection").on("click.adx.case-deflection",function(e){e.preventDefault();t.clearResults();t.getResults()})};e.prototype.clearSearch=function(){var e=this,t=e._element;t.val("")};e.prototype.clearResults=function(){var e=this,t=e._element,a=e._$container;var n=a.find(".search-more");if(!e._target){t.parent().find(".results").animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"normal","linear",function(){v(this).empty()})}else{n.parent(".panel-footer").animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"fast","linear");a.find(e._target).animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"normal","linear",function(){v(this).empty()})}n.hide();t.data("page",null)};e.prototype.getResults=function(){var e=this;e.getSearchResults()};e.prototype.getMoreResults=function(){var e=this,t=e._element,a=t.data("page");if(a!=null){a=a+1}e.getSearchResults(a)};e.prototype.getSearchResults=function(a){var n=this;var i=n._element;var r=n._$container;var o=i.val();var l=r.find(".search-more"),d,s;if(!o){if(!n._target){i.parent().find(".results").stop(true,true).animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"normal","linear",function(){v(this).empty()})}else{l.parent(".panel-footer").stop(true,true).animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"normal","linear");r.find(n._target).stop(true,true).animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"normal","linear",function(){v(this).empty()})}l.hide();i.data("page",null);return}if(o.length<m)return;l.prop("disabled",true);l.append("<span class='fa fa-spinner fa-spin'></span>");if(!n._target){if(!a){l.parent(".panel-footer").stop(true,true).animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"normal","linear");l.hide();if(i.parent().find(".results").length===1){d=i.parent().find(".results");d.stop(true,true).animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"fast","linear",function(){v(this).empty()})}else{d=v("<div class='results pull-left' style='margin-top: 20px; width: 100%;'></div>");d.hide();i.parent().append(d)}}else{d=i.parent().find(".results")}}else{if(!a){d=r.find(n._target);l.parent(".panel-footer").stop(true,true).animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"normal","linear");l.hide();d.stop(true,true).animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"fast","linear",function(){v(this).empty()})}else{d=r.find(n._target)}}var e=r.find(".case-deflection-loading");if(e.length===0){e=v("<div class='case-deflection-loading' style='text-align:center;margin-bottom:10px;margin-top:10px;width:100%;'><span class='fa fa-spinner fa-spin' aria-hidden='true'></span></div>").hide();if(!n._target){e.addClass("pull-left");d.before(e)}else{d.after(e)}}if(!a&&n._target){e.css("margin-top",0)}else{e.css("margin-top","10px")}if(!a){e.animate({opacity:"show",margin:"show",padding:"show",height:"show"},"normal","linear")}var t=a||1;var c=i.closest("[data-case-deflection-pagesize]").length>0?i.closest("[data-case-deflection-pagesize]").data("case-deflection-pagesize"):i.closest("[data-auto-complete-pagesize]").data("auto-complete-pagesize");var f=i.closest("[data-case-deflection-filter]").length>0?i.closest("[data-case-deflection-filter]").data("case-deflection-filter"):i.closest("[data-auto-complete-filter]").data("auto-complete-filter");if(c==null||c===""){c=5}var u={};u.parameters={subject:o};u.query=n._query;u.logicalNames=n._logicalNames;u.filter=f;if(typeof n._sortingOption!==typeof undefined&&n._sortingOption!=null){u.sortingOption=n._sortingOption}u.pageNumber=t;u.pageSize=c;var p=JSON.stringify(u);shell.ajaxSafePost({type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:n._url,data:p,global:false}).done(function(e){if(e==null||e.itemCount===0){if(!a){if(!n._target){l.parent(".panel-footer").animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"fast","linear")}else{if(typeof n._noResultsText!=typeof undefined&&n._noResultsText!=null&&n._noResultsText!==""){var t=v("<li class='list-group-item noresults'></li>").text(n._noResultsText);d.html(t);d.stop(true,true).animate({opacity:"show",margin:"show",padding:"show",height:"show"},"normal","linear")}}}l.hide();l.prop("disabled",false);l.find(".fa-spinner").remove();return}e.caseTitle=o;if(!a){d.html(n._compiledTemplate(e))}if(!n._itemTarget){s=r.find("#case-deflection-topics")}else{s=v(n._itemTarget)}if(s.length===0){s=d}if(a){s.append(n._compiledItemTemplate(e))}else{s.html(n._compiledItemTemplate(e));d.stop(true,true).animate({opacity:"show",margin:"show",padding:"show",height:"show"},"normal","linear")}l=r.find(".search-more");if(e.pageCount<=1||e.pageNumber===e.pageCount){if(n._target){l.parent(".panel-footer").stop(true,true).animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"normal","linear")}l.hide()}else{i.data("page",e.pageNumber);l.off("click.adx.case-deflection").on("click.adx.case-deflection",function(e){e.preventDefault();n.getMoreResults()});l.show();l.parent(".panel-footer").stop(true,true).animate({opacity:"show",margin:"show",padding:"show",height:"show"},"normal","linear")}l.prop("disabled",false);l.find(".fa-spinner").remove();r.find(".deflect").off("click.adx.case-deflection").on("click.adx.case-deflection",function(e){e.preventDefault();if(window.parent){window.parent.location.replace("/")}else{window.location.replace("/")}})}).always(function(){e.stop(true,true).animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"fast","linear")})}})(jQuery,Handlebars);(function(d){d(document).ready(function(){var e=d("#customerid");if(e.length>0&&d("#entitlementid").length>0&&d("#customerid_name").attr("disabled")!="disabled"&&d("#entitlementid").closest("td").is(":visible")){e.change(t);e.change()}});function t(){var e=[];var t=d("#entitlementid_lookupmodal").find(".entity-grid");var a=d("#customerid").val();var n=d("#customerid_entityname").val();var i=t?t.data("view-layouts")[0]:null;var r=d("#entitlementid_lookupmodal").find(".entity-lookup").attr("default-entitlements-url");if(!i||!a||!n)return;e=[{Key:"customerid",Value:a},{Key:"customertype",Value:n}];var o={};o.layout=i.Base64SecureConfiguration;o.sortExpression=i.SortExpression;o.customParameters=e;var l=JSON.stringify(o);shell.ajaxSafePost({type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:r,data:l,global:false,success:function(e){if(e){d("#entitlementid").val(e.id);d("#entitlementid_entityname").val(e.entityname);d("#entitlementid_name").val(e.name)}}})}})(jQuery);(function(s,o){var n={spacebar:32,enter:13,up:38,down:40,isFiredSpaceOrEnterEvent:function(e){return e.keyCode===n.spacebar||e.charCode===n.spacebar||e.keyCode===n.enter},isFiredSpaceEvent:function(e){return e.keyCode===n.spacebar||e.charCode===n.spacebar}};var a=[{entityLogicalNames:["adx_communityforum","adx_communityforumthread","adx_communityforumpost"],cssClass:"label label-default",label:ResourceManager.Forums_Label},{entityLogicalNames:["adx_blog","adx_blogpost","adx_blogpostcomment"],cssClass:"label label-info",label:ResourceManager.Blogs_Label},{entityLogicalNames:["adx_event","adx_eventschedule"],cssClass:"label label-info",label:ResourceManager.Events_Label},{entityLogicalNames:["adx_idea","adx_ideaforum"],cssClass:"label label-success",label:ResourceManager.Ideas_Label},{entityLogicalNames:["adx_issue"],cssClass:"label label-danger",label:ResourceManager.Issues_Label},{entityLogicalNames:["incident"],cssClass:"label label-warning",label:ResourceManager.Cases_Label},{entityLogicalNames:["kbarticle"],cssClass:"label label-info",label:ResourceManager.Knowledge_Base_Label},{entityLogicalNames:["knowledgearticle"],cssClass:"label label-primary",label:ResourceManager.Knowledge_Base_Label}];o.registerHelper("ifvalue",function(e,t){if(t.hash.value===e){return t.fn(this)}else{return t.inverse(this)}});o.registerHelper("stringFormat",function(e){var t=_.rest(_.initial(arguments)).reduce(function(e,t,a){return e.replace("{"+a+"}",t)},e);return t});function t(e){var t=window.location.href;e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),n=a.exec(t);if(!n)return null;if(!n[2])return"";var i=decodeURIComponent(n[2].replace(/\+/g," "));var r=o.Utils.escapeExpression(i);return r}function i(e,t){e.click(function(e){e.preventDefault();e.stopPropagation();t(this)});e.keypress(function(e){if(n.isFiredSpaceOrEnterEvent(e)){e.preventDefault();e.stopPropagation();t(this)}})}function l(e,t,a,n){var i=this;i.$templateItem=s(e);i.$insertItem=s(t);i.searchControlData=a;i.initialState=n}l.prototype.render=function(){var e=this;var t=o.compile(e.$templateItem.html());e.$insertItem.html(t(e.searchControlData));if(e.applyInitialState!=null&&e.initialState!=null){e.applyInitialState()}if(e.addOnClickCallback!=null){e.addOnClickCallback()}};function d(e){if(!e){return}e.forEach(function(e){var t=_(e.facetData).where({active:true});var a=!!t&&t.length>0;var n=e.facetName==="modifiedon.date"&&!!e.facetData[0];var i=e.facetName=="_logicalname"&&!!e.facetData[0];if(n||i){var r=!t||t.length===0;var o=!!t&&t.length>1;var l=!!e.facetData[0].active&&!o;e.facetData[0].active=r||l;e.facetData[0].first=true}else{e.noActive=!a}})}function c(e){if(!e){return}var a=[{skipStars:true},{filledStars:[1,2,3,4],emptyStars:[5],ratingLabel:ResourceManager.Facet_Rating_Four_And_Up},{filledStars:[1,2,3],emptyStars:[4,5],ratingLabel:ResourceManager.Facet_Rating_Three_And_Up},{filledStars:[1,2],emptyStars:[3,4,5],ratingLabel:ResourceManager.Facet_Rating_Two_And_Up},{filledStars:[1],emptyStars:[2,3,4,5],ratingLabel:ResourceManager.Facet_Rating_One_And_Up}];var n=_(e).findWhere({facetName:"rating"});if(!n){return}n.facetData=[{},n.facetData[3],n.facetData[2],n.facetData[1],n.facetData[0]];a.forEach(function(e,t){n.facetData[t]=_.assign(n.facetData[t],a[t])})}function f(e,t,a,n){var i=this;l.call(i,e,t,a,n);i.calculateSelectedData();var r=a.facetViews;c(r);d(r)}f.prototype=Object.create(l.prototype);f.prototype.calculateSelectedData=function(){var t=this;if(t.searchControlData==null||t.searchControlData.facetViews==null||t.initialState==null){return}t.initialState.forEach(function(e){e.Constraints.forEach(function(a){var n=e.FacetName;t.searchControlData.facetViews.forEach(function(t){t.facetData.forEach(function(e){if(e.name==a&&t.facetName==n){e.active=true}})})})})};f.prototype.processFacetConstraintClick=function(e,t){var a=s(e);var n=a.parents(".facet-view");var i=n.hasClass("facet-view-multiple-select");var r=a.data("control-value")==="";if(!i||r){n.find(".active").removeClass("active")}a.toggleClass("active");var o=a.attr("data-control-value");var l=a.attr("data-facet");var d="[data-control-value='"+o+"'][data-facet='"+l+"']";t.callback({facetConstraints:t.getSelected()},d)};f.prototype.addOnClickCallback=function(){var t=this;i(t.$insertItem.find(".control-item"),function(e){t.processFacetConstraintClick(e,t)});t.$insertItem.find(".control-item").keydown(function(e){var t=s(this);var a;if(e.keyCode===n.up){a=t.prev()}if(e.keyCode===n.down){a=t.next()}if(a!=null&&a.hasClass("control-item")){a.focus();return false}});i(t.$insertItem.find(".show-more"),function(e){s(e).parents(".facet-view").removeClass("short-list")});i(t.$insertItem.find(".show-less"),function(e){s(e).parents(".facet-view").addClass("short-list")});if(t.$insertItem.find(".control-item:hidden").length===0){t.$insertItem.find(".show-more").hide()}i(t.$insertItem.find(".facet-view-multiple-select .show-more"),f.prototype.showLocalizedProductLabels);f.prototype.showLocalizedProductLabels(t.$insertItem.find(".facet-view-multiple-select .show-more"))};f.prototype.showLocalizedProductLabels=function(e){var t=[];var a=s(e).parents(".facet-view");var n=a.find(" .control-item[data-control-display-name='']:visible");n.each(function(){var e=s(this).data("control-value");t.push(e);s(this).addClass("hidden")});if(t.length===0){return}a.find(".btn").each(function(){s(this).attr("disabled","true")});shell.ajaxSafePost({url:s("body").data("case-deflection-url")+"/GetLocalizedLabels",type:"POST",dataType:"json",data:{localizedLabelEntityName:"product",localizedLabelField:"name",entityGuids:t}}).done(function(i){n.each(function(){var e=s(this);var t=s(this).data("control-value");var a=i[t];if(a!=null){e.attr("aria-label",a+e.attr("aria-label"));e.attr("data-control-display-name",a);var n=e.find("label");n.html(n.html()+a);e.removeClass("hidden")}})}).always(function(){a.find(".btn").each(function(){s(this).removeAttr("disabled")})})};f.prototype.getSelected=function(){var e=this;var i=[];e.$insertItem.find(".control-item.active").each(function(e,t){var a=s(t).attr("data-control-value");var n=s(t).attr("data-facet");if(a!=null&&a!=""&&n!==""&&a!=="[* TO *]"){i.push({FacetName:n,Constraints:[a]})}});return i};var r=function(e,t){var a=5;var n=Math.max(1,a-1);var i=t-Math.floor(n/2);var r=t+Math.ceil(n/2);var o=Math.max(i,1);var l=Math.min(r,e);var d=o-i;var s=r-l;var c=Math.max(o-s,1);var f=Math.min(l+d,e);var u=_.range(c,f+1);return u};function u(e,t,a,n){var i=this;l.call(i,e,t,a,n);i.data=a;i.data.needsPagination=i.data.pageCount>1;i.data.previousPage=i.data.pageNumber-1;i.data.nextPage=i.data.pageNumber+1;i.data.pageLinks=r(i.data.pageCount,i.data.pageNumber)}u.prototype=Object.create(l.prototype);u.prototype.addOnClickCallback=function(){var t=this;var e=_.union(t.data.pageLinks,[1,t.data.pageCount]);e.forEach(function(e){i(t.$insertItem.find(".js-go-to-"+e),function(){t.callback({pageNumber:e})})})};u.prototype.getSelected=function(){var e=this;return e._state||e.data.pageNumber};function p(e,t,a,n){var i=this;l.call(i,e,t,a,n)}p.prototype=Object.create(l.prototype);p.prototype.addOnClickCallback=function(){var e=this;if(e.callback!=null){e.$insertItem.find("select").change(function(){e.callback({sortOptions:e.getSelected()})});e.$insertItem.find("select").keydown(function(e){if(n.isFiredSpaceEvent(e)){s(this).focus();s(this).find("option").trigger("click")}})}};p.prototype.getSelected=function(){var e=this;return e.$insertItem.find(":selected").val()};p.prototype.applyInitialState=function(){var e=this;e.$insertItem.find("select").val(e.initialState)};function v(e,t,a,n){var i=this;a.isResetVisible=n!=null&&n.length>0;l.call(i,e,t,a,n)}v.prototype=Object.create(l.prototype);v.prototype.addOnClickCallback=function(){var e=this;i(e.$insertItem.find(".facet-clear-all"),function(){e.callback({facetConstraints:null})})};function e(){var e=this;e._element=s(".handlebars-search-container");e._searchComponents=[];e._state={pageNumber:1,url:s("body").data("case-deflection-url"),query:e._element.data("query"),facetsOrder:e._element.data("facets-order"),logicalNames:t("logicalNames"),filter:t("filter"),searchTerm:t("q")}}var m=function(t,e){var a=e.map(function(e){return _(t.facetViews).findWhere({facetName:e})}).filter(function(e){return e});t.facetViews=a};e.prototype.init=function(){this.updateState()};e.prototype.initSearchComponents=function(){var e=o.compile(s("#facets-view-body-container").html());s(".search-body-container").html(e(this.searchData));var t=_(s(".js-facet-order-definition").children()).map(function(e){return s(e).text()});if(!_.isEmpty(t)){m(this.searchData,t)}var a=new f("#facets-view-results",".facets",this.searchData,this._state.facetConstraints);a.callback=this.setState.bind(this);this._searchComponents.push(a);var n=new p("#search-order-select",".search-order",this.searchData,this._state.sortOptions);n.callback=this.setState.bind(this);this._searchComponents.push(n);var i=new u("#facets-view-pagination",".search-pagination",this.searchData);i.callback=this.setState.bind(this);this._searchComponents.push(i);var r=new v("#search-view-results",".search-results",this.searchData,this._state.facetConstraints);r.callback=this.setState.bind(this);this._searchComponents.push(r)};e.prototype.breadCrumbs=function(e){s("ul.breadcrumb > li.active").removeClass("active");s("#searchterm").remove();var t=e||"";var a=s("<li id='searchterm' >").html("<span class='searchterm'>"+t+"</span>").addClass("active");s("ul.breadcrumb li:last").after(a)};e.prototype.render=function(){this._searchComponents.forEach(function(e){e.render()})};e.prototype.mapResponseData=function(e){var t=this;e.firstResultNumber=(e.pageNumber-1)*e.pageSize+1;e.lastResultNumber=Math.min(e.pageNumber*e.pageSize,e.itemCount);e.items.forEach(function(t){t.tags=a.filter(function(e){return _.contains(e.entityLogicalNames,t.entityLogicalName)})});e.query=t._state.searchTerm;return e};e.prototype.setState=function(e,t){var a=this;var n=!!e.facetConstraints;if(n){e.pageNumber=1}a._state=_.assign(a._state,e);a.updateState(t)};e.prototype.updateState=function(t){var a=this;a._element.find(".js-search-body").hide();a._element.find(".loader").show();var e={};e.query=a._state.query;e.parameters={Query:a._state.searchTerm};e.logicalNames=a._state.logicalNames;e.facetConstraints=a._state.facetConstraints;e.sortingOption=a._state.sortOptions;e.pageNumber=a._state.pageNumber;e.filter=a._state.filter;var n=JSON.stringify(e);shell.ajaxSafePost({type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:a._state.url,data:n,global:false}).done(function(e){a.breadCrumbs(a._state.searchTerm);a.searchData=a.mapResponseData(e);a.initSearchComponents();a.render();a._element.find(".js-search-body").show();if(t!=null){if(s(t).find("input").length>0){s(t).find("input").focus()}else{s(t).focus()}}}).always(function(e,t){a._element.find(".loader").hide()})};window.FacetedSearch=e})(jQuery,Handlebars);$(document).ready(function(){function t(e,t){t.stopPropagation();t.preventDefault();var a=$("#"+e.id).attr("data-parent");var n=a==="#RelatedArticles"?$(a).find("a.list-group-item"):$(a).find("li.list-group-item");n.show();$("#"+e.id).hide();var i="#"+e.nextElementSibling.id;$(i).show();$(i).css("display","block");$(i).focus()}function a(e,t){t.stopPropagation();t.preventDefault();var a=$("#"+e.id).attr("data-parent");var n=a==="#RelatedArticles"?$(a).find("a.list-group-item"):$(a).find("li.list-group-item");var i=n.filter(function(e){return e>4});i.hide();$("#"+e.id).hide();var r="#"+e.previousElementSibling.id;$(r).show();$(r).focus()}$("#showMoreNotesButton").click(function(e){t(this,e)});$("#showLessNotesButton").click(function(e){a(this,e)});$("#showMoreArticleButton").click(function(e){t(this,e)});$("#showLessArticleButton").click(function(e){a(this,e)})});$(document).ready(function(){if($("[data-badge]")){var a={},e,n;$("[data-badge]").each(function(e,t){n=$(t).attr("data-uri");if(!a[n]){a[n]=Array()}a[n].push($(t))});$.each(a,function(e,t){if(t[0].attr("data-uri")){$.ajax({type:"GET",url:t[0].attr("data-uri"),contentType:"application/json; charset=utf-8",dataType:"html"}).done(function(a){$.each(t,function(e,t){$(t).html(a);$(t).find('[data-toggle="popover"]').popover({html:true,template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content" style="padding-bottom:3px;"></div></div>'})})})}})}});(function(k){function e(e){this._element=k(e);this._target=this._element.data("target")||{};this._serviceUrlGet=this._element.attr("data-url-get");this._serviceUrlAddFiles=this._element.attr("data-url-add-files");this._serviceUrlAddFolder=this._element.attr("data-url-add-folder");this._serviceUrlDelete=this._element.attr("data-url-delete");this._addEnabled=this._element.data("add-enabled");this._deleteEnabled=this._element.data("delete-enabled");this._pageSize=this._element.attr("data-pagesize");this._addSuccess=false;this._deleteSuccess=false;var n=this;k(e).on("refresh",function(e,t,a){n.load(a,t)})}k(document).ready(function(){k(".sharepoint-grid").each(function(){new e(k(this)).render()})});e.prototype.render=function(){var e=this;var a=e._element;var t=a.children(".grid-actions").find("a.add-file");var n=a.children(".modal-add-file");var i=n.find(".modal-footer .btn-primary");var r=a.children(".grid-actions").find("a.add-folder");var o=a.children(".modal-add-folder");var l=o.find(".modal-footer .btn-primary");var d=a.children(".modal-delete-file");var s=a.children(".modal-delete-folder");e.load();d.on("shown.bs.modal",function(){k('[class="modal fade modal-delete modal-delete-file in"]').find('[class="primary btn btn-primary"]').focus()});s.on("shown.bs.modal",function(){k('[class="modal fade modal-delete modal-delete-folder in"]').find('[class="primary btn btn-primary"]').focus()});if(e._addEnabled){t.on("click",function(){var e=n.find(".destination-group");var t=a.attr("data-folderpath");if(!t){e.hide()}else{e.find("p.destination-folder").html(t+"/");e.show()}n.modal("show");n.attr("aria-hidden","false")});i.on("click",function(){e.addFile()});n.on("shown.bs.modal",function(){k("input",this).first().focus()});n.on("hidden.bs.modal",function(){n.find("input[type='file']").val("");n.find(".alert-danger.error").remove();n.attr("aria-hidden","true")});r.on("click",function(){var e=o.find(".destination-group");var t=a.attr("data-folderpath");if(!t){e.hide()}else{e.find("p.destination-folder").html(t+"/");e.show()}o.modal("show");o.attr("aria-hidden","false");l.prop("disabled",true)});var c=o.find("#FolderName");c.on("keyup",function(){l.prop("disabled",false);if(c.val()==""){l.prop("disabled",true)}});l.on("click",function(){e.addFolder()});o.on("shown.bs.modal",function(){k(this).find("input:visible:first").focus()});o.on("hidden.bs.modal",function(){o.find("#FolderName").val("");o.find(".alert-danger.error").remove();o.attr("aria-hidden","true")})}};e.prototype.load=function(e,o){var l=this;var d=l._element;var s=d.children(".sharepoint-data");var n=d.children(".sharepoint-error");var c=d.children(".sharepoint-empty");var f=d.children(".sharepoint-access-denied");var u=d.children(".sharepoint-config-error");var t=d.children(".sharepoint-loading");var a=d.find(".sharepoint-breadcrumbs");var i=d.find(".sharepoint-pagination");var r=l._serviceUrlGet;var p=l._target;var v=l._pageSize;n.hide();c.hide();f.hide();u.hide();s.children(".view-grid").find("tbody").remove();a.hide().empty();i.hide();t.show();var m=d.attr("data-sort-expression")||"FileLeafRef ASC";var h=i.data("current-page");if(h==null||h==""){h=1}e=e||h;var g=i.data("pagesize");if(g==null||g==""){g=v}var y=d.attr("data-folderpath")||"";var b=y.replace(/[\t\n\f \/>"'<=]/g,"");var C=d.attr("data-paging-info"+e+b);l.getData(r,p,m,e,g,C,y,function(e){if(typeof e===typeof undefined||e===false||e==null){c.fadeIn();return}if(typeof e.AccessDenied!==typeof undefined&&e.AccessDenied!==false&&e.AccessDenied){f.fadeIn();return}if(typeof e.ConfigError!==typeof undefined&&e.ConfigError!==false&&e.ConfigError){u.fadeIn();return}if(e.TotalCount==0){--h;if(h>=1){l.load(h);d.attr("data-page-count"+b,h)}else{c.fadeIn()}return}var t=k("#sharepoint-template").html();var a=Handlebars.compile(t);s.html(a(e));s.find("abbr.timeago").each(function(){var e=k(this).attr("title");var t=window.moment;if(t){var a=dateFormatConverter.convert(d.closest("[data-dateformat]").data("dateformat")||"M/d/yyyy",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var n=dateFormatConverter.convert(d.closest("[data-timeformat]").data("timeformat")||"h:mm tt",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var i=a+" "+n;k(this).text(t(e).format(i))}});s.find("abbr.timeago").timeago();l.initializeBreadcrumbs(y);s.fadeIn();l.addFolderClickEventHandlers();if(l._deleteEnabled&&l._deleteEnabled!="False"){l.addDeleteClickEventHandlers()}var n=m.split(" ");var i=n[0];var r=n[1];d.find(".view-grid").find("table").find("th.sort-enabled a").each(function(){var e=k(this).closest("th");e.attr("aria-label",e.find("a").html());if(e.data("sort-name")==i){if(r=="ASC"){e.data("sort-dir","ASC").addClass("sort").removeClass("sort-desc").addClass("sort-asc");e.attr("aria-sort","ascending");k(this).append(" ").append(k("<span></span>").addClass("fa").addClass("fa-arrow-up").attr("aria-hidden","true")).append("<span class='sr-only sort-hint'>. "+window.ResourceManager["Sort_Ascending_Order"]+"</span>")}else{e.data("sort-dir","DESC").addClass("sort").removeClass("sort-asc").addClass("sort-desc");e.attr("aria-sort","descending");k(this).append(" ").append(k("<span></span>").addClass("fa").addClass("fa-arrow-down").attr("aria-hidden","true")).append("<span class='sr-only sort-hint'>. "+window.ResourceManager["Sort_Descending_Order"]+"</span>")}e.addClass("sort")}});l.addSortEventHandlers(o);l.initializePagination(e,b,o);if(o!=null&&k.isNumeric(o)){if(o!=-1)d.find(".view-grid").find("table").find("tr.sp-item td").filter('[data-type="System.String"]').find("a")[o].focus();else d.find(".view-grid").find("table")[0].focus()}},function(e,t,a){if(a){n.find(".alert.alert-block.alert-danger").html(a)}n.show()},function(){t.hide()})};e.prototype.getData=function(e,t,a,n,i,r,o,l,d,s){l=k.isFunction(l)?l:function(){};d=k.isFunction(d)?d:function(){};s=k.isFunction(s)?s:function(){};if(!e||e==""){s.call(this);d.call(this,null,"error","A required service url was not provided.");return}if(!t){s.call(this);d.call(this,null,"error","A required regarding EntityReference parameter was not provided.");return}i=i||-1;var c={};c.regarding=t;c.sortExpression=a;c.page=n;c.pageSize=i;c.pagingInfo=r;c.folderPath=o;var f=JSON.stringify(c);shell.ajaxSafePost({type:"POST",dataType:"json",contentType:"application/json",url:e,data:f,global:false}).done(l).fail(d).always(s)};e.prototype.initializeBreadcrumbs=function(e){if(!e)return;var n=this;var i=n._element;var r=i.find(".sharepoint-breadcrumbs");var o="";var l=e.split("/");k.each(l,function(e,t){if(e==l.length-1){r.append("<li class='active'>"+t+"</li>")}else if(!t){var a=window.ResourceManager["All"];r.append("<li><a href= '#' data-folderpath='' \" title= \""+a+'">'+a+"</a></li>")}else{o=o+"/"+t;r.append("<li><a href='#' data-folderpath=\""+o+'">'+t+"</a></li>")}r.find("a").on("click",function(e){e.stopImmediatePropagation();e.preventDefault();var t=1;if(k(this).attr("data-folderpath")=="")t=0;i.attr("data-folderpath",k(this).attr("data-folderpath"));n.load(1,t)})});r.fadeIn()};e.prototype.addFolderClickEventHandlers=function(){var t=this;var a=t._element;a.find(".folder-link").on("click",function(e){e.stopImmediatePropagation();e.preventDefault();a.attr("data-folderpath",k(this).attr("data-folderpath"));t.load(1)})};e.prototype.addFile=function(){var e=this;var t=e._element;var a=e._target;var n=e._serviceUrlAddFiles;var i=t.find(".modal-add-file");var r=i.find(".modal-footer button.primary");var o=false;b(i);if(n==null||n==""){var l={Message:"System Error",InnerError:{Message:"The URL to the service for this Add File Request could not be determined."}};y(l,i);return}var d=i.find("input[type='file']");var s=0;var c=this._element.attr("data-maxFileUploadSize");var f=c*1024*1024;for(var u=0;u<d[0].files.length;u++){var p=d[0].files[u].size;if(p>f){var l={Message:"System Error",InnerError:{Message:String.format(window.ResourceManager["Sharepoint_File_Size_Not_Supported"],c)}};y(l,i);return}s+=p}var v=this._element.attr("data-maxTotalUploadSize");if(s>v*1024*1024){var l={Message:"System Error",InnerError:{Message:String.format(window.ResourceManager["Sharepoint_Total_File_Size_Not_Supported"],v)}};y(l,i);return}var m=i.find("input[type='checkbox']");if(m.length>0){o=m.prop("checked")}r.html(window.ResourceManager["Adding_Files"]);if(window.FormData!==undefined){var h=new FormData;h.append("regardingEntityLogicalName",a.LogicalName);h.append("regardingEntityId",a.Id);if(d.length>0){if(typeof d[0].files!==typeof undefined&&d[0].files.length>0){var g=d[0].files;for(var u=0;u<g.length;u++){h.append("files",g[u])}}}h.append("overwrite",o);if(t.attr("data-folderpath")){h.append("folderPath",t.attr("data-folderpath"))}r.attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-pulse' aria-hidden='true'></span> ");d.attr("disabled","disabled");shell.ajaxSafePost({url:n,type:"POST",data:h,mimeType:"multipart/form-data",contentType:false,cache:false,processData:false}).done(function(){e._addSuccess=true;t.trigger("refresh");i.modal("hide")}).fail(function(e){var t=e.getResponseHeader("content-type")||"";var a=t.indexOf("json")>-1?k.parseJSON(e.responseText):{Message:e.status,InnerError:{Message:e.statusText}};y(a,i)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-pulse").remove();d.removeAttr("disabled","disabled");r.html(window.ResourceManager["Add_Files"])})}else{y({Message:"Your browser does not support FormData."},i)}};e.prototype.addFolder=function(){var e=this;var t=e._element;var a=e._target;var n=e._serviceUrlAddFolder;var i=t.find(".modal-add-folder");var r=i.find(".modal-footer button.primary");if(n==null||n==""){var o={Message:"System Error",InnerError:{Message:"The URL to the service for this Add Folder Request could not be determined."}};y(o,i);return}r.attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-pulse' aria-hidden='true'></span> ");var l=i.find("#FolderName").val();var d=t.attr("data-folderpath")||"";var s={};s.regarding=a;s.name=l;s.folderPath=d;var c=JSON.stringify(s);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:n,data:c}).done(function(){e._addSuccess=true;t.attr("data-folderpath",d+"/"+l);i.modal("hide");e.load(1)}).fail(function(e){var t=e.getResponseHeader("content-type")||"";var a=t.indexOf("json")>-1?k.parseJSON(e.responseText):{Message:e.status,InnerError:{Message:e.statusText}};y(a,i)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-pulse").remove()})};e.prototype.addDeleteClickEventHandlers=function(){var s=this;var c=s._element;var f=s._target;var u=s._serviceUrlDelete;var p=c.children(".modal-delete-file");if(p.length==0){return}p.on("hidden.bs.modal",function(){p.find(".sp-item-name").remove();p.find(".alert-danger.error").remove();v.attr("aria-hidden","true")});var v=c.children(".modal-delete-folder");if(v.length==0){return}v.on("hidden.bs.modal",function(){v.find(".sp-item-name").remove();v.find(".alert-danger.error").remove();v.attr("aria-hidden","true")});c.find(".delete-link").on("click",function(e){e.stopImmediatePropagation();e.preventDefault();var t=k(this).closest(".sp-item");var n=t.data("id");if(!n||n==""){console.log("Failed to launch delete dialog. Data parameter 'id' is null.");return}var i=t.data("foldername")?v:p;var a=i.find(".modal-body");a.append(k("<p class='sp-item-name'>").html(t.find("a").html()));var r=i.find(".modal-footer button.primary");var o=c.find(".view-grid").find("table").find("tr.sp-item").index(t);var l=i.find("button[class='cancel btn btn-default']");var d=i.find("button[class='form-close']");l.unbind("click");l.on("click",function(){i.modal("hide");c.find(".view-grid").find("table").find("tr.sp-item a.btn-xs")[o].focus()});d.unbind("click");d.on("click",function(){i.modal("hide");c.find(".view-grid").find("table").find("tr.sp-item a.btn-xs")[o].focus()});r.unbind("click");r.on("click",function(){k(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-pulse' aria-hidden='true'></span>");var e=c.find(".view-grid").find("table").find("tr.sp-item").length;if(e==1||o==e-1)o=-1;var t={};t.regarding=f;t.id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:u,data:a}).done(function(){s._deleteSuccess=true;c.trigger("refresh",[o]);i.modal("hide")}).fail(function(e){var t=e.getResponseHeader("content-type")||"";var a=t.indexOf("json")>-1?k.parseJSON(e.responseText):{Message:e.status,InnerError:{Message:e.statusText}};y(a,p)}).always(function(){r.removeAttr("disabled","disabled").find(".fa-pulse").remove()})});i.modal("show");i.attr("aria-hidden","false")})};e.prototype.addSortEventHandlers=function(e){var r=this;var o=r._element;o.find(".view-grid").find("table").find("th.sort-enabled a").on("click",function(e){e.stopImmediatePropagation();e.preventDefault();var t=k(this).closest("th");var a=t.data("sort-name");var n=t.data("sort-dir");if(typeof a===typeof undefined||a===false||a===null||a===""){return}if(typeof n===typeof undefined||n===false){n=""}var i;if(n=="ASC"){i=a+" DESC"}else{i=a+" ASC"}o.attr("data-sort-expression",i);r.load(1,e.currentTarget)});if(e!=null&&!k.isNumeric(e)){var t=k.trim(k("span:first",k(e)).text());o.find(".view-grid").find("table").find("th.sort-enabled a").filter(function(){var e=k.trim(k("span:first",k(this)).text());return e==t}).trigger("focus")}};e.prototype.initializePagination=function(e,t,a){if(typeof e===typeof undefined||e===false||e==null){return}if(typeof e.PageSize===typeof undefined||e.PageSize===false||e.PageSize==null||(typeof e.PageNumber===typeof undefined||e.PageNumber===false||e.PageNumber==null)||(typeof e.TotalCount===typeof undefined||e.TotalCount===false||e.TotalCount==null)){return}var n=this;var i=n._element;var r=i.find(".sharepoint-pagination");var o=parseInt(i.attr("data-page-count"+t))||1;if(e.PagingInfo){i.attr("data-paging-info"+(e.PageNumber+1)+t,e.PagingInfo);if(o<e.PageNumber+1){o=e.PageNumber+1;i.attr("data-page-count"+t,o)}}if(o<=1){r.hide();return}r.data("pagesize",e.PageSize).data("pages",o).data("current-page",e.PageNumber).data("count",e.TotalCount).unbind("click").pagination({total_pages:r.data("pages"),current_page:r.data("current-page"),callback:function(e,t){e.stopImmediatePropagation();e.preventDefault();var a=k(e.target).closest("li");if(a.not(".disabled").length>0&&a.not(".active").length>0){n.load(t,e.currentTarget)}}}).show();r.find("li").first().find("a").attr("aria-label",window.ResourceManager["Pagination_Previous_Page"]);r.find("li").last().find("a").attr("aria-label",window.ResourceManager["Pagination_Next_Page"]);r.find("li.active").find("a").attr("aria-label",window.ResourceManager["Pagination_Current_Page"].replace("{0}",e.PageNumber));r.find("li.disabled").find("a").removeAttr("href");if(a!=null&&!k.isNumeric(a)){r.find("a").filter(function(){return k(this).text()==k(a).text()}).trigger("focus")}};function y(e,t){if(typeof e!==typeof undefined&&e!==false&&e!=null){console.log(e);var a=t.find(".modal-body");var n=t.find(".alert-danger.error");if(n.length==0){n=k("<div></div>").addClass("alert alert-block alert-danger error clearfix")}else{n.empty()}if(typeof e.InnerError!==typeof undefined&&typeof e.InnerError.Message!==typeof undefined&&e.InnerError.Message!==false&&e.InnerError.Message!=null){if(typeof e.InnerError.Message==="number"){n.append("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+e.InnerError.Message+" Error</p>")}else{n.append("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+e.InnerError.Message+"</p>")}}else if(typeof e.Message!==typeof undefined&&e.Message!==false&&e.Message!=null){if(typeof e.Message==="number"){n.append("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+e.Message+" Error</p>")}else{n.append("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+e.Message+"</p>")}}a.prepend(n)}}function b(e){e.find(".alert-danger.error").hide()}})(jQuery);
/*RateIt | v1.0.24 / 06/14/2016 https://github.com/gjunge/rateit.js
Copyright (c) 2016 Gideon Junge

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

*/
/*RateIt | v1.0.24 / 06/14/2016 https://github.com/gjunge/rateit.js
Copyright (c) 2016 Gideon Junge

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

*/(function(_){function w(e){var t=e.originalEvent.changedTouches,a=t[0],n="",i;switch(e.type){case"touchmove":n="mousemove";break;case"touchend":n="mouseup";break;default:return}i=document.createEvent("MouseEvent");i.initMouseEvent(n,!0,!0,window,1,a.screenX,a.screenY,a.clientX,a.clientY,!1,!1,!1,!1,0,null);a.target.dispatchEvent(i);e.preventDefault()}_.rateit={aria:{resetLabel:"reset rating",ratingLabel:"rating"}};_.fn.rateit=function(h,g){var y=1,b={},C="init",k=function(e){return e.charAt(0).toUpperCase()+e.substr(1)},e;if(this.length===0)return this;if(e=_.type(h),e=="object"||h===undefined||h===null)b=_.extend({},_.fn.rateit.defaults,h);else{if(e=="string"&&h!=="reset"&&g===undefined)return this.data("rateit"+k(h));e=="string"&&(C="setvalue")}return this.each(function(){var i=_(this),r=function(e,t){if(t!=null){var a="aria-value"+(e=="value"?"now":e),n=i.find(".rateit-range");n.attr(a)!=undefined&&n.attr(a,t)}return arguments[0]="rateit"+k(e),i.data.apply(i,arguments)},e,t,o,a,n,l,d,s,c,f,u;if(h=="reset"){e=r("init");for(t in e)i.data(t,e[t]);r("backingfld")&&(a=_(r("backingfld")),a.val(r("value")),a.trigger("change"),a[0].min&&(a[0].min=r("min")),a[0].max&&(a[0].max=r("max")),a[0].step&&(a[0].step=r("step")));i.trigger("reset")}if(i.hasClass("rateit")||i.addClass("rateit"),o=i.css("direction")!="rtl",C=="setvalue"){if(!r("init"))throw"Can't set value before init";h!="readonly"||g!=!0||r("readonly")||(i.find(".rateit-range").unbind(),r("wired",!1));h=="value"&&(g=g==null?r("min"):Math.max(r("min"),Math.min(r("max"),g)));r("backingfld")&&(a=_(r("backingfld")),h=="value"&&a.val(g),h=="min"&&a[0].min&&(a[0].min=g),h=="max"&&a[0].max&&(a[0].max=g),h=="step"&&a[0].step&&(a[0].step=g));r(h,g)}r("init")||(r("min",isNaN(r("min"))?b.min:r("min")),r("max",isNaN(r("max"))?b.max:r("max")),r("step",r("step")||b.step),r("readonly",r("readonly")!==undefined?r("readonly"):b.readonly),r("resetable",r("resetable")!==undefined?r("resetable"):b.resetable),r("backingfld",r("backingfld")||b.backingfld),r("starwidth",r("starwidth")||b.starwidth),r("starheight",r("starheight")||b.starheight),r("value",Math.max(r("min"),Math.min(r("max"),isNaN(r("value"))?isNaN(b.value)?b.min:b.value:r("value")))),r("ispreset",r("ispreset")!==undefined?r("ispreset"):b.ispreset),r("backingfld")&&(a=_(r("backingfld")).hide(),(a.attr("disabled")||a.attr("readonly"))&&r("readonly",!0),a[0].nodeName=="INPUT"&&(a[0].type=="range"||a[0].type=="text")&&(r("min",parseInt(a.attr("min"))||r("min")),r("max",parseInt(a.attr("max"))||r("max")),r("step",parseInt(a.attr("step"))||r("step"))),a[0].nodeName=="SELECT"&&a[0].options.length>1?(r("min",isNaN(r("min"))?Number(a[0].options[0].value):r("min")),r("max",Number(a[0].options[a[0].length-1].value)),r("step",Number(a[0].options[1].value)-Number(a[0].options[0].value)),n=a.find("option[selected]"),n.length==1&&r("value",n.val())):r("value",a.val())),l=i[0].nodeName=="DIV"?"div":"span",y++,d='<button id="rateit-reset-{{index}}" type="button" data-role="none" class="rateit-reset" aria-label="'+_.rateit.aria.resetLabel+'" aria-controls="rateit-range-{{index}}"></button><{{element}} id="rateit-range-{{index}}" class="rateit-range" tabindex="0" role="slider" aria-label="'+_.rateit.aria.ratingLabel+'" aria-owns="rateit-reset-{{index}}" aria-valuemin="'+r("min")+'" aria-valuemax="'+r("max")+'" aria-valuenow="'+r("value")+'"><{{element}} class="rateit-selected" style="height:'+r("starheight")+'px"></{{element}}><{{element}} class="rateit-hover" style="height:'+r("starheight")+'px"></{{element}}></{{element}}>',i.append(d.replace(/{{index}}/gi,y).replace(/{{element}}/gi,l)),o||(i.find(".rateit-reset").css("float","right"),i.find(".rateit-selected").addClass("rateit-selected-rtl"),i.find(".rateit-hover").addClass("rateit-hover-rtl")),r("init",JSON.parse(JSON.stringify(i.data()))));i.find(".rateit-selected, .rateit-hover").height(r("starheight"));s=i.find(".rateit-range");s.width(r("starwidth")*(r("max")-r("min"))).height(r("starheight"));c="rateit-preset"+(o?"":"-rtl");r("ispreset")?i.find(".rateit-selected").addClass(c):i.find(".rateit-selected").removeClass(c);r("value")!=null&&(f=(r("value")-r("min"))*r("starwidth"),i.find(".rateit-selected").width(f));u=i.find(".rateit-reset");u.data("wired")!==!0&&u.bind("click",function(e){e.preventDefault();u.blur();var t=_.Event("beforereset");if(i.trigger(t),t.isDefaultPrevented())return!1;i.rateit("value",null);i.trigger("reset")}).data("wired",!0);var p=function(e,t){var a=t.changedTouches?t.changedTouches[0].pageX:t.pageX,n=a-_(e).offset().left;return o||(n=s.width()-n),n>s.width()&&(n=s.width()),n<0&&(n=0),f=Math.ceil(n/r("starwidth")*(1/r("step")))},v=function(e){var t=e*r("starwidth")*r("step"),a=s.find(".rateit-hover"),n;a.data("width")!=t&&(s.find(".rateit-selected").hide(),a.width(t).show().data("width",t),n=[e*r("step")+r("min")],i.trigger("hover",n).trigger("over",n))},m=function(e){var t=_.Event("beforerated");return(i.trigger(t,[e]),t.isDefaultPrevented())?!1:(r("value",e),r("backingfld")&&_(r("backingfld")).val(e).trigger("change"),r("ispreset")&&(s.find(".rateit-selected").removeClass(c),r("ispreset",!1)),s.find(".rateit-hover").hide(),s.find(".rateit-selected").width(e*r("starwidth")-r("min")*r("starwidth")).show(),i.trigger("hover",[null]).trigger("over",[null]).trigger("rated",[e]),!0)};r("readonly")?u.hide():(r("resetable")||u.hide(),r("wired")||(s.bind("touchmove touchend",w),s.mousemove(function(e){var t=p(this,e);v(t)}),s.mouseleave(function(){s.find(".rateit-hover").hide().width(0).data("width","");i.trigger("hover",[null]).trigger("over",[null]);s.find(".rateit-selected").show()}),s.mouseup(function(e){var t=p(this,e),a=t*r("step")+r("min");m(a);s.blur()}),s.keyup(function(e){(e.which==38||e.which==(o?39:37))&&m(Math.min(r("value")+r("step"),r("max")));(e.which==40||e.which==(o?37:39))&&m(Math.max(r("value")-r("step"),r("min")))}),r("wired",!0)),r("resetable")&&u.show());s.attr("aria-readonly",r("readonly"))})};_.fn.rateit.defaults={min:0,max:5,step:.5,starwidth:16,starheight:16,readonly:!1,resetable:!0,ispreset:!1};_(function(){_("div.rateit, span.rateit").rateit()})})(jQuery);(function(f){function e(e){this._element=f(e);this._urlSave=this._element.attr("data-url-save");this._logicalName=this._element.attr("data-logicalname");this._id=this._element.attr("data-id");this._min=this._element.attr("data-rateit-min");this._max=this._element.attr("data-rateit-max")}f(document).ready(function(){f(".rateit").each(function(){new e(f(this)).initialize()})});e.prototype.initialize=function(){var t=this;var e=t._element;var a=t._urlSave;var n=t._logicalName;var i=t._id;if(typeof a===typeof undefined||a===null||a===""){return}if(typeof n===typeof undefined||n===null||n===""){return}if(typeof i===typeof undefined||i===null||i===""){return}e.rateit("readonly",false);e.on("rated",function(){var e=f(this).rateit("value");t.saveRating(e)})};e.prototype.saveRating=function(e){var t=this;var n=t._element;var a=t._urlSave;var i=t._logicalName;var r=t._id;var o=t._min;var l=t._max;if(typeof e===typeof undefined||e===null||e===""){n.rateit("reset");return}if(typeof a===typeof undefined||a===null||a===""){n.rateit("reset");return}if(typeof i===typeof undefined||i===null||i===""){n.rateit("reset");return}if(typeof r===typeof undefined||r===null||r===""){n.rateit("reset");return}if(typeof o===typeof undefined||o===null||o===""){o=0}else{o=parseInt(o);if(isNaN(o)){o=0}}if(typeof l===typeof undefined||l===null||l===""){l=5}else{l=parseInt(l);if(isNaN(l)){l=5}}n.rateit("readonly",true);var d={};var s={};s.LogicalName=i;s.Id=r;d.entityReference=s;d.rating=e;d.min=o;d.max=l;var c=JSON.stringify(d);shell.ajaxSafePost({type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:a,data:c,processData:false,global:false}).done(function(e){if(typeof e!==typeof undefined&&e!=null&&e!==""){n.rateit("value",e.AverageRatingRounded);var t=n.closest(".rating").find(".rating-count");t.text(e.RatingCount)}else{n.rateit("reset");return}}).fail(function(e){var t=e.getResponseHeader("content-type")||"";var a=t.indexOf("json")>-1?f.parseJSON(e.responseText):{Message:e.status,InnerError:{Message:e.statusText}};if(typeof console!==typeof undefined&&typeof console.log!==typeof undefined){console.log(a)}n.rateit("reset")}).always(function(){n.rateit("readonly",false)})}})(jQuery);var portal=portal||{};portal.convertAbbrDateTimesToTimeAgo=function(o){o("abbr.timeago").each(function(){var e=o(this),t=Date.parse(e.text()),a;if(t){a=moment(t);var n=dateFormatConverter.convert(e.closest("[data-dateformat]").data("dateformat")||"MMMM d, yyyy",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var i=dateFormatConverter.convert(e.closest("[data-timeformat]").data("timeformat")||"h:mm tt",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var r=dateFormatConverter.convert(e.attr("data-format"),dateFormatConverter.dotNet,dateFormatConverter.momentJs)||n+" "+i;e.attr("title",a.format("YYYY-MM-DDTHH:mm:ss"));e.text(a.format(r))}});o("abbr.timeago").timeago();o("abbr.posttime").each(function(){var e=o(this),t=Date.parse(e.text()),a;if(t){a=moment(t);var n=dateFormatConverter.convert(e.closest("[data-dateformat]").data("dateformat")||"MMMM d, yyyy",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var i=dateFormatConverter.convert(e.closest("[data-timeformat]").data("timeformat")||"h:mm tt",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var r=dateFormatConverter.convert(e.attr("data-format"),dateFormatConverter.dotNet,dateFormatConverter.momentJs)||n+" "+i;e.attr("title",a.format(r));e.text(a.format(r))}})};portal.initializeHtmlEditors=function(){var e=$("[data-app-path]").data("app-path")||"/";$(document).on("focusin",function(e){if($(e.target).closest(".mce-window").length){e.stopImmediatePropagation()}});$(".html-editors textarea").each(function(){var e=240;var t=e+120;var a=this.id+"Control";$("<div id='"+a+"' style='height:"+t+"px'></div>").insertAfter(this);var n=new MscrmControls.CkEditorCustomControl.CKEditorCustomToolbar("Portals",[{name:"clipboard",items:["Cut","Copy","Paste","PasteText","PasteFromWord","Undo","Redo"]},{name:"links",items:["Link","Unlink"]},{name:"editing",items:["Find","Replace","-","SelectAll","-","Scayt"]},{name:"insert",items:["Image","Flash","Table","HorizontalRule","Smiley","SpecialChar","PageBreak","Iframe"]},{name:"forms",items:["Form","Checkbox","Radio","TextField","Textarea","Select","Button","ImageButton","HiddenField"]},{name:"tools",items:["ShowBlocks"]},{name:"document",items:["Source","-","Save","NewPage","Preview","Print","-","Templates"]},"/",{name:"basicstyles",items:["Bold","Italic","Underline","Strike","Subscript","Superscript","-","CopyFormatting","RemoveFormat"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote","CreateDiv","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","-","BidiLtr","BidiRtl","Language"]},"/",{name:"styles",items:["Styles","Format","Font","FontSize"]},{name:"colors",items:["TextColor","BGColor"]},{name:"about",items:["About"]}]);(new MscrmControls.CkEditorCustomControl.CKEditorFactory).create(a,this.id,n,["/css/bootstrap.min.css","/css/ckeditor.css"],this.value,[],function(){if(CKEDITOR.stylesSet.registered.portal==null||CKEDITOR.stylesSet.registered.portal==undefined){CKEDITOR.stylesSet.add("portal",[{name:window.ResourceManager["CKEditor_Code_Style"],element:"code"},{name:window.ResourceManager["CKEditor_Code_Block_Style"],element:"pre",attributes:{class:"linenums prettyprint"}}])}CKEDITOR.config.contentsCss=["/css/bootstrap.min.css","/css/ckeditor.css"];CKEDITOR.config.height=e;CKEDITOR.config.stylesSet="portal";CKEDITOR.config.format_tags="p;h1;h2;h3;h4;h5;h6;pre";CKEDITOR.config.disableNativeSpellChecker=false;CKEDITOR.config.removePlugins=CKEDITOR.config.removePlugins.split(",").filter(function(e){return e!=="contextmenu"}).join();CKEDITOR.config.extraPlugins="contextmenu,";CKEDITOR.config.removeButtons="Save,NewPage,Preview,Print,Templates,SelectAll,Find,Replace,Form,Checkbox,Radio,TextField,Textarea,Select,Button,ImageButton,HiddenField,Anchor,Flash,Smiley,PageBreak,Iframe,ShowBlocks,Font,FontSize,CreateDiv,JustifyLeft,JustifyCenter,JustifyRight,JustifyBlock,BidiRtl,BidiLtr,Language,TextColor,BGColor,About,Subscript,Superscript,Underline"}.bind(this));this.style.display="none";this.style.visibility="hidden"})};(function(s,o){portal.initializeHtmlEditors();s(function(){moment.locale(s("html").attr("lang"));portal.convertAbbrDateTimesToTimeAgo(s);var t=s(".facebook-signin");t.on("click",function(e){e.preventDefault();window.open(t.attr("href"),"facebook_auth","menubar=1,resizable=1,scrollbars=yes,width=800,height=600")});s(".crmEntityFormView input:not([value])[readonly]:not([placeholder]), .crmEntityFormView input[value=''][readonly]:not([placeholder])").filter(function(){var e=s(this).val();return e==null||e.length===0}).each(function(){s(this).parent().css("position","relative");s(this).after(s("<div>&mdash;</div>").addClass("text-muted").css("position","absolute").css("top",4).attr("aria-hidden","true"))});s(".crmEntityFormView select[disabled] option:checked[value='']").closest("select").each(function(){s(this).parent().css("position","relative");s(this).after(s("<div>&mdash;</div>").addClass("text-muted").css("position","absolute").css("top",4).attr("aria-hidden","true"))});s(".crmEntityFormView textarea[readonly]").filter(function(){return s(this).val().length===0}).each(function(){s(this).parent().css("position","relative");s(this).after(s("<div>&mdash;</div>").addClass("text-muted").css("position","absolute").css("top",4).attr("aria-hidden","true"))});s(".btn-select").each(function(){var a=s(this),n=s(a.data("target")),i=s(a.data("focus")),r=s(".btn .selected",a);n.change(function(){var e=s("option:selected",n);a.find(".dropdown-menu li.active a").attr("aria-selected",false);a.find(".dropdown-menu li.active").removeClass("active");r.text(e.text())});s(".dropdown-menu li > a",a).click(function(){var e=s(this),t=e.data("value");s(".dropdown-menu li a",a).attr("aria-selected",false);s(".dropdown-menu li",a).removeClass("active");e.parent("li").addClass("active");e.attr("aria-selected",true);n.val(t);r.text(e.text());i.focus()})});s("abbr.timestamp").each(function(){var e=s(this),t=Date.parse(e.text()),a;if(t){a=moment(t);var n=dateFormatConverter.convert(element.closest("[data-dateformat]").data("dateformat")||"MMMM d, yyyy",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var i=dateFormatConverter.convert(element.closest("[data-timeformat]").data("timeformat")||"h:mm tt",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var r=dateFormatConverter.convert(element.attr("data-format"),dateFormatConverter.dotNet,dateFormatConverter.momentJs)||n+" "+i;e.text(a.format(r));e.attr("title",a.format(r))}});s("time").each(function(){var e=s(this),t=moment(e.attr("datetime"));if(t){var a=dateFormatConverter.convert(e.closest("[data-dateformat]").data("dateformat")||"MMMM d, yyyy",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var n=dateFormatConverter.convert(e.closest("[data-timeformat]").data("timeformat")||"h:mm tt",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var i=a+" "+n;e.text(t.format(e.hasClass("date-only")?a:i))}});s(".vevent").each(function(){var e=s(".dtstart",this),t=s(".dtend",this),a=Date.parse(e.text()),n=Date.parse(t.text()),i,r,o,l,d;if(a){l=moment(a);i=dateFormatConverter.convert(e.closest("[data-dateformat]").data("dateformat")||"MMMM d, yyyy",dateFormatConverter.dotNet,dateFormatConverter.momentJs);r=dateFormatConverter.convert(e.closest("[data-timeformat]").data("timeformat")||"h:mm tt",dateFormatConverter.dotNet,dateFormatConverter.momentJs);o=dateFormatConverter.convert(e.attr("data-format"),dateFormatConverter.dotNet,dateFormatConverter.momentJs)||i+" "+r;e.text(l.format(o));e.attr("title",l.format(o))}if(n){d=moment(n);i=dateFormatConverter.convert(t.closest("[data-dateformat]").data("dateformat")||"MMMM d, yyyy",dateFormatConverter.dotNet,dateFormatConverter.momentJs);r=dateFormatConverter.convert(t.closest("[data-timeformat]").data("timeformat")||"h:mm tt",dateFormatConverter.dotNet,dateFormatConverter.momentJs);o=dateFormatConverter.convert(t.attr("data-format"),dateFormatConverter.dotNet,dateFormatConverter.momentJs)||i+" "+r;t.text(d.format(a&&d.isSame(moment(a),"day")?r:o));t.attr("title",d.format(o))}});s(".carousel").carousel();if(s.ui&&s.ui.tooltip){s.widget.bridge("uitooltip",s.ui.tooltip)}s(".has-tooltip").tooltip();prettyPrint();(function(){var r={};s(".shopping-cart-status").each(function(){var t=s(this),e=t.attr("data-href"),a=t.find(".count"),n=a.find(".value"),i;if(!e){return}i=r[e];if(!s.isArray(i)){i=r[e]=[]}i.push(function(e){if(e!=null&&e.Count&&e.Count>0){n.text(e.Count);a.addClass("visible");t.addClass("visible")}})});s.each(r,function(e,t){s.getJSON(e,function(a){s.each(t,function(e,t){t(a)})})})})();s('[data-state="sitemap"]').each(function(){var e=s(this),i=e.data("sitemap-current"),r=e.data("sitemap-ancestor"),t=e.closest("[data-sitemap-state]").data("sitemap-state"),o,l;if(!(t&&(i||r))){return}o=t.split(":");l=o[o.length-1];e.find("[data-sitemap-node]").each(function(){var a=s(this),n=a.data("sitemap-node");if(!n){return}s.each(o,function(e,t){if(e===0){if(i&&t==n){a.addClass(i)}}else{if(r&&t==n&&n!=l){a.addClass(r)}}})})});(function(){var a=URI?URI(document.location.href).search(true)||{}:{};s("[data-query]").each(function(){var e=s(this),t=a[e.data("query")];if(typeof t==="undefined"){return}e.val(t).change()})})()});if(typeof o!="undefined"&&o){o.zindex=2e3;(function(){var e=[o.ckeditorSettings,o.ckeditorCompactSettings];for(var t=0;t<e.length;t++){var a=e[t];if(!a)continue;var n=s('head > link[rel="stylesheet"]').map(function(e,t){var a=s(t).attr("href");return a.match(/,/)?null:a}).get();n.push((s("[data-app-path]").data("app-path")||"/")+"css/ckeditor.css");a.contentsCss=n}var i=CKEDITOR.stylesSet.get("cms");if(i){var r=[{name:window.ResourceManager["CKEditor_Page_Header_Style"],element:"div",attributes:{class:"page-header"}},{name:window.ResourceManager["CKEditor_Alert_Info_Style"],element:"div",attributes:{class:"alert alert-info"}},{name:window.ResourceManager["CKEditor_Alert_Success_Style"],element:"div",attributes:{class:"alert alert-success"}},{name:window.ResourceManager["CKEditor_Alert_Warning_Style"],element:"div",attributes:{class:"alert alert-warning"}},{name:window.ResourceManager["CKEditor_Alert_Danger_Style"],element:"div",attributes:{class:"alert alert-danger"}},{name:window.ResourceManager["CKEditor_Well_Style"],element:"div",attributes:{class:"well"}},{name:window.ResourceManager["CKEditor_Well_Small_Style"],element:"div",attributes:{class:"well well-sm"}},{name:window.ResourceManager["CKEditor_Well_Large_Style"],element:"div",attributes:{class:"well well-lg"}},{name:window.ResourceManager["CKEditor_Label_Style"],element:"span",attributes:{class:"label label-default"}},{name:window.ResourceManager["CKEditor_Label_Info_Style"],element:"span",attributes:{class:"label label-info"}},{name:window.ResourceManager["CKEditor_Label_Success_Style"],element:"span",attributes:{class:"label label-success"}},{name:window.ResourceManager["CKEditor_Label_Warning_Style"],element:"span",attributes:{class:"label label-warning"}},{name:window.ResourceManager["CKEditor_Label_Danger_Style"],element:"span",attributes:{class:"label label-danger"}}];for(var t=0;t<r.length;t++){i.push(r[t])}}})()}var e=s.cookie("adx-notification");if(typeof e===typeof undefined||e==null)return;t(e,true);s.cookie("adx-notification",null,{path:"/"});function t(e,t){var a=s(".notifications");if(a.length==0){var n=s(".page-heading");if(n.length==0){a=s("<div class='notifications'></div>").prependTo(s("#content-container"))}else{a=s("<div class='notifications'></div>").appendTo(n)}}a.find(".notification").slideUp().remove();if(typeof e!==typeof undefined&&e!==false&&e!=null&&e!=""){var i=s("<div class='notification alert alert-success success alert-dismissible' role='alert'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button>"+e+"</div>").on("closed.bs.alert",function(){if(a.find(".notification").length==0)a.hide()}).prependTo(a);a.show();window.scrollTo(0,0);if(t){setTimeout(function(){i.slideUp(100).remove();if(a.find(".notification").length==0)a.hide()},5e3)}}}})(window.jQuery,window.XRM);$(document).ready(function(){$(".dropdown-menu li a").focus(function(e){var t=$(e.target);t.attr("aria-selected",true);t.parent().toggleClass("active",true)});$(".dropdown-menu li a").focusout(function(e){var t=$(e.target);t.attr("aria-selected",false);t.parent().toggleClass("active",false)});$(".dropdown-submenu").on("click",function(e){$(this).toggleClass("open");var t=$(this).find("#search-filter");var a=t.attr("aria-expanded")==="true";t.attr("aria-expanded",!a);if(!a){var n=$(this).find(".dropdown-menu li:first-child a");n.focus()}e.stopPropagation();e.preventDefault()});$(".dropdown-menu li a").on("click",function(e){var t=$(this).parent().parent().prev().first();t.focus()});$(".dropdown-submenu > #search-filter").focusout(function(e){var t=$(this).attr("aria-expanded")==="true";if(!t){$(this).parent().toggleClass("open",false)}});$(document).on("click.bs.dropdown.data-api",".dropdown form",function(e){var t=$(e.target).closest("form").find(".dropdown-submenu");t.toggleClass("open",false);var a=t.find("#search-filter");a.attr("aria-expanded",false)})});$(document).ready(function(){$("#profile-dropdown").find("a").each(function(){$(this).attr("role","button")});$('li.weblink>a[title="Home"]').attr("aria-label",window.ResourceManager["Home_DefaultText"]);$("li.dropdown>a.navbar-icon").attr("title",window.ResourceManager["Search_DefaultText"]);$("label.required").next().find("input").each(function(){$(this).attr("aria-label",$(this).closest().attr("name"));$(this).attr("aria-required",true)});$("li.dropdown>a.dropdown-toggle").each(function(){$(this).attr("aria-label",$(this).attr("title")).attr("aria-haspopup",true).attr("aria-expanded",false)});$("li.weblink.dropdown>a").each(function(){$(this).attr("aria-label",$(this).attr("title"))});$('section.modal input[type="file"]').on("keydown",function(e){if(e.shiftKey&&e.keyCode==9){if($('input[type="file"]').is(":focus")){setTimeout(function(){$('section.modal textarea[name="text"]').focus()},0)}}});$("div.list-group>a").each(function(){$(this).attr("aria-label",$(this).attr("title"))})});$(document).ready(function(){$("input#AttachFile").attr("aria-label",window.ResourceManager["FileUpload_Browse_Button_Text"])});$(document).ready(function(){var e=$("select>option");$.each(e,function(e,t){if($(t).text()==""){$(t).text($(t).attr("label"))}})});portal.CompositeControl=function(e){var i=this;i.controlTrigger=e;i.$popverTriger=null;i.contentid="";i.$content=null;i.$contentInputs=null;i.valueTemplate="";i.isPopoverOpen=false;i.isEditable=false;i.showOrHidePopover=function(){if(i.isPopoverOpen){i.$popverTriger.popover("hide")}else{i.$popverTriger.popover("show")}};i.updateContent=function(){var t=$("."+i.contentid).find("input");i.$contentInputs.each(function(e,n){var i=$(n).prop("id");t.each(function(e,t){var a=$(t);if(a.prop("id")==i){$(n).attr("value",a.val().trim())}})});i.updateValue()};i.updateValue=function(){if(!i.isEditable)return;var r=i.valueTemplate.split("{BREAK}");i.$contentInputs.each(function(e,t){var a=$(t).attr("id");var n=$("#"+$(t).attr("id")).attr("value").trim();for(var i=0;i<r.length;i++){r[i]=r[i].replace("{"+a+"}",n).trim()}});i.$popverTriger.attr("value",r.join("\r\n"))};i.init=function(){i.$popverTriger=$(i.controlTrigger);i.contentid=i.$popverTriger.attr("data-content-id");i.valueTemplate=i.$popverTriger.attr("data-content-template");i.isEditable=i.$popverTriger.attr("data-editable").toLowerCase()==="true";i.$popverTriger.click(function(){i.showOrHidePopover()});console.log(i.contentid);i.$content=$("#"+i.contentid);i.$contentInputs=i.$content.find("input");i.$popverTriger.attr("readonly","true");i.updateValue();if(i.isEditable){i.$popverTriger.popover({trigger:"manual",html:true,template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content '+i.contentid+' "></div></div>',content:function(){return i.$content.html()},placement:function(){return"bottom"}});i.$popverTriger.on("inserted.bs.popover",function(){var e=$("."+i.contentid);e.css("width","270px");e.find("input").removeAttr("name");i.isPopoverOpen=true});i.$popverTriger.on("hide.bs.popover",function(){i.updateContent();i.isPopoverOpen=false});i.$popverTriger.on("shown.bs.popover",function(){$("."+i.contentid+" .btn").click(function(){i.$popverTriger.popover("hide")})})}$("body").on("click",function(e){if(!$(i.$popverTriger).is(e.target)&&$(".popover-content").length!==0&&$(e.target).data("toggle")!=="popover"&&$(e.target).parents('[data-toggle="popover"]').length===0&&$(e.target).parents(".popover.in").length===0){i.$popverTriger.popover("hide")}});$("#"+i.contentid).parent().on("keydown",function(e){if(e.keyCode===13&&(i.isPopoverOpen&&e.target.id.indexOf("Button")!==-1||!i.isPopoverOpen)){if(i.isPopoverOpen&&e.target.id.indexOf("Button")!==-1){var t=true}i.showOrHidePopover();if(t){var n=function(){var e=i.$popverTriger.closest("form").find(":input:visible");for(var t=0;t<e.length;t++){if(i.$popverTriger[0]==e[t]){var a=t}else if(a!=undefined){$(e[t]).focus();i.$popverTriger.off("hidden.bs.popover",n);break}}};i.$popverTriger.on("hidden.bs.popover",n)}}if(e.keyCode===27){i.$popverTriger.popover("hide")}if(e.target.id.indexOf("Button")!==-1&&e.keyCode===9&&!e.shiftKey){i.$popverTriger.popover("hide")}})}};$(document).ready(function(){var e=[];$(document).on("show.bs.modal",function(){e.push(document.activeElement)});$(document).on("hidden.bs.modal",function(){$(e[e.length-1]).focus();e.pop(document.activeElement)})});$(document).ready(function(){$("*[data-composite-control]").each(function(e,t){var a=new portal.CompositeControl(t);a.init()})});$("body").on("keydown",".dropdown",function(e){var t=e.srcElement.parentElement.parentElement;if(e.keyCode===9&&!e.shiftKey&&t!==null&&t.className.indexOf("dropdown")!==-1){if($(t).children().last().attr("class")==="active"){$(t).children().first().children().first().focus();e.preventDefault()}}});$(document).ready(function(){try{var e=$("html").attr("data-lang");if(e){$.cookie("ContextLanguageCode",e,{path:"/"})}var t=$(".drop_language").parents().next("ul").last()[0];if(t){var a=$("a",t);$(a).each(function(){var e=$(this).attr("data-code");if(e){$(this).on("click",function(){$.cookie("ContextLanguageCode",e,{path:"/"})})}})}}catch(e){}return true});$(document).ready(function(){$("section.modal").on("keydown",function(e){var t=$(this).find("a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]");if(t.last().is("iframe")){var a=t.last().contents().find("a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]").filter(":focusable");a.last().on("keydown",function(e){if(!e.shiftKey&&e.keyCode==9){t.first().focus();e.preventDefault()}})}if(e.keyCode==9&&$(document.activeElement).closest("section.modal")[0]==$(this)[0]){if(!e.shiftKey&&$(document.activeElement)[0]==t.last()[0]){t.first().focus();e.preventDefault()}else if(e.shiftKey&&$(document.activeElement)[0]==t.first()[0]){if(t.last().is("iframe")){var n=t.last().contents().find("a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]").filter(":focusable");n.last().focus()}else{t.last().focus()}e.preventDefault()}}})});